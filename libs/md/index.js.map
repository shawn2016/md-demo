{"version":3,"file":"index.js","sources":["../../src/md/config.js","../../src/md/device.js","../../src/md/coding.js","../../src/md/useragent.js","../../src/md/utils.js","../../src/md/user_track.js","../../src/md/event_track.js","../../src/md/local_storage.js","../../src/md/spa.js","../../src/md/channel.js","../../src/md/bpoint_send.js","../../src/md/load_control_js.js","../../src/md/index.js"],"sourcesContent":["// 默认配置\r\nconst DEFAULT_CONFIG = {\r\n  // 上报服务器域名配置\r\n  track_url: \"http://localhost:3300/\",\r\n  // debug启动配置\r\n  debug: false,\r\n  // 本地存储配置\r\n  local_storage: {\r\n    // 存储方式  localStorage || cookie\r\n    type: \"localStorage\",\r\n    // 存储名称\r\n    name: \"\",\r\n    // 关闭存储功能\r\n    disable: false,\r\n    // cookie存储时，采用安全的存储方式，即：\r\n    //当secure属性设置为true时，cookie只有在https协议下才能上传到服务器，而在http协议下是没法上传的，所以也不会被窃听\r\n    secure_cookie: false,\r\n    // cookie存储时，跨主域名存储配置\r\n    cross_subdomain_cookie: false,\r\n    // cookie方法存储时，配置保存过期时间\r\n    cookie_expiration: 1000\r\n  },\r\n  // 初始化sdk时触发的方法\r\n  loaded: function() {},\r\n  // 上报数据实现形式  post, get, img\r\n  track_type: \"img\",\r\n  // 单页面应用配置\r\n  SPA: {\r\n    // 开启SPA配置\r\n    is: false,\r\n    // SPA 实现类型，hash || history\r\n    mode: \"hash\"\r\n  },\r\n  // PV指标自动触发配置\r\n  pageview: true,\r\n  // 上报数据前，每个字段长度截取配置，默认不截取\r\n  truncateLength: -1,\r\n  // 会话超时时长，默认30分钟\r\n  session_interval_mins: 30,\r\n  isBpoint: true, // 是否开启断点发送，默认开启\r\n  // 远程拉取可视化圈选插件地址\r\n  auto_visualization_src:\r\n    \"http://localhost:3300/build/plugins/auto_visualization/main.js\",\r\n  stackSize: 10, //信息存储栈大小 栈满 则打包 转存到待发送队列\r\n  stackTime: 3, //信息存储栈时间（单位 秒） 定时扫描，栈有数据就发\r\n\r\n  queueSize: 20, //待发送队列大小\r\n  queueTime: 5 //待发送队列 自动扫描发送时间\r\n};\r\n\r\n// 配置\r\nconst CONFIG = {\r\n  DEBUG: false,\r\n  LIB_VERSION: \"0.1.0\",\r\n  isBpoint: true, // 是否开启断点发送，默认开启\r\n  stackSize: 10, //信息存储栈大小 栈满 则打包 转存到待发送队列\r\n  stackTime: 3, //信息存储栈时间（单位 秒） 定时扫描，栈有数据就发\r\n\r\n  queueSize: 20, //待发送队列大小\r\n  queueTime: 5 //待发送队列 自动扫描发送时间\r\n};\r\n\r\n// 系统事件类型（事件分为：系统事件和业务事件）\r\nconst SYSTEM_EVENT_TYPE = \"se\";\r\n\r\n// 业务事件类型\r\nconst BUSSINESS_EVENT_TYPE = \"be\";\r\n\r\n// 系统事件列表\r\nconst SYSTEM_EVENT_OBJECT = {\r\n  // 会话开始事件\r\n  smart_session_start: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 会话结束事件\r\n  smart_session_close: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // PV事件\r\n  smart_pv: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 广告点击事件\r\n  smart_ad_click: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户首次访问网站事件\r\n  smart_activate: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // A/B 测试事件\r\n  smart_abtest: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 异常错误事件\r\n  smart_error: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户注册事件\r\n  smart_u_signup: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户登录事件\r\n  smart_u_login: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户登出事件\r\n  smart_u_logout: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户属性设置事件\r\n  smart_u_property: {\r\n    data_type: SYSTEM_EVENT_TYPE\r\n  }\r\n};\r\n\r\n// People类系统保留属性，用户设置这些属性将无法成功\r\nconst PEOPLE_RESERVED_PROPERTY = [\"$deviceUdid\", \"$toekn\"];\r\n\r\n// People类属性事件id，全局唯一\r\nconst PEOPLE_PROPERTY_ID = \"smart_user_property\";\r\n\r\n// 渠道推广参数全局配置, 左边sdk内部使用的参数，右边实际url上的参数\r\n// 若url上推广的参数不一致，请修改对应右边的值（一一对应）\r\n// 注意：系统暂时未支持自定义配置（TODO）,若要改动，请到文件 src/channel.js 修改。\r\nconst CHANNEL_PARAMS = {\r\n  // 广告来源(必须字段)\r\n  utm_source: \"utm_source\",\r\n  // 广告媒介(必须字段)\r\n  utm_medium: \"utm_medium\",\r\n  // 广告名称(必须字段)\r\n  utm_campaign: \"utm_campaign\",\r\n  // 广告内容(选填)\r\n  utm_content: \"utm_content\",\r\n  // 广告关键词(选填)\r\n  utm_term: \"utm_term\",\r\n  // 广告id(必须字段)\r\n  promotional_id: \"promotional_id\"\r\n};\r\n\r\nexport {\r\n  CONFIG,\r\n  DEFAULT_CONFIG,\r\n  SYSTEM_EVENT_TYPE,\r\n  BUSSINESS_EVENT_TYPE,\r\n  SYSTEM_EVENT_OBJECT,\r\n  PEOPLE_RESERVED_PROPERTY,\r\n  PEOPLE_PROPERTY_ID,\r\n  CHANNEL_PARAMS,\r\n  BPOINT_CONFIG\r\n};\r\n","\r\n// Save the previous value of the device variable.\r\nvar previousDevice = window.device;\r\n\r\nvar device = {};\r\n\r\nvar changeOrientationList = [];\r\n\r\n// Add device as a global object.\r\nwindow.device = device;\r\n\r\n// The <html> element.\r\nvar documentElement = window.document.documentElement;\r\n\r\n// The client user agent string.\r\n// Lowercase, so we can use the more efficient indexOf(), instead of Regex\r\nvar userAgent = window.navigator.userAgent.toLowerCase();\r\n\r\n// Detectable television devices.\r\nvar television = ['googletv', 'viera', 'smarttv', 'internet.tv', 'netcast', 'nettv', 'appletv', 'boxee', 'kylo', 'roku', 'dlnadoc', 'roku', 'pov_tv', 'hbbtv', 'ce-html'];\r\n\r\n// Main functions\r\n// --------------\r\n\r\ndevice.macos = function () {\r\n  return find('mac');\r\n};\r\n\r\ndevice.ios = function () {\r\n  return device.iphone() || device.ipod() || device.ipad();\r\n};\r\n\r\ndevice.iphone = function () {\r\n  return !device.windows() && find('iphone');\r\n};\r\n\r\ndevice.ipod = function () {\r\n  return find('ipod');\r\n};\r\n\r\ndevice.ipad = function () {\r\n  return find('ipad');\r\n};\r\n\r\ndevice.android = function () {\r\n  return !device.windows() && find('android');\r\n};\r\n\r\ndevice.androidPhone = function () {\r\n  return device.android() && find('mobile');\r\n};\r\n\r\ndevice.androidTablet = function () {\r\n  return device.android() && !find('mobile');\r\n};\r\n\r\ndevice.blackberry = function () {\r\n  return find('blackberry') || find('bb10') || find('rim');\r\n};\r\n\r\ndevice.blackberryPhone = function () {\r\n  return device.blackberry() && !find('tablet');\r\n};\r\n\r\ndevice.blackberryTablet = function () {\r\n  return device.blackberry() && find('tablet');\r\n};\r\n\r\ndevice.windows = function () {\r\n  return find('windows');\r\n};\r\n\r\ndevice.windowsPhone = function () {\r\n  return device.windows() && find('phone');\r\n};\r\n\r\ndevice.windowsTablet = function () {\r\n  return device.windows() && find('touch') && !device.windowsPhone();\r\n};\r\n\r\ndevice.fxos = function () {\r\n  return (find('(mobile') || find('(tablet')) && find(' rv:');\r\n};\r\n\r\ndevice.fxosPhone = function () {\r\n  return device.fxos() && find('mobile');\r\n};\r\n\r\ndevice.fxosTablet = function () {\r\n  return device.fxos() && find('tablet');\r\n};\r\n\r\ndevice.meego = function () {\r\n  return find('meego');\r\n};\r\n\r\ndevice.cordova = function () {\r\n  return window.cordova && location.protocol === 'file:';\r\n};\r\n\r\ndevice.nodeWebkit = function () {\r\n  return typeof (window.process) === 'object';\r\n};\r\n\r\ndevice.mobile = function () {\r\n  return device.androidPhone() || device.iphone() || device.ipod() || device.windowsPhone() || device.blackberryPhone() || device.fxosPhone() || device.meego();\r\n};\r\n\r\ndevice.tablet = function () {\r\n  return device.ipad() || device.androidTablet() || device.blackberryTablet() || device.windowsTablet() || device.fxosTablet();\r\n};\r\n\r\ndevice.desktop = function () {\r\n  return !device.tablet() && !device.mobile();\r\n};\r\n\r\ndevice.television = function () {\r\n  var i = 0;\r\n  while (i < television.length) {\r\n    if (find(television[i])) {\r\n      return true;\r\n    }\r\n    i++;\r\n  }\r\n  return false;\r\n};\r\n\r\ndevice.portrait = function () {\r\n  if (screen.orientation && Object.prototype.hasOwnProperty.call(window, 'onorientationchange')) {\r\n    return screen.orientation.type.includes('portrait');\r\n  }\r\n  return window.innerHeight / window.innerWidth > 1;\r\n};\r\n\r\ndevice.landscape = function () {\r\n  if (screen.orientation && Object.prototype.hasOwnProperty.call(window, 'onorientationchange')) {\r\n    return screen.orientation.type.includes('landscape');\r\n  }\r\n  return window.innerHeight / window.innerWidth < 1;\r\n};\r\n\r\n// Public Utility Functions\r\n// ------------------------\r\n\r\n// Run device.js in noConflict mode,\r\n// returning the device variable to its previous owner.\r\ndevice.noConflict = function () {\r\n  window.device = previousDevice;\r\n  return this;\r\n};\r\n\r\n// Private Utility Functions\r\n// -------------------------\r\n\r\n// Simple UA string search\r\nfunction find(needle) {\r\n  return userAgent.indexOf(needle) !== -1;\r\n}\r\n\r\n// Check if documentElement already has a given class.\r\nfunction hasClass(className) {\r\n  return documentElement.className.match(new RegExp(className, 'i'));\r\n}\r\n\r\n// Add one or more CSS classes to the <html> element.\r\nfunction addClass(className) {\r\n  var currentClassNames = null;\r\n  if (!hasClass(className)) {\r\n    currentClassNames = documentElement.className.replace(/^\\s+|\\s+$/g, '');\r\n    documentElement.className = currentClassNames + ' ' + className;\r\n  }\r\n}\r\n\r\n// Remove single CSS class from the <html> element.\r\nfunction removeClass(className) {\r\n  if (hasClass(className)) {\r\n    documentElement.className = documentElement.className.replace(' ' + className, '');\r\n  }\r\n}\r\n\r\n// HTML Element Handling\r\n// ---------------------\r\n\r\n// Insert the appropriate CSS class based on the _user_agent.\r\n\r\nif (device.ios()) {\r\n  if (device.ipad()) {\r\n    addClass('ios ipad tablet');\r\n  } else if (device.iphone()) {\r\n    addClass('ios iphone mobile');\r\n  } else if (device.ipod()) {\r\n    addClass('ios ipod mobile');\r\n  }\r\n} else if (device.macos()) {\r\n  addClass('macos desktop');\r\n} else if (device.android()) {\r\n  if (device.androidTablet()) {\r\n    addClass('android tablet');\r\n  } else {\r\n    addClass('android mobile');\r\n  }\r\n} else if (device.blackberry()) {\r\n  if (device.blackberryTablet()) {\r\n    addClass('blackberry tablet');\r\n  } else {\r\n    addClass('blackberry mobile');\r\n  }\r\n} else if (device.windows()) {\r\n  if (device.windowsTablet()) {\r\n    addClass('windows tablet');\r\n  } else if (device.windowsPhone()) {\r\n    addClass('windows mobile');\r\n  } else {\r\n    addClass('windows desktop');\r\n  }\r\n} else if (device.fxos()) {\r\n  if (device.fxosTablet()) {\r\n    addClass('fxos tablet');\r\n  } else {\r\n    addClass('fxos mobile');\r\n  }\r\n} else if (device.meego()) {\r\n  addClass('meego mobile');\r\n} else if (device.nodeWebkit()) {\r\n  addClass('node-webkit');\r\n} else if (device.television()) {\r\n  addClass('television');\r\n} else if (device.desktop()) {\r\n  addClass('desktop');\r\n}\r\n\r\nif (device.cordova()) {\r\n  addClass('cordova');\r\n}\r\n\r\n// Orientation Handling\r\n// --------------------\r\n\r\n// Handle device orientation changes.\r\nfunction handleOrientation() {\r\n  if (device.landscape()) {\r\n    removeClass('portrait');\r\n    addClass('landscape');\r\n    walkOnChangeOrientationList('landscape');\r\n  } else {\r\n    removeClass('landscape');\r\n    addClass('portrait');\r\n    walkOnChangeOrientationList('portrait');\r\n  }\r\n  setOrientationCache();\r\n}\r\n\r\nfunction walkOnChangeOrientationList(newOrientation) {\r\n  for (var index in changeOrientationList) {\r\n    changeOrientationList[index](newOrientation);\r\n  }\r\n}\r\n\r\ndevice.onChangeOrientation = function (cb) {\r\n  if (typeof cb == 'function') {\r\n    changeOrientationList.push(cb);\r\n  }\r\n};\r\n\r\n// Detect whether device supports orientationchange event,\r\n// otherwise fall back to the resize event.\r\nvar orientationEvent = 'resize';\r\nif (Object.prototype.hasOwnProperty.call(window, 'onorientationchange')) {\r\n  orientationEvent = 'orientationchange';\r\n}\r\n\r\n// Listen for changes in orientation.\r\nif (window.addEventListener) {\r\n  window.addEventListener(orientationEvent, handleOrientation, false);\r\n} else if (window.attachEvent) {\r\n  window.attachEvent(orientationEvent, handleOrientation);\r\n} else {\r\n  window[orientationEvent] = handleOrientation;\r\n}\r\n\r\nhandleOrientation();\r\n\r\n// Public functions to get the current value of type, os, or orientation\r\n// ---------------------------------------------------------------------\r\n\r\nfunction findMatch(arr) {\r\n  for (var i = 0; i < arr.length; i++) {\r\n    if (device[arr[i]]()) {\r\n      return arr[i];\r\n    }\r\n  }\r\n  return 'unknown';\r\n}\r\n\r\ndevice.type = findMatch(['mobile', 'tablet', 'desktop']);\r\ndevice.os = findMatch(['ios', 'iphone', 'ipad', 'ipod', 'android', 'blackberry', 'windows', 'fxos', 'meego', 'television']);\r\n\r\nfunction setOrientationCache() {\r\n  device.orientation = findMatch(['portrait', 'landscape']);\r\n}\r\n\r\nsetOrientationCache();\r\n\r\nexport default device;","\nconst utf8Encode = function(string) {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n    var utftext = '',\n        start,\n        end;\n    var stringl = 0,\n        n;\n\n    start = end = 0;\n    stringl = string.length;\n\n    for (n = 0; n < stringl; n++) {\n        var c1 = string.charCodeAt(n);\n        var enc = null;\n\n        if (c1 < 128) {\n            end++;\n        } else if ((c1 > 127) && (c1 < 2048)) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128);\n        }\n        if (enc !== null) {\n            if (end > start) {\n                utftext += string.substring(start, end);\n            }\n            utftext += enc;\n            start = end = n + 1;\n        }\n    }\n\n    if (end > start) {\n        utftext += string.substring(start, string.length);\n    }\n\n    return utftext;\n};\n\nconst base64Encode = function(data) {\n    var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,\n        ac = 0,\n        enc = '',\n        tmp_arr = [];\n\n    if (!data) {\n        return data;\n    }\n\n    data = utf8Encode(data);\n\n    do { // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n\n        bits = o1 << 16 | o2 << 8 | o3;\n\n        h1 = bits >> 18 & 0x3f;\n        h2 = bits >> 12 & 0x3f;\n        h3 = bits >> 6 & 0x3f;\n        h4 = bits & 0x3f;\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n            break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n            break;\n    }\n\n    return enc;\n};\n\nconst sha1 = function(str){\n    \n   /*\n     * A Javascript implementation of the Secure Hash Algorithm, SHA-1, as defined\n     * in FIPS PUB 180-1\n     * Version 2.1-BETA Copyright Paul Johnston 2000 - 2002.\n     * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n     * Distributed under the BSD License\n     * See http://pajhome.org.uk/crypt/md5 for details.\n     */\n    /*\n     * Configurable variables. You may need to tweak these to be compatible with\n     * the server-side, but the defaults work in most cases.\n     */\n    var hexcase = 0; /* hex output format. 0 - lowercase; 1 - uppercase     */\n    var b64pad = \"\"; /* base-64 pad character. \"=\" for strict RFC compliance  */\n    var chrsz = 8; /* bits per input character. 8 - ASCII; 16 - Unicode    */\n    /*\n     * These are the functions you'll usually want to call\n     * They take string arguments and return either hex or base-64 encoded strings\n     */\n    function hex_sha1(s) {\n     return binb2hex(core_sha1(str2binb(s), s.length * chrsz));\n    }\n    function b64_sha1(s) {\n     return binb2b64(core_sha1(str2binb(s), s.length * chrsz));\n    }\n    function str_sha1(s) {\n     return binb2str(core_sha1(str2binb(s), s.length * chrsz));\n    }\n    function hex_hmac_sha1(key, data) {\n     return binb2hex(core_hmac_sha1(key, data));\n    }\n    function b64_hmac_sha1(key, data) {\n     return binb2b64(core_hmac_sha1(key, data));\n    }\n    function str_hmac_sha1(key, data) {\n     return binb2str(core_hmac_sha1(key, data));\n    }\n    /*\n     * Perform a simple self-test to see if the VM is working\n     */\n    function sha1_vm_test() {\n     return hex_sha1(\"abc\") == \"a9993e364706816aba3e25717850c26c9cd0d89d\";\n    }\n    /*\n     * Calculate the SHA-1 of an array of big-endian words, and a bit length\n     */\n    function core_sha1(x, len) {\n     /* append padding */\n     x[len >> 5] |= 0x80 << (24 - len % 32);\n     x[((len + 64 >> 9) << 4) + 15] = len;\n     var w = Array(80);\n     var a = 1732584193;\n     var b = -271733879;\n     var c = -1732584194;\n     var d = 271733878;\n     var e = -1009589776;\n     for (var i = 0; i < x.length; i += 16) {\n      var olda = a;\n      var oldb = b;\n      var oldc = c;\n      var oldd = d;\n      var olde = e;\n      for (var j = 0; j < 80; j++) {\n       if (j < 16) w[j] = x[i + j];\n       else w[j] = rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);\n       var t = safe_add(safe_add(rol(a, 5), sha1_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), sha1_kt(j)));\n       e = d;\n       d = c;\n       c = rol(b, 30);\n       b = a;\n       a = t;\n      }\n      a = safe_add(a, olda);\n      b = safe_add(b, oldb);\n      c = safe_add(c, oldc);\n      d = safe_add(d, oldd);\n      e = safe_add(e, olde);\n     }\n     return Array(a, b, c, d, e);\n    }\n    /*\n     * Perform the appropriate triplet combination function for the current\n     * iteration\n     */\n    function sha1_ft(t, b, c, d) {\n     if (t < 20) return (b & c) | ((~b) & d);\n     if (t < 40) return b ^ c ^ d;\n     if (t < 60) return (b & c) | (b & d) | (c & d);\n     return b ^ c ^ d;\n    }\n    /*\n     * Determine the appropriate additive constant for the current iteration\n     */\n    function sha1_kt(t) {\n     return (t < 20) ? 1518500249 : (t < 40) ? 1859775393 : (t < 60) ? -1894007588 : -899497514;\n    }\n    /*\n     * Calculate the HMAC-SHA1 of a key and some data\n     */\n    function core_hmac_sha1(key, data) {\n     var bkey = str2binb(key);\n     if (bkey.length > 16) bkey = core_sha1(bkey, key.length * chrsz);\n     var ipad = Array(16),\n      opad = Array(16);\n     for (var i = 0; i < 16; i++) {\n      ipad[i] = bkey[i] ^ 0x36363636;\n      opad[i] = bkey[i] ^ 0x5C5C5C5C;\n     }\n     var hash = core_sha1(ipad.concat(str2binb(data)), 512 + data.length * chrsz);\n     return core_sha1(opad.concat(hash), 512 + 160);\n    }\n    /*\n     * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n     * to work around bugs in some JS interpreters.\n     */\n    function safe_add(x, y) {\n     var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n     var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n     return (msw << 16) | (lsw & 0xFFFF);\n    }\n    /*\n     * Bitwise rotate a 32-bit number to the left.\n     */\n    function rol(num, cnt) {\n     return (num << cnt) | (num >>> (32 - cnt));\n    }\n    /*\n     * Convert an 8-bit or 16-bit string to an array of big-endian words\n     * In 8-bit function, characters >255 have their hi-byte silently ignored.\n     */\n    function str2binb(str) {\n     var bin = Array();\n     var mask = (1 << chrsz) - 1;\n     for (var i = 0; i < str.length * chrsz; i += chrsz)\n     bin[i >> 5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i % 32);\n     return bin;\n    }\n    /*\n     * Convert an array of big-endian words to a string\n     */\n    function binb2str(bin) {\n     var str = \"\";\n     var mask = (1 << chrsz) - 1;\n     for (var i = 0; i < bin.length * 32; i += chrsz)\n     str += String.fromCharCode((bin[i >> 5] >>> (24 - i % 32)) & mask);\n     return str;\n    }\n    /*\n     * Convert an array of big-endian words to a hex string.\n     */\n    function binb2hex(binarray) {\n     var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\n     var str = \"\";\n     for (var i = 0; i < binarray.length * 4; i++) {\n      str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) + hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);\n     }\n     return str;\n    }\n    /*\n     * Convert an array of big-endian words to a base-64 string\n     */\n    function binb2b64(binarray) {\n     var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n     var str = \"\";\n     for (var i = 0; i < binarray.length * 4; i += 3) {\n      var triplet = (((binarray[i >> 2] >> 8 * (3 - i % 4)) & 0xFF) << 16) | (((binarray[i + 1 >> 2] >> 8 * (3 - (i + 1) % 4)) & 0xFF) << 8) | ((binarray[i + 2 >> 2] >> 8 * (3 - (i + 2) % 4)) & 0xFF);\n      for (var j = 0; j < 4; j++) {\n       if (i * 8 + j * 6 > binarray.length * 32) str += b64pad;\n       else str += tab.charAt((triplet >> 6 * (3 - j)) & 0x3F);\n      }\n     }\n     return str;\n    }\n\n    return hex_sha1(str);\n};\n\nexport {\n  utf8Encode,\n  base64Encode,\n  sha1\n}","// 兼容单元测试环境\r\nlet win;\r\nif (typeof(window) === 'undefined') {\r\n    win = {\r\n      navigator: {\r\n        userAgent: ''\r\n      },\r\n      location: {\r\n        pathname: '',\r\n        href: ''\r\n      },\r\n      document: {\r\n        \r\n      },\r\n      screen: {\r\n        width: '',\r\n        height: ''\r\n      }\r\n    };\r\n} else {\r\n  win = window;\r\n}\r\n\r\nfunction toString(object) {\r\n    return Object.prototype.toString.call(object);\r\n  }\r\n  \r\n  function isObject(object) {\r\n    return toString(object) === \"[object Object]\";\r\n  }\r\n  \r\n  function isFunction(object) {\r\n     return toString(object) === \"[object Function]\";\r\n  }\r\n  \r\n  function each(object, factory) {\r\n      for (var i = 0, l = object.length; i < l; i++) {\r\n          if (factory.call(object, object[i], i) === false) {\r\n          break;\r\n          }\r\n      }\r\n  }\r\n\r\nvar NA_VERSION = \"-1\";\r\nvar external = win.external;\r\nvar userAgent = win.navigator.userAgent || \"\";\r\nvar appVersion = win.navigator.appVersion || \"\";\r\nvar vendor = win.navigator.vendor || \"\";\r\nvar detector = {};\r\n\r\nvar re_msie = /\\b(?:msie |ie |trident\\/[0-9].*rv[ :])([0-9.]+)/;\r\nvar re_blackberry_10 = /\\bbb10\\b.+?\\bversion\\/([\\d.]+)/;\r\nvar re_blackberry_6_7 = /\\bblackberry\\b.+\\bversion\\/([\\d.]+)/;\r\nvar re_blackberry_4_5 = /\\bblackberry\\d+\\/([\\d.]+)/;\r\n\r\n// http://zakwu.me/2015/12/15/an-zhuo-shou-ji-uashou-ji/ 参考\r\n// 硬件设备信息识别表达式。\r\n// 使用数组可以按优先级排序。\r\nvar DEVICES = [\r\n  [\"nokia\", function(ua) {\r\n      // 不能将两个表达式合并，因为可能出现 \"nokia; nokia 960\"\r\n      // 这种情况下会优先识别出 nokia/-1\r\n      if (ua.indexOf(\"nokia \") !== -1) {\r\n      return /\\bnokia ([0-9]+)?/;\r\n      } else {\r\n      return /\\bnokia([a-z0-9]+)?/;\r\n      }\r\n  }],\r\n  // 三星有 Android 和 WP 设备。\r\n  [\"samsung\", function(ua) {\r\n      if (ua.indexOf(\"samsung\") !== -1) {\r\n      return /\\bsamsung(?:[ \\-](?:sgh|gt|sm))?-([a-z0-9]+)/;\r\n      } else {\r\n      return /\\b(?:sgh|sch|gt|sm)-([a-z0-9]+)/;\r\n      }\r\n  }],\r\n  [\"wp\", function(ua) {\r\n      return ua.indexOf(\"windows phone \") !== -1 ||\r\n      ua.indexOf(\"xblwp\") !== -1 ||\r\n      ua.indexOf(\"zunewp\") !== -1 ||\r\n      ua.indexOf(\"windows ce\") !== -1;\r\n  }],\r\n  [\"pc\", \"windows\"],\r\n  [\"ipad\", \"ipad\"],\r\n  // ipod 规则应置于 iphone 之前。\r\n  [\"ipod\", \"ipod\"],\r\n  [\"iphone\", /\\biphone\\b|\\biph(\\d)/],\r\n  [\"mac\", \"macintosh\"],\r\n  // 小米\r\n  [\"mi\", /\\bmi[ \\-]?([a-z0-9 ]+(?= build|\\)))/],\r\n  // 红米\r\n  [\"hongmi\", /\\bhm\\b|redmi[ \\-]?([a-z0-9]+)/],\r\n  [\"aliyun\", /\\baliyunos\\b(?:[\\-](\\d+))?/],\r\n  [\"meizu\", function(ua) {\r\n      return ua.indexOf(\"meizu\") >= 0 ?\r\n      /\\bmeizu[\\/ ]([a-z0-9]+)\\b/\r\n      :\r\n      /\\bm([0-9cx]{1,4})\\b/;\r\n  }],\r\n  [\"nexus\", /\\bnexus ([0-9s.]+)/],\r\n  [\"huawei\", function(ua) {\r\n      var re_mediapad = /\\bmediapad (.+?)(?= build\\/huaweimediapad\\b)/;\r\n      if (ua.indexOf(\"huawei-huawei\") !== -1) {\r\n      return /\\bhuawei\\-huawei\\-([a-z0-9\\-]+)/;\r\n      } else if (re_mediapad.test(ua)) {\r\n      return re_mediapad;\r\n      } else {\r\n      return /\\bhuawei[ _\\-]?([a-z0-9]+)/;\r\n      }\r\n  }],\r\n  [\"lenovo\", function(ua) {\r\n      if (ua.indexOf(\"lenovo-lenovo\") !== -1) {\r\n      return /\\blenovo\\-lenovo[ \\-]([a-z0-9]+)/;\r\n      } else {\r\n      return /\\blenovo[ \\-]?([a-z0-9]+)/;\r\n      }\r\n  }],\r\n  // 中兴\r\n  [\"zte\", function(ua) {\r\n      if (/\\bzte\\-[tu]/.test(ua)) {\r\n      return /\\bzte-[tu][ _\\-]?([a-su-z0-9\\+]+)/;\r\n      } else {\r\n      return /\\bzte[ _\\-]?([a-su-z0-9\\+]+)/;\r\n      }\r\n  }],\r\n  // 步步高\r\n  [\"vivo\", /\\bvivo(?: ([a-z0-9]+))?/],\r\n  [\"htc\", function(ua) {\r\n      if (/\\bhtc[a-z0-9 _\\-]+(?= build\\b)/.test(ua)) {\r\n      return /\\bhtc[ _\\-]?([a-z0-9 ]+(?= build))/;\r\n      } else {\r\n      return /\\bhtc[ _\\-]?([a-z0-9 ]+)/;\r\n      }\r\n  }],\r\n  [\"oppo\", /\\boppo[_]([a-z0-9]+)/],\r\n  [\"konka\", /\\bkonka[_\\-]([a-z0-9]+)/],\r\n  [\"sonyericsson\", /\\bmt([a-z0-9]+)/],\r\n  [\"coolpad\", /\\bcoolpad[_ ]?([a-z0-9]+)/],\r\n  [\"lg\", /\\blg[\\-]([a-z0-9]+)/],\r\n  [\"android\", /\\bandroid\\b|\\badr\\b/],\r\n  [\"blackberry\", function(ua) {\r\n      if (ua.indexOf(\"blackberry\") >= 0) {\r\n      return /\\bblackberry\\s?(\\d+)/;\r\n      }\r\n      return \"bb10\";\r\n  }]\r\n];\r\n// 操作系统信息识别表达式\r\nvar OS = [\r\n  [\"wp\", function(ua) {\r\n      if (ua.indexOf(\"windows phone \") !== -1) {\r\n      return /\\bwindows phone (?:os )?([0-9.]+)/;\r\n      } else if (ua.indexOf(\"xblwp\") !== -1) {\r\n      return /\\bxblwp([0-9.]+)/;\r\n      } else if (ua.indexOf(\"zunewp\") !== -1) {\r\n      return /\\bzunewp([0-9.]+)/;\r\n      }\r\n      return \"windows phone\";\r\n  }],\r\n  [\"windows\", /\\bwindows nt ([0-9.]+)/],\r\n  [\"macosx\", /\\bmac os x ([0-9._]+)/],\r\n  [\"iOS\", function(ua) {\r\n      if (/\\bcpu(?: iphone)? os /.test(ua)) {\r\n      return /\\bcpu(?: iphone)? os ([0-9._]+)/;\r\n      } else if (ua.indexOf(\"iph os \") !== -1) {\r\n      return /\\biph os ([0-9_]+)/;\r\n      } else {\r\n      return /\\bios\\b/;\r\n      }\r\n  }],\r\n  [\"yunos\", /\\baliyunos ([0-9.]+)/],\r\n  [\"Android\", function(ua) {\r\n      if (ua.indexOf(\"android\") >= 0) {\r\n      return /\\bandroid[ \\/-]?([0-9.x]+)?/;\r\n      } else if (ua.indexOf(\"adr\") >= 0) {\r\n      if (ua.indexOf(\"mqqbrowser\") >= 0) {\r\n          return /\\badr[ ]\\(linux; u; ([0-9.]+)?/;\r\n      } else {\r\n          return /\\badr(?:[ ]([0-9.]+))?/;\r\n      }\r\n      }\r\n      return \"android\";\r\n      //return /\\b(?:android|\\badr)(?:[\\/\\- ](?:\\(linux; u; )?)?([0-9.x]+)?/;\r\n  }],\r\n  [\"chromeos\", /\\bcros i686 ([0-9.]+)/],\r\n  [\"linux\", \"linux\"],\r\n  [\"windowsce\", /\\bwindows ce(?: ([0-9.]+))?/],\r\n  [\"symbian\", /\\bsymbian(?:os)?\\/([0-9.]+)/],\r\n  [\"blackberry\", function(ua) {\r\n      var m = ua.match(re_blackberry_10) ||\r\n      ua.match(re_blackberry_6_7) ||\r\n      ua.match(re_blackberry_4_5);\r\n      return m ? {version: m[1]} : \"blackberry\";\r\n  }]\r\n];\r\n//浏览器内核\r\nvar ENGINE = [\r\n  [\"edgehtml\", /edge\\/([0-9.]+)/],\r\n  [\"trident\", re_msie],\r\n  [\"blink\", function() {\r\n      return \"chrome\" in win && \"CSS\" in win && /\\bapplewebkit[\\/]?([0-9.+]+)/;\r\n  }],\r\n  [\"webkit\", /\\bapplewebkit[\\/]?([0-9.+]+)/],\r\n  [\"gecko\", function(ua) {\r\n      var match;\r\n      if ((match = ua.match(/\\brv:([\\d\\w.]+).*\\bgecko\\/(\\d+)/))) {\r\n      return {\r\n          version: match[1] + \".\" + match[2]\r\n      };\r\n      }\r\n  }],\r\n  [\"presto\", /\\bpresto\\/([0-9.]+)/],\r\n  [\"androidwebkit\", /\\bandroidwebkit\\/([0-9.]+)/],\r\n  [\"coolpadwebkit\", /\\bcoolpadwebkit\\/([0-9.]+)/],\r\n  [\"u2\", /\\bu2\\/([0-9.]+)/],\r\n  [\"u3\", /\\bu3\\/([0-9.]+)/]\r\n];\r\nvar BROWSER = [\r\n  // Microsoft Edge Browser, Default browser in Windows 10.\r\n  [\"edge\", /edge\\/([0-9.]+)/],\r\n  // Sogou.\r\n  [\"sogou\", function(ua) {\r\n      if (ua.indexOf(\"sogoumobilebrowser\") >= 0) {\r\n      return /sogoumobilebrowser\\/([0-9.]+)/;\r\n      } else if (ua.indexOf(\"sogoumse\") >= 0) {\r\n      return true;\r\n      }\r\n      return / se ([0-9.x]+)/;\r\n  }],\r\n  // TheWorld (世界之窗)\r\n  // 由于裙带关系，TheWorld API 与 360 高度重合。\r\n  // 只能通过 UA 和程序安装路径中的应用程序名来区分。\r\n  // TheWorld 的 UA 比 360 更靠谱，所有将 TheWorld 的规则放置到 360 之前。\r\n  [\"theworld\", function() {\r\n      var x = checkTW360External(\"theworld\");\r\n      if (typeof x !== \"undefined\") {\r\n      return x;\r\n      }\r\n      return \"theworld\";\r\n  }],\r\n  // 360SE, 360EE.\r\n  [\"360\", function(ua) {\r\n      var x = checkTW360External(\"360se\");\r\n      if (typeof x !== \"undefined\") {\r\n      return x;\r\n      }\r\n      if (ua.indexOf(\"360 aphone browser\") !== -1) {\r\n      return /\\b360 aphone browser \\(([^\\)]+)\\)/;\r\n      }\r\n      return /\\b360(?:se|ee|chrome|browser)\\b/;\r\n  }],\r\n  // Maxthon\r\n  [\"maxthon\", function() {\r\n      try {\r\n      if (external && (external.mxVersion || external.max_version)) {\r\n          return {\r\n          version: external.mxVersion || external.max_version\r\n          };\r\n      }\r\n      } catch (ex) { /* */\r\n      }\r\n      return /\\b(?:maxthon|mxbrowser)(?:[ \\/]([0-9.]+))?/;\r\n  }],\r\n  [\"micromessenger\", /\\bmicromessenger\\/([\\d.]+)/],\r\n  [\"qq\", /\\bm?qqbrowser\\/([0-9.]+)/],\r\n  [\"green\", \"greenbrowser\"],\r\n  [\"tt\", /\\btencenttraveler ([0-9.]+)/],\r\n  [\"liebao\", function(ua) {\r\n      if (ua.indexOf(\"liebaofast\") >= 0) {\r\n      return /\\bliebaofast\\/([0-9.]+)/;\r\n      }\r\n      if (ua.indexOf(\"lbbrowser\") === -1) {\r\n      return false;\r\n      }\r\n      var version;\r\n      try {\r\n      if (external && external.LiebaoGetVersion) {\r\n          version = external.LiebaoGetVersion();\r\n      }\r\n      } catch (ex) { /* */\r\n      }\r\n      return {\r\n      version: version || NA_VERSION\r\n      };\r\n  }],\r\n  [\"tao\", /\\btaobrowser\\/([0-9.]+)/],\r\n  [\"coolnovo\", /\\bcoolnovo\\/([0-9.]+)/],\r\n  [\"saayaa\", \"saayaa\"],\r\n  // 有基于 Chromniun 的急速模式和基于 IE 的兼容模式。必须在 IE 的规则之前。\r\n  [\"baidu\", /\\b(?:ba?idubrowser|baiduhd)[ \\/]([0-9.x]+)/],\r\n  // 后面会做修复版本号，这里只要能识别是 IE 即可。\r\n  [\"ie\", re_msie],\r\n  [\"mi\", /\\bmiuibrowser\\/([0-9.]+)/],\r\n  // Opera 15 之后开始使用 Chromniun 内核，需要放在 Chrome 的规则之前。\r\n  [\"opera\", function(ua) {\r\n      var re_opera_old = /\\bopera.+version\\/([0-9.ab]+)/;\r\n      var re_opera_new = /\\bopr\\/([0-9.]+)/;\r\n      return re_opera_old.test(ua) ? re_opera_old : re_opera_new;\r\n  }],\r\n  [\"oupeng\", /\\boupeng\\/([0-9.]+)/],\r\n  [\"yandex\", /yabrowser\\/([0-9.]+)/],\r\n  // 支付宝手机客户端\r\n  [\"ali-ap\", function(ua) {\r\n      if (ua.indexOf(\"aliapp\") > 0) {\r\n      return /\\baliapp\\(ap\\/([0-9.]+)\\)/;\r\n      } else {\r\n      return /\\balipayclient\\/([0-9.]+)\\b/;\r\n      }\r\n  }],\r\n  // 支付宝平板客户端\r\n  [\"ali-ap-pd\", /\\baliapp\\(ap-pd\\/([0-9.]+)\\)/],\r\n  // 支付宝商户客户端\r\n  [\"ali-am\", /\\baliapp\\(am\\/([0-9.]+)\\)/],\r\n  // 淘宝手机客户端\r\n  [\"ali-tb\", /\\baliapp\\(tb\\/([0-9.]+)\\)/],\r\n  // 淘宝平板客户端\r\n  [\"ali-tb-pd\", /\\baliapp\\(tb-pd\\/([0-9.]+)\\)/],\r\n  // 天猫手机客户端\r\n  [\"ali-tm\", /\\baliapp\\(tm\\/([0-9.]+)\\)/],\r\n  // 天猫平板客户端\r\n  [\"ali-tm-pd\", /\\baliapp\\(tm-pd\\/([0-9.]+)\\)/],\r\n  // UC 浏览器，可能会被识别为 Android 浏览器，规则需要前置。\r\n  // UC 桌面版浏览器携带 Chrome 信息，需要放在 Chrome 之前。\r\n  [\"uc\", function(ua) {\r\n      if (ua.indexOf(\"ucbrowser/\") >= 0) {\r\n      return /\\bucbrowser\\/([0-9.]+)/;\r\n      } else if (ua.indexOf(\"ubrowser/\") >= 0) {\r\n      return /\\bubrowser\\/([0-9.]+)/;\r\n      } else if (/\\buc\\/[0-9]/.test(ua)) {\r\n      return /\\buc\\/([0-9.]+)/;\r\n      } else if (ua.indexOf(\"ucweb\") >= 0) {\r\n      // `ucweb/2.0` is compony info.\r\n      // `UCWEB8.7.2.214/145/800` is browser info.\r\n      return /\\bucweb([0-9.]+)?/;\r\n      } else {\r\n      return /\\b(?:ucbrowser|uc)\\b/;\r\n      }\r\n  }],\r\n  [\"chrome\", / (?:chrome|crios|crmo)\\/([0-9.]+)/],\r\n  // Android 默认浏览器。该规则需要在 safari 之前。\r\n  [\"android\", function(ua) {\r\n      if (ua.indexOf(\"android\") === -1) {\r\n      return;\r\n      }\r\n      return /\\bversion\\/([0-9.]+(?: beta)?)/;\r\n  }],\r\n  [\"blackberry\", function(ua) {\r\n      var m = ua.match(re_blackberry_10) ||\r\n      ua.match(re_blackberry_6_7) ||\r\n      ua.match(re_blackberry_4_5);\r\n      return m ? {version: m[1]} : \"blackberry\";\r\n  }],\r\n  [\"safari\", /\\bversion\\/([0-9.]+(?: beta)?)(?: mobile(?:\\/[a-z0-9]+)?)? safari\\//],\r\n  // 如果不能被识别为 Safari，则猜测是 WebView。\r\n  [\"webview\", /\\bcpu(?: iphone)? os (?:[0-9._]+).+\\bapplewebkit\\b/],\r\n  [\"firefox\", /\\bfirefox\\/([0-9.ab]+)/],\r\n  [\"nokia\", /\\bnokiabrowser\\/([0-9.]+)/]\r\n];\r\n// 针对同源的 TheWorld 和 360 的 external 对象进行检测。\r\n// @param {String} key, 关键字，用于检测浏览器的安装路径中出现的关键字。\r\n// @return {Undefined,Boolean,Object} 返回 undefined 或 false 表示检测未命中。\r\nfunction checkTW360External(key) {\r\n  if (!external) {\r\n      return;\r\n  } // return undefined.\r\n  try {\r\n      //        360安装路径：\r\n      //        C:%5CPROGRA~1%5C360%5C360se3%5C360SE.exe\r\n      var runpath = external.twGetRunPath.toLowerCase();\r\n      // 360SE 3.x ~ 5.x support.\r\n      // 暴露的 external.twGetVersion 和 external.twGetSecurityID 均为 undefined。\r\n      // 因此只能用 try/catch 而无法使用特性判断。\r\n      var security = external.twGetSecurityID(win);\r\n      var version = external.twGetVersion(security);\r\n\r\n      if (runpath && runpath.indexOf(key) === -1) {\r\n      return false;\r\n      }\r\n      if (version) {\r\n      return {version: version};\r\n      }\r\n  } catch (ex) { /* */\r\n  }\r\n}\r\n// 解析使用 Trident 内核的浏览器的 `浏览器模式` 和 `文档模式` 信息。\r\n// @param {String} ua, userAgent string.\r\n// @return {Object}\r\nfunction IEMode(ua) {\r\n  if (!re_msie.test(ua)) {\r\n      return null;\r\n  }\r\n\r\n  var m,\r\n      engineMode, engineVersion,\r\n      browserMode, browserVersion;\r\n\r\n  // IE8 及其以上提供有 Trident 信息，\r\n  // 默认的兼容模式，UA 中 Trident 版本不发生变化。\r\n  if (ua.indexOf(\"trident/\") !== -1) {\r\n      m = /\\btrident\\/([0-9.]+)/.exec(ua);\r\n      if (m && m.length >= 2) {\r\n      // 真实引擎版本。\r\n      engineVersion = m[1];\r\n      var v_version = m[1].split(\".\");\r\n      v_version[0] = parseInt(v_version[0], 10) + 4;\r\n      browserVersion = v_version.join(\".\");\r\n      }\r\n  }\r\n\r\n  m = re_msie.exec(ua);\r\n  browserMode = m[1];\r\n  var v_mode = m[1].split(\".\");\r\n  if (typeof browserVersion === \"undefined\") {\r\n      browserVersion = browserMode;\r\n  }\r\n  v_mode[0] = parseInt(v_mode[0], 10) - 4;\r\n  engineMode = v_mode.join(\".\");\r\n  if (typeof engineVersion === \"undefined\") {\r\n      engineVersion = engineMode;\r\n  }\r\n\r\n  return {\r\n      browserVersion: browserVersion,\r\n      browserMode: browserMode,\r\n      engineVersion: engineVersion,\r\n      engineMode: engineMode,\r\n      compatible: engineVersion !== engineMode\r\n  };\r\n}\r\n// UserAgent Detector.\r\n// @param {String} ua, userAgent.\r\n// @param {Object} expression\r\n// @return {Object}\r\n//    返回 null 表示当前表达式未匹配成功。\r\nfunction detect(name, expression, ua) {\r\n  var expr = isFunction(expression) ? expression.call(null, ua) : expression;\r\n  if (!expr) {\r\n      return null;\r\n  }\r\n  var info = {\r\n      name: name,\r\n      version: NA_VERSION,\r\n      codename: \"\"\r\n  };\r\n  var t = toString(expr);\r\n  if (expr === true) {\r\n      return info;\r\n  } else if (t === \"[object String]\") {\r\n      if (ua.indexOf(expr) !== -1) {\r\n      return info;\r\n      }\r\n  } else if (isObject(expr)) { // Object\r\n      if (expr.hasOwnProperty(\"version\")) {\r\n      info.version = expr.version;\r\n      }\r\n      return info;\r\n  } else if (expr.exec) { // RegExp\r\n      var m = expr.exec(ua);\r\n      if (m) {\r\n      if (m.length >= 2 && m[1]) {\r\n          info.version = m[1].replace(/_/g, \".\");\r\n      } else {\r\n          info.version = NA_VERSION;\r\n      }\r\n      return info;\r\n      }\r\n  }\r\n}\r\n\r\nvar na = {name: \"\", version: \"\"};\r\n// 初始化识别。\r\nfunction init(ua, patterns, factory, detector) {\r\n  var detected = na;\r\n  each(patterns, function(pattern) {\r\n      var d = detect(pattern[0], pattern[1], ua);\r\n      if (d) {\r\n      detected = d;\r\n      return false;\r\n      }\r\n  });\r\n  factory.call(detector, detected.name, detected.version);\r\n}\r\n// 解析 UserAgent 字符串\r\n// @param {String} ua, userAgent string.\r\n// @return {Object}\r\nvar parse = function(ua) {\r\n  ua = (ua || \"\").toLowerCase();\r\n  var d = {};\r\n\r\n  init(ua, DEVICES, function(name, version) {\r\n      var v = parseFloat(version);\r\n      d.device = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version\r\n      };\r\n      d.device[name] = v;\r\n  }, d);\r\n\r\n  init(ua, OS, function(name, version) {\r\n      var v = parseFloat(version);\r\n      d.os = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version\r\n      };\r\n      d.os[name] = v;\r\n  }, d);\r\n\r\n  var ieCore = IEMode(ua);\r\n\r\n  init(ua, ENGINE, function(name, version) {\r\n      var mode = version;\r\n      // IE 内核的浏览器，修复版本号及兼容模式。\r\n      if (ieCore) {\r\n      version = ieCore.engineVersion || ieCore.engineMode;\r\n      mode = ieCore.engineMode;\r\n      }\r\n      var v = parseFloat(version);\r\n      d.engine = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version,\r\n      mode: parseFloat(mode),\r\n      fullMode: mode,\r\n      compatible: ieCore ? ieCore.compatible : false\r\n      };\r\n      d.engine[name] = v;\r\n  }, d);\r\n\r\n  init(ua, BROWSER, function(name, version) {\r\n      var mode = version;\r\n      // IE 内核的浏览器，修复浏览器版本及兼容模式。\r\n      if (ieCore) {\r\n      // 仅修改 IE 浏览器的版本，其他 IE 内核的版本不修改。\r\n      if (name === \"ie\") {\r\n          version = ieCore.browserVersion;\r\n      }\r\n      mode = ieCore.browserMode;\r\n      }\r\n      var v = parseFloat(version);\r\n      d.browser = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version,\r\n      mode: parseFloat(mode),\r\n      fullMode: mode,\r\n      compatible: ieCore ? ieCore.compatible : false\r\n      };\r\n      d.browser[name] = v;\r\n  }, d);\r\n  return d;\r\n};\r\n\r\ndetector = parse(userAgent + \" \" + appVersion + \" \" + vendor);\r\n\r\n\r\nexport default detector;","import { CONFIG } from \"./config\";\r\n\r\nimport device from \"./device\";\r\n\r\nimport { base64Encode } from \"./coding\";\r\n\r\nimport detector from \"./useragent\";\r\n\r\n// 兼容单元测试环境\r\nlet win;\r\nif (typeof window === \"undefined\") {\r\n  win = {\r\n    navigator: {\r\n      userAgent: \"\"\r\n    },\r\n    location: {\r\n      pathname: \"\",\r\n      href: \"\"\r\n    },\r\n    document: {\r\n      URL: \"\"\r\n    },\r\n    screen: {\r\n      width: \"\",\r\n      height: \"\"\r\n    }\r\n  };\r\n} else {\r\n  win = window;\r\n}\r\n\r\nconst breaker = {};\r\n\r\nconst _ = {\r\n  each(obj, iterator, context) {\r\n    if (obj === null || obj === undefined) {\r\n      return;\r\n    }\r\n    if (Array.prototype.forEach && obj.forEach === Array.prototype.forEach) {\r\n      obj.forEach(iterator, context);\r\n    } else if (obj.length === +obj.length) {\r\n      for (let i = 0, l = obj.length; i < l; i++) {\r\n        if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\r\n          return;\r\n        }\r\n      }\r\n    } else {\r\n      for (let key in obj) {\r\n        if (obj.hasOwnProperty.call(obj, key)) {\r\n          if (iterator.call(context, obj[key], key, obj) === breaker) {\r\n            return;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  extend(obj) {\r\n    _.each(Array.prototype.slice.call(arguments, 1), function(source) {\r\n      for (let prop in source) {\r\n        if (source[prop] !== void 0) {\r\n          obj[prop] = source[prop];\r\n        }\r\n      }\r\n    });\r\n    return obj;\r\n  },\r\n  isObject(obj) {\r\n    return obj === Object(obj) && !_.isArray(obj);\r\n  },\r\n  isUndefined(obj) {\r\n    return obj === void 0;\r\n  },\r\n  isArguments(obj) {\r\n    return !!(obj && hasOwnProperty.call(obj, \"callee\"));\r\n  },\r\n  toArray(iterable) {\r\n    if (!iterable) {\r\n      return [];\r\n    }\r\n    if (iterable.toArray) {\r\n      return iterable.toArray();\r\n    }\r\n    if (_.isArray(iterable)) {\r\n      return Array.prototype.slice.call(iterable);\r\n    }\r\n    if (_.isArguments(iterable)) {\r\n      return Array.prototype.slice.call(iterable);\r\n    }\r\n    return _.values(iterable);\r\n  },\r\n  values(obj) {\r\n    var results = [];\r\n    if (obj === null) {\r\n      return results;\r\n    }\r\n    _.each(obj, function(value) {\r\n      results[results.length] = value;\r\n    });\r\n    return results;\r\n  },\r\n  // 转化成json\r\n  JSONDecode(string) {\r\n    try {\r\n      return JSON.parse(string);\r\n    } catch (error) {\r\n      return {};\r\n    }\r\n  },\r\n  // json转化为string\r\n  JSONEncode(json) {\r\n    try {\r\n      return JSON.stringify(json);\r\n    } catch (error) {\r\n      return \"\";\r\n    }\r\n  },\r\n  // 判断类型是否为function\r\n  isFunction(fn) {\r\n    let bool = false;\r\n    if (typeof fn === \"function\") {\r\n      bool = true;\r\n    }\r\n    return bool;\r\n  },\r\n  base64Encode(str) {\r\n    return base64Encode(str);\r\n  },\r\n  sha1(str) {\r\n    return \"\";\r\n  },\r\n  // 对象的字段值截取\r\n  truncate(obj, length) {\r\n    let ret;\r\n    if (typeof obj === \"string\") {\r\n      ret = obj.slice(0, length);\r\n    } else if (_.isArray(obj)) {\r\n      ret = [];\r\n      _.each(obj, function(val) {\r\n        ret.push(_.truncate(val, length));\r\n      });\r\n    } else if (_.isObject(obj)) {\r\n      ret = {};\r\n      _.each(obj, function(val, key) {\r\n        ret[key] = _.truncate(val, length);\r\n      });\r\n    } else {\r\n      ret = obj;\r\n    }\r\n    return ret;\r\n  },\r\n  isNumber(obj) {\r\n    return Object.prototype.toString.call(obj) == \"[object Number]\";\r\n  },\r\n  isString(str) {\r\n    return Object.prototype.toString.call(str) == \"[object String]\";\r\n  },\r\n  HTTPBuildQuery(formdata, arg_separator) {\r\n    let use_val,\r\n      use_key,\r\n      tmp_arr = [];\r\n\r\n    if (_.isUndefined(arg_separator)) {\r\n      arg_separator = \"&\";\r\n    }\r\n\r\n    _.each(formdata, function(val, key) {\r\n      use_val = encodeURIComponent(val && val.toString());\r\n      use_key = encodeURIComponent(key);\r\n      tmp_arr[tmp_arr.length] = use_key + \"=\" + use_val;\r\n    });\r\n\r\n    return tmp_arr.join(arg_separator);\r\n  },\r\n  // 删除左右两端的空格\r\n  trim(str) {\r\n    if (!str) return;\r\n    return str.replace(/(^\\s*)|(\\s*$)/g, \"\");\r\n  },\r\n  // 验证yyyy-MM-dd日期格式\r\n  checkTime(timeString) {\r\n    const reg = /^(\\d{4})-(\\d{2})-(\\d{2})$/;\r\n    if (timeString) {\r\n      if (!reg.test(timeString)) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n  },\r\n  // 返回指定url的域名\r\n  // 若不传入url，返回当前网页的域名\r\n  getHost(url) {\r\n    let host = \"\";\r\n    if (!url) {\r\n      url = document.URL;\r\n    }\r\n    const regex = /.*\\:\\/\\/([^\\/]*).*/;\r\n    const match = url.match(regex);\r\n    if (match) {\r\n      host = match[1];\r\n    }\r\n    return host;\r\n  },\r\n  // 获取url上指定参数的值\r\n  getQueryParam(url, param) {\r\n    const target = param.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\r\n    const regexS = \"[\\\\?&]\" + target + \"=([^&#]*)\";\r\n    const regex = new RegExp(regexS);\r\n    const results = regex.exec(url);\r\n    if (\r\n      results === null ||\r\n      (results && typeof results[1] !== \"string\" && results[1].length)\r\n    ) {\r\n      return \"\";\r\n    } else {\r\n      return decodeURIComponent(results[1]).replace(/\\+/g, \" \");\r\n    }\r\n  },\r\n  // 删除对象中空字段\r\n  deleteEmptyProperty(obj) {\r\n    if (!this.isObject(obj)) {\r\n      return;\r\n    }\r\n    for (let key in obj) {\r\n      if (obj.hasOwnProperty(key)) {\r\n        if (\r\n          obj[key] === null ||\r\n          this.isUndefined(obj[key]) ||\r\n          obj[key] === \"\"\r\n        ) {\r\n          delete obj[key];\r\n        }\r\n      }\r\n    }\r\n    return obj;\r\n  }\r\n};\r\n_.isArray =\r\n  Array.isArray ||\r\n  function(obj) {\r\n    return Object.prototype.toString.apply(obj) === \"[object Array]\";\r\n  };\r\n\r\n_.loadScript = function(para) {\r\n  para = _.extend(\r\n    {\r\n      success: function() {},\r\n      error: function() {},\r\n      appendCall: function(g) {\r\n        document.getElementsByTagName(\"head\")[0].appendChild(g);\r\n      }\r\n    },\r\n    para\r\n  );\r\n\r\n  var g = null;\r\n  if (para.type === \"css\") {\r\n    g = document.createElement(\"link\");\r\n    g.rel = \"stylesheet\";\r\n    g.href = para.url;\r\n  }\r\n  if (para.type === \"js\") {\r\n    g = document.createElement(\"script\");\r\n    g.async = \"async\";\r\n    g.setAttribute(\"charset\", \"UTF-8\");\r\n    g.src = para.url;\r\n    g.type = \"text/javascript\";\r\n  }\r\n  g.onload = g.onreadystatechange = function() {\r\n    if (\r\n      !this.readyState ||\r\n      this.readyState === \"loaded\" ||\r\n      this.readyState === \"complete\"\r\n    ) {\r\n      para.success();\r\n      g.onload = g.onreadystatechange = null;\r\n    }\r\n  };\r\n  g.onerror = function() {\r\n    para.error();\r\n    g.onerror = null;\r\n  };\r\n  // if iframe\r\n  para.appendCall(g);\r\n};\r\n\r\n_.register_event = (function() {\r\n  // written by Dean Edwards, 2005\r\n  // with input from Tino Zijdel - crisp@xs4all.nl\r\n  // with input from Carl Sverre - mail@carlsverre.com\r\n  // with input from DATracker\r\n  // http://dean.edwards.name/weblog/2005/10/add-event/\r\n  // https://gist.github.com/1930440\r\n\r\n  /**\r\n   * @param {Object} element\r\n   * @param {string} type\r\n   * @param {function(...[*])} handler\r\n   * @param {boolean=} oldSchool\r\n   * @param {boolean=} useCapture\r\n   */\r\n  var register_event = function(element, type, handler, oldSchool, useCapture) {\r\n    if (!element) {\r\n      console.error(\"No valid element provided to register_event\");\r\n      return;\r\n    }\r\n\r\n    if (element.addEventListener && !oldSchool) {\r\n      element.addEventListener(type, handler, !!useCapture);\r\n    } else {\r\n      var ontype = \"on\" + type;\r\n      var old_handler = element[ontype]; // can be undefined\r\n      element[ontype] = makeHandler(element, handler, old_handler);\r\n    }\r\n  };\r\n\r\n  function makeHandler(element, new_handler, old_handlers) {\r\n    var handler = function(event) {\r\n      event = event || fixEvent(window.event);\r\n\r\n      // this basically happens in firefox whenever another script\r\n      // overwrites the onload callback and doesn't pass the event\r\n      // object to previously defined callbacks.  All the browsers\r\n      // that don't define window.event implement addEventListener\r\n      // so the dom_loaded handler will still be fired as usual.\r\n      if (!event) {\r\n        return undefined;\r\n      }\r\n\r\n      var ret = true;\r\n      var old_result, new_result;\r\n\r\n      if (_.isFunction(old_handlers)) {\r\n        old_result = old_handlers(event);\r\n      }\r\n      new_result = new_handler.call(element, event);\r\n\r\n      if (false === old_result || false === new_result) {\r\n        ret = false;\r\n      }\r\n\r\n      return ret;\r\n    };\r\n\r\n    return handler;\r\n  }\r\n\r\n  function fixEvent(event) {\r\n    if (event) {\r\n      event.preventDefault = fixEvent.preventDefault;\r\n      event.stopPropagation = fixEvent.stopPropagation;\r\n    }\r\n    return event;\r\n  }\r\n  fixEvent.preventDefault = function() {\r\n    this.returnValue = false;\r\n  };\r\n  fixEvent.stopPropagation = function() {\r\n    this.cancelBubble = true;\r\n  };\r\n\r\n  return register_event;\r\n})();\r\n\r\n_.register_hash_event = function(callback) {\r\n  _.register_event(window, \"hashchange\", callback);\r\n};\r\n\r\n// 客户端基本属性\r\n_.info = {\r\n  domain(referrer) {\r\n    const split = referrer.split(\"/\");\r\n    if (split.length >= 3) {\r\n      return split[2];\r\n    }\r\n    return \"\";\r\n  },\r\n  // 设备型号\r\n  deviceModel() {\r\n    let deviceModel = \"\";\r\n    if (device.android()) {\r\n      const sss = win.navigator.userAgent.split(\";\");\r\n      const i = sss.indexOf(\"Build/\");\r\n      if (i > -1) {\r\n        deviceModel = sss[i].substring(0, sss[i].indexOf(\"Build/\"));\r\n      }\r\n    } else if (device.ios()) {\r\n      if (device.iphone()) {\r\n        deviceModel = \"iPhone\";\r\n      }\r\n    }\r\n    return deviceModel;\r\n  },\r\n  properties() {\r\n    const windowsOs = {\r\n      \"5.0\": \"Win2000\",\r\n      \"5.1\": \"WinXP\",\r\n      \"5.2\": \"Win2003\",\r\n      \"6.0\": \"WindowsVista\",\r\n      \"6.1\": \"Win7\",\r\n      \"6.2\": \"Win8\",\r\n      \"6.3\": \"Win8.1\",\r\n      \"10.0\": \"Win10\"\r\n    };\r\n    const devicePlatform = device.type;\r\n    const deviceModel = _.trim(this.deviceModel());\r\n    const isWindows = device.windows();\r\n    let deviceOsVersion = detector.os.name + \" \" + detector.os.fullVersion;\r\n    if (isWindows) {\r\n      if (windowsOs[detector.os.fullVersion]) {\r\n        deviceOsVersion = windowsOs[detector.os.fullVersion];\r\n      }\r\n    }\r\n    return {\r\n      // 设备型号\r\n      deviceModel: deviceModel,\r\n      // 操作系统\r\n      deviceOs: detector.os.name,\r\n      // 操作系统版本\r\n      deviceOsVersion: deviceOsVersion,\r\n      // 设备平台\r\n      devicePlatform: devicePlatform,\r\n      // 浏览器名称\r\n      browser: detector.browser.name,\r\n      // 浏览器版本\r\n      browserVersion: detector.browser.fullVersion,\r\n      // 页面标题\r\n      title: win.document.title || \"\",\r\n      // 页面路径\r\n      urlPath: win.location.pathname || \"\",\r\n      // 页面url\r\n      currentUrl: document.URL,\r\n      // 域名\r\n      currentDomain: this.domain(document.URL),\r\n      // referrer 数据来源\r\n      referrer: win.document.referrer,\r\n      // referrer 域名\r\n      referringDomain: this.domain(win.document.referrer),\r\n      // 本地语言\r\n      language: win.navigator.language || \"\",\r\n      // 客户端分辨率 width\r\n      screenWidth: win.screen.width,\r\n      // 客户端分辨率 height\r\n      screenHeight: win.screen.height\r\n    };\r\n  }\r\n};\r\n\r\n// 消息订阅/推送\r\n_.innerEvent = {\r\n  /**\r\n   * 订阅\r\n   *  */\r\n\r\n  on: function(key, fn) {\r\n    if (!this._list) {\r\n      this._list = {};\r\n    }\r\n    if (!this._list[key]) {\r\n      this._list[key] = [];\r\n    }\r\n    this._list[key].push(fn);\r\n  },\r\n  off: function(key) {\r\n    if (!this._list) {\r\n      this._list = {};\r\n    }\r\n    if (!this._list[key]) {\r\n      return;\r\n    } else {\r\n      delete this._list[key];\r\n    }\r\n  },\r\n  /**\r\n   * 推送\r\n   */\r\n  trigger: function() {\r\n    var args = Array.prototype.slice.call(arguments);\r\n    var key = args[0];\r\n    var arrFn = this._list && this._list[key];\r\n    if (!arrFn || arrFn.length === 0) {\r\n      return;\r\n    }\r\n    for (var i = 0; i < arrFn.length; i++) {\r\n      if (typeof arrFn[i] == \"function\") {\r\n        arrFn[i].apply(this, args);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// 发送数据\r\n_.sendRequest = function(url, type, data, callback) {\r\n  data[\"_\"] = new Date().getTime().toString();\r\n  if (type === \"img\") {\r\n    url += \"?\" + _.HTTPBuildQuery(data);\r\n    let img = document.createElement(\"img\");\r\n    img.src = url;\r\n    img.width = 1;\r\n    img.height = 1;\r\n    if (_.isFunction(callback)) {\r\n      callback(0);\r\n    }\r\n    img.onload = function() {\r\n      this.onload = null;\r\n    };\r\n    img.onerror = function() {\r\n      this.onerror = null;\r\n    };\r\n    img.onabort = function() {\r\n      this.onabort = null;\r\n    };\r\n  } else if (type === \"get\") {\r\n    url += \"?\" + _.HTTPBuildQuery(data);\r\n    _.ajax.get(url, callback);\r\n  } else if (type === \"post\") {\r\n    _.ajax.get(url, data, callback);\r\n  }\r\n};\r\n\r\n_.ajax = {\r\n  post: function(url, options, callback, timeout) {\r\n    var that = this;\r\n    that.callback = callback || function(params) {};\r\n    try {\r\n      var req = new XMLHttpRequest();\r\n      req.open(\"POST\", url, true);\r\n      req.setRequestHeader(\"Content-type\", \"application/json\");\r\n      req.withCredentials = true;\r\n      req.ontimeout = function() {\r\n        that.callback({\r\n          status: 0,\r\n          error: true,\r\n          message: \"request \" + url + \" time out\"\r\n        });\r\n      };\r\n      req.onreadystatechange = function() {\r\n        if (req.readyState === 4) {\r\n          if (req.status === 200) {\r\n            that.callback(_.JSONDecode(req.responseText));\r\n          } else {\r\n            var message =\r\n              \"Bad HTTP status: \" + req.status + \" \" + req.statusText;\r\n            that.callback({ status: 0, error: true, message: message });\r\n          }\r\n        }\r\n      };\r\n      req.timeout = timeout || 5000;\r\n      req.send(_.JSONEncode(options));\r\n    } catch (e) {}\r\n  },\r\n  get: function(url, callback) {\r\n    try {\r\n      var req = new XMLHttpRequest();\r\n      req.open(\"GET\", url, true);\r\n      req.withCredentials = true;\r\n      req.onreadystatechange = function() {\r\n        if (req.readyState === 4) {\r\n          if (req.status === 200) {\r\n            if (callback) {\r\n              callback(req.responseText);\r\n            }\r\n          } else {\r\n            if (callback) {\r\n              var message =\r\n                \"Bad HTTP status: \" + req.status + \" \" + req.statusText;\r\n              callback({ status: 0, error: true, message: message });\r\n            }\r\n          }\r\n        }\r\n      };\r\n      req.send(null);\r\n    } catch (e) {}\r\n  }\r\n};\r\n\r\n// uuid\r\n_.UUID = (function() {\r\n  var T = function() {\r\n    var d = 1 * new Date(),\r\n      i = 0;\r\n    while (d == 1 * new Date()) {\r\n      i++;\r\n    }\r\n    return d.toString(16) + i.toString(16);\r\n  };\r\n  var R = function() {\r\n    return Math.random()\r\n      .toString(16)\r\n      .replace(\".\", \"\");\r\n  };\r\n  var UA = function(n) {\r\n    var ua = navigator.userAgent,\r\n      i,\r\n      ch,\r\n      buffer = [],\r\n      ret = 0;\r\n\r\n    function xor(result, byte_array) {\r\n      var j,\r\n        tmp = 0;\r\n      for (j = 0; j < byte_array.length; j++) {\r\n        tmp |= buffer[j] << (j * 8);\r\n      }\r\n      return result ^ tmp;\r\n    }\r\n\r\n    for (i = 0; i < ua.length; i++) {\r\n      ch = ua.charCodeAt(i);\r\n      buffer.unshift(ch & 0xff);\r\n      if (buffer.length >= 4) {\r\n        ret = xor(ret, buffer);\r\n        buffer = [];\r\n      }\r\n    }\r\n\r\n    if (buffer.length > 0) {\r\n      ret = xor(ret, buffer);\r\n    }\r\n\r\n    return ret.toString(16);\r\n  };\r\n\r\n  return function() {\r\n    // 有些浏览器取个屏幕宽度都异常...\r\n    var se = String(screen.height * screen.width);\r\n    if (se && /\\d{5,}/.test(se)) {\r\n      se = se.toString(16);\r\n    } else {\r\n      se = String(Math.random() * 31242)\r\n        .replace(\".\", \"\")\r\n        .slice(0, 8);\r\n    }\r\n    var val = T() + \"-\" + R() + \"-\" + UA() + \"-\" + se + \"-\" + T();\r\n    if (val) {\r\n      return val;\r\n    } else {\r\n      return (\r\n        String(Math.random()) +\r\n        String(Math.random()) +\r\n        String(Math.random())\r\n      ).slice(2, 15);\r\n    }\r\n  };\r\n})();\r\n\r\n// 存储方法封装 localStorage  cookie\r\n_.localStorage = {\r\n  error: function(msg) {\r\n    console.error(\"localStorage error: \" + msg);\r\n  },\r\n\r\n  get: function(name) {\r\n    try {\r\n      return window.localStorage.getItem(name);\r\n    } catch (err) {\r\n      _.localStorage.error(err);\r\n    }\r\n    return null;\r\n  },\r\n\r\n  parse: function(name) {\r\n    try {\r\n      return _.JSONDecode(_.localStorage.get(name)) || {};\r\n    } catch (err) {\r\n      // noop\r\n    }\r\n    return null;\r\n  },\r\n\r\n  set: function(name, value) {\r\n    try {\r\n      window.localStorage.setItem(name, value);\r\n    } catch (err) {\r\n      _.localStorage.error(err);\r\n    }\r\n  },\r\n\r\n  remove: function(name) {\r\n    try {\r\n      window.localStorage.removeItem(name);\r\n    } catch (err) {\r\n      _.localStorage.error(err);\r\n    }\r\n  }\r\n};\r\n_.cookie = {\r\n  get: function(name) {\r\n    var nameEQ = name + \"=\";\r\n    var ca = document.cookie.split(\";\");\r\n    for (var i = 0; i < ca.length; i++) {\r\n      var c = ca[i];\r\n      while (c.charAt(0) == \" \") {\r\n        c = c.substring(1, c.length);\r\n      }\r\n      if (c.indexOf(nameEQ) === 0) {\r\n        return decodeURIComponent(c.substring(nameEQ.length, c.length));\r\n      }\r\n    }\r\n    return null;\r\n  },\r\n\r\n  parse: function(name) {\r\n    var cookie;\r\n    try {\r\n      cookie = _.JSONDecode(_.cookie.get(name)) || {};\r\n    } catch (err) {\r\n      // noop\r\n    }\r\n    return cookie;\r\n  },\r\n\r\n  set_seconds: function(name, value, seconds, cross_subdomain, is_secure) {\r\n    var cdomain = \"\",\r\n      expires = \"\",\r\n      secure = \"\";\r\n\r\n    if (cross_subdomain) {\r\n      var matches = document.location.hostname.match(\r\n          /[a-z0-9][a-z0-9\\-]+\\.[a-z\\.]{2,6}$/i\r\n        ),\r\n        domain = matches ? matches[0] : \"\";\r\n\r\n      cdomain = domain ? \"; domain=.\" + domain : \"\";\r\n    }\r\n\r\n    if (seconds) {\r\n      var date = new Date();\r\n      date.setTime(date.getTime() + seconds * 1000);\r\n      expires = \"; expires=\" + date.toGMTString();\r\n    }\r\n\r\n    if (is_secure) {\r\n      secure = \"; secure\";\r\n    }\r\n\r\n    document.cookie =\r\n      name +\r\n      \"=\" +\r\n      encodeURIComponent(value) +\r\n      expires +\r\n      \"; path=/\" +\r\n      cdomain +\r\n      secure;\r\n  },\r\n\r\n  set: function(name, value, days, cross_subdomain, is_secure) {\r\n    var cdomain = \"\",\r\n      expires = \"\",\r\n      secure = \"\";\r\n\r\n    if (cross_subdomain) {\r\n      var matches = document.location.hostname.match(\r\n          /[a-z0-9][a-z0-9\\-]+\\.[a-z\\.]{2,6}$/i\r\n        ),\r\n        domain = matches ? matches[0] : \"\";\r\n\r\n      cdomain = domain ? \"; domain=.\" + domain : \"\";\r\n    }\r\n\r\n    if (days) {\r\n      var date = new Date();\r\n      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);\r\n      expires = \"; expires=\" + date.toGMTString();\r\n    }\r\n\r\n    if (is_secure) {\r\n      secure = \"; secure\";\r\n    }\r\n\r\n    var new_cookie_val =\r\n      name +\r\n      \"=\" +\r\n      encodeURIComponent(value) +\r\n      expires +\r\n      \"; path=/\" +\r\n      cdomain +\r\n      secure;\r\n    document.cookie = new_cookie_val;\r\n    return new_cookie_val;\r\n  },\r\n\r\n  remove: function(name, cross_subdomain) {\r\n    _.cookie.set(name, \"\", -1, cross_subdomain);\r\n  }\r\n};\r\n\r\nconst windowConsole = win.console;\r\nconst console = {\r\n  /** @type {function(...[*])} */\r\n  log: function() {\r\n    if (CONFIG.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\r\n      try {\r\n        windowConsole.log.apply(windowConsole, arguments);\r\n      } catch (err) {\r\n        _.each(arguments, function(arg) {\r\n          windowConsole.log(arg);\r\n        });\r\n      }\r\n    }\r\n  },\r\n  /** @type {function(...[*])} */\r\n  error: function() {\r\n    if (CONFIG.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\r\n      var args = [\"DATracker error:\"].concat(_.toArray(arguments));\r\n      try {\r\n        windowConsole.error.apply(windowConsole, args);\r\n      } catch (err) {\r\n        _.each(args, function(arg) {\r\n          windowConsole.error(arg);\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n/**\r\n    字符串加密\r\n    简单的加密方法\r\n  */\r\n_.compile = function(code) {\r\n  let c = String.fromCharCode(code.charCodeAt(0) + code.length);\r\n  for (let i = 1; i < code.length; i++) {\r\n    c += String.fromCharCode(code.charCodeAt(i) + code.charCodeAt(i - 1));\r\n  }\r\n  return c;\r\n};\r\n\r\n/**\r\n    字符串解谜\r\n    对应上面的字符串加密方法\r\n  */\r\n_.uncompile = function(code) {\r\n  let c = String.fromCharCode(code.charCodeAt(0) - code.length);\r\n  for (let i = 1; i < code.length; i++) {\r\n    c += String.fromCharCode(code.charCodeAt(i) - c.charCodeAt(i - 1));\r\n  }\r\n  return c;\r\n};\r\n\r\nexport { _, console };\r\n","import {\r\n  PEOPLE_RESERVED_PROPERTY,\r\n  SYSTEM_EVENT_TYPE,\r\n  PEOPLE_PROPERTY_ID\r\n} from './config'\r\n\r\nimport {_, console} from './utils'\r\n\r\nclass USER_TRACK {\r\n  constructor(instance) {\r\n    this.instance = instance;\r\n    this['local_storage'] = this.instance['local_storage'];\r\n  }\r\n  /**\r\n   * 检测设置的属性是否为系统保留属性\r\n   * @param {String} prop \r\n   */\r\n  _is_reserved_property(prop) {\r\n    return PEOPLE_RESERVED_PROPERTY.indexOf('prop') > -1;\r\n  }\r\n  /**\r\n   * 上报用户属性数据\r\n   * @param {Object} properties \r\n   * @param {Function} callback \r\n   */\r\n  _send_request(properties, callback) {\r\n    if (!_.isFunction(callback)) {\r\n      callback = function() {};\r\n    }\r\n\r\n    properties = properties || {};\r\n    \r\n    let data = {\r\n      dataType: SYSTEM_EVENT_TYPE,\r\n      // 客户端唯一凭证(设备凭证)\r\n      deviceId: this.instance.get_device_id(),\r\n      userId: this.instance.get_property('user_id'),\r\n      // 上报时间\r\n      time: new Date().getTime(),\r\n      // sdk类型 （js，小程序、安卓、IOS、server、pc）\r\n      sdkType: 'js',\r\n      // 属性事件id\r\n      eventId: PEOPLE_PROPERTY_ID,\r\n      // 用户首次访问时间\r\n      persistedTime: this.instance.get_property('persistedTime'),\r\n      // 页面打开场景, 默认 Browser\r\n      pageOpenScene: 'Browser',\r\n      // 自定义用户属性\r\n      attributes: properties\r\n    };\r\n\r\n    // 合并渠道推广信息\r\n    data = _.extend({}, data, this.instance['channel'].get_channel_params());\r\n\r\n    // 上报数据对象字段截取\r\n    const truncateLength = this.instance._get_config('truncateLength');\r\n    let truncated_data = data;\r\n    if (_.isNumber(truncateLength) && truncateLength > 0) {\r\n      truncated_data = _.truncate(data, truncateLength);\r\n    }\r\n\r\n    console.log(JSON.stringify(truncated_data,null,\"  \")); \r\n    const callback_fn = (response) => {\r\n      callback(response, data);\r\n    };\r\n    let url = this.instance._get_config('track_url');\r\n    \r\n    // 数据上报方式\r\n    const track_type = this.instance._get_config('track_type');\r\n    if (track_type === 'img') {\r\n      url += 'track.gif';\r\n    }\r\n    _.sendRequest(\r\n      url, \r\n      track_type, \r\n      { data: _.base64Encode(_.JSONEncode(truncated_data)), token: this.instance._get_config('token') }, \r\n      callback_fn\r\n    );\r\n  }\r\n  /**\r\n   * 设置用户属性\r\n   * @param {*} prop \r\n   * @param {*} to \r\n   * @param {*} callback \r\n   */\r\n  set(prop, to, callback) {\r\n    let set_props = {};\r\n    if (_.isObject(prop)) {\r\n      _.each(prop, (v ,k) => {\r\n        // 不是系统保留属性\r\n        if (!this._is_reserved_property(k)) {\r\n          set_props[k] = v;\r\n        }\r\n      });\r\n      callback = to;\r\n    } else {\r\n      set_props[prop] = to;\r\n    }\r\n    return this._send_request(set_props, callback);\r\n  }\r\n}\r\n\r\nexport default USER_TRACK;","import {\r\n  CONFIG,\r\n  DEFAULT_CONFIG,\r\n  SYSTEM_EVENT_TYPE,\r\n  BUSSINESS_EVENT_TYPE,\r\n  SYSTEM_EVENT_OBJECT\r\n} from \"./config\";\r\n\r\nimport { _, console } from \"./utils\";\r\n\r\nclass EVENT_TRACK {\r\n  constructor(instance) {\r\n    this.instance = instance;\r\n    this[\"local_storage\"] = this.instance[\"local_storage\"];\r\n    // 初始化时间(事件相关)\r\n    this[\"local_storage\"].register_once({\r\n      updatedTime: 0,\r\n      sessionStartTime: 0\r\n    });\r\n    // 将当前的referrer保存到本地缓存\r\n    this[\"local_storage\"].register({\r\n      sessionReferrer: document.referrer\r\n    });\r\n\r\n    let mark_page_url = document.URL;\r\n    // 单页面触发PV事件时，设置 referrer\r\n    _.innerEvent.on(\"singlePage:change\", (eventName, urlParams) => {\r\n      this[\"local_storage\"].register({\r\n        sessionReferrer: mark_page_url\r\n      });\r\n      mark_page_url = document.URL;\r\n    });\r\n  }\r\n  /**\r\n   *\r\n   * 判断是否为其它渠道\r\n   */\r\n  _check_channel() {\r\n    const referrer = this.instance.get_property(\"sessionReferrer\");\r\n    let is_other_channel = false;\r\n    // 若本地缓存的referrer 的host跟当前页不一样，那么可以确定是其它渠道进来的\r\n    if (_.getHost(referrer) !== window.location.host) {\r\n      is_other_channel = true;\r\n    }\r\n    return is_other_channel;\r\n  }\r\n  /**\r\n   * TODO\r\n   * 判断指定事件是否被禁止上报\r\n   * @param {String} event_name\r\n   * @returns {Boolean}\r\n   */\r\n  _event_is_disabled(event_name) {\r\n    return false;\r\n  }\r\n  /**\r\n   * 打开新会话\r\n   */\r\n  _start_new_session() {\r\n    this[\"local_storage\"].register({\r\n      sessionUuid: _.UUID(),\r\n      sessionStartTime: new Date().getTime()\r\n    });\r\n    this.track(\"smart_session_start\");\r\n  }\r\n  /**\r\n   * TODO\r\n   * 关闭当前会话\r\n   */\r\n  _close_cur_session() {\r\n    /*\r\n     为了便于绘制用户事件发生轨迹图，区分会话close和最后一次事件触发时间的顺序，会话关闭时间需要做些微调\r\n     1. 如果本地拿到了上次（非会话事件）事件的触发时间，time = this.instance.get_property('LASTEVENT').time + 1;\r\n     2. 如果未拿到，time = new Date().getTime() - 1;\r\n    */\r\n    let time = new Date().getTime() - 1;\r\n    const sessionStartTime = this.instance.get_property(\"sessionStartTime\");\r\n    const LASTEVENT = this.instance.get_property(\"LASTEVENT\");\r\n    if (LASTEVENT && LASTEVENT.time) {\r\n      time = LASTEVENT.time + 1;\r\n    }\r\n    const sessionTotalLength = time - sessionStartTime;\r\n    if (sessionTotalLength >= 0) {\r\n      this.track(\"smart_session_close\", {\r\n        sessionCloseTime: time,\r\n        sessionTotalLength: sessionTotalLength\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * 判断会话重新开启\r\n   * 判断条件：会话首次开始、指定的一段时间内用户无事件操作、其它渠道进来\r\n   */\r\n  _session(callback) {\r\n    const session_start_time =\r\n      (1 * this.instance.get_property(\"sessionStartTime\")) / 1000;\r\n    const updated_time = (1 * this.instance.get_property(\"updatedTime\")) / 1000;\r\n    const now_date_time_ms = new Date().getTime();\r\n    const now_date_time_se = (1 * now_date_time_ms) / 1000;\r\n    // 其它渠道判断\r\n    const other_channel_Bool = this._check_channel();\r\n    //会话结束判断\r\n    if (\r\n      session_start_time === 0 ||\r\n      now_date_time_se >\r\n        updated_time +\r\n          60 * this.instance._get_config(\"session_interval_mins\") ||\r\n      other_channel_Bool\r\n    ) {\r\n      // 当会话首次开始时，不用发送会话关闭事件\r\n      if (session_start_time === 0) {\r\n        // 新打开一个会话\r\n        this._start_new_session();\r\n      } else {\r\n        this._close_cur_session();\r\n        this._start_new_session();\r\n      }\r\n    }\r\n    // 更新本地的最后事件操作时间\r\n    this[\"local_storage\"].register({\r\n      updatedTime: now_date_time_ms\r\n    });\r\n    // 执行回调方法\r\n    if (_.isFunction(callback)) {\r\n      callback();\r\n    }\r\n  }\r\n  /**\r\n   * 用户注册\r\n   * @param {String} user_id\r\n   */\r\n  _signup(user_id) {\r\n    // 默认是空值,若有值则调用退出\r\n    const anonymous_id = this.instance.get_property(\"userId\");\r\n    if (anonymous_id !== user_id) {\r\n      if (anonymous_id) {\r\n        this.logout();\r\n      }\r\n      this.track(\"smart_u_signup\", {\r\n        anonymousId: anonymous_id,\r\n        newUserId: user_id\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * 设置一个指定事件的耗时监听器\r\n   * @param {String} event_name\r\n   */\r\n  time_event(event_name) {\r\n    if (_.isUndefined(event_name)) {\r\n      console.error(\"事件耗时监听器需要一个事件名称\");\r\n      return;\r\n    }\r\n    // 被禁止的事件，无需监听\r\n    if (this._event_is_disabled(event_name)) {\r\n      return;\r\n    }\r\n    this[\"local_storage\"].set_event_timer(event_name, new Date().getTime());\r\n  }\r\n  /**\r\n   * 发送PV事件，在此之前检测session\r\n   * @param {Object} properties  pv属性\r\n   * @param {*} callback\r\n   */\r\n  track_pv(properties, callback) {\r\n    this._session(() => {\r\n      this.track(\"smart_pv\", _.extend({}, properties), callback);\r\n    });\r\n  }\r\n  /**\r\n   * 追踪事件（上报用户事件触发数据）\r\n   * @param {String} event_name 事件名称（必须）\r\n   * @param {Object} properties 事件属性\r\n   * @param {Function} callback 上报后的回调方法\r\n   * @param {String} event_type 自定义事件类型\r\n   * @returns {Object} track_data 上报的数据\r\n   */\r\n  track(event_name, properties, callback, event_type) {\r\n    if (_.isUndefined(event_name)) {\r\n      console.error(\"上报数据需要一个事件名称\");\r\n      return;\r\n    }\r\n    if (!_.isFunction(callback)) {\r\n      callback = function() {};\r\n    }\r\n    if (this._event_is_disabled(event_name)) {\r\n      callback(0);\r\n      return;\r\n    }\r\n    // 重新在本地取数据读取到缓存\r\n    this[\"local_storage\"].load();\r\n    // 事件属性\r\n    properties = properties || {};\r\n    // 标记：传入的属性另存一份\r\n    let user_set_properties = _.JSONDecode(_.JSONEncode(properties)) || {};\r\n    let costTime;\r\n    // 移除该事件的耗时监听器，获取设置监听器的时间戳，计算耗时\r\n    const start_listen_timestamp = this[\"local_storage\"].remove_event_timer(\r\n      event_name\r\n    );\r\n    if (!_.isUndefined(start_listen_timestamp)) {\r\n      costTime = new Date().getTime() - start_listen_timestamp;\r\n    }\r\n    // 事件类型设置\r\n    let data_type = BUSSINESS_EVENT_TYPE;\r\n    // 事件类型设置为传入了自定义事件类型\r\n    if (event_type) {\r\n      data_type = event_type;\r\n    }\r\n    // 如果是内置事件,事件类型重新设置\r\n    else if (SYSTEM_EVENT_OBJECT[event_name]) {\r\n      data_type = SYSTEM_EVENT_OBJECT[event_name].data_type;\r\n    }\r\n\r\n    // 事件触发时间\r\n    let time = new Date().getTime();\r\n    // 会话有时间差\r\n    // 触发的事件若是会话结束，触发时间要重新设置\r\n    // 若事件id为会话关闭，需要删除传入的自定义属性\r\n    if (event_name === \"smart_session_close\") {\r\n      time = properties.sessionCloseTime;\r\n      delete user_set_properties[\"sessionCloseTime\"];\r\n      delete user_set_properties[\"sessionTotalLength\"];\r\n    }\r\n\r\n    // 设置通用的事件属性\r\n    user_set_properties = _.extend(\r\n      {},\r\n      this.instance.get_property(\"superProperties\"),\r\n      user_set_properties\r\n    );\r\n\r\n    // 上报数据\r\n    let data = {\r\n      dataType: data_type,\r\n      userId: this.instance.get_property(\"userId\"),\r\n      // sdk类型 （js，小程序、安卓、IOS、server、pc）\r\n      sdkType: \"js\",\r\n      sdkVersion: CONFIG.LIB_VERSION,\r\n      // 事件名称\r\n      eventId: event_name,\r\n      // 事件触发时间\r\n      time: time,\r\n      // 用户首次访问时间\r\n      persistedTime: this.instance.get_property(\"persistedTime\"),\r\n      // 客户端唯一凭证(设备凭证)\r\n      deviceId: this.instance.get_device_id(),\r\n      // 页面打开场景, 默认 Browser\r\n      pageOpenScene: \"Browser\",\r\n      // 应用凭证\r\n      token: this.instance._get_config(\"token\"),\r\n      costTime: costTime,\r\n      // 当前关闭的会话时长\r\n      sessionTotalLength: properties.sessionTotalLength,\r\n      // 当前会话id\r\n      sessionUuid: this.instance.get_property(\"sessionUuid\"),\r\n      // 事件自定义属性\r\n      attributes: user_set_properties\r\n    };\r\n    // 合并客户端信息\r\n    data = _.extend({}, data, _.info.properties());\r\n\r\n    // 合并渠道推广信息\r\n    data = _.extend({}, data, this.instance[\"channel\"].get_channel_params());\r\n\r\n    //只有已访问页面后，sessionReferrer 重置\r\n    //如果不是内置事件，那么 sessionReferrer 重置\r\n    //如果是'da_activate'，那么 sessionReferrer 重置\r\n    //解决referrer 当是外链时，此时触发自定义事件，引起重启一个session问题。\r\n    if (data_type === BUSSINESS_EVENT_TYPE) {\r\n      // 其它渠道\r\n      if (this._check_channel()) {\r\n        this[\"local_storage\"].register({\r\n          sessionReferrer: document.URL\r\n        });\r\n      }\r\n    }\r\n    if (!this.instance._get_config(\"SPA\").is) {\r\n      if ([\"smart_activate\", \"smart_session_close\"].indexOf(event_name) > 0) {\r\n        this[\"local_storage\"].register({\r\n          sessionReferrer: document.URL\r\n        });\r\n      }\r\n    }\r\n\r\n    // 当启动单页面后，切换页面，refer为空，此时做处理\r\n    if (this.instance._get_config(\"SPA\").is) {\r\n      const sessionReferrer = this.instance.get_property(\"sessionReferrer\");\r\n      if (sessionReferrer !== data[\"referrer\"]) {\r\n        data[\"referrer\"] = sessionReferrer;\r\n        data[\"referringDomain\"] = _.info.domain(sessionReferrer);\r\n      }\r\n    }\r\n\r\n    // 上报数据对象字段截取\r\n    const truncateLength = this.instance._get_config(\"truncateLength\");\r\n    let truncated_data = data;\r\n    if (_.isNumber(truncateLength) && truncateLength > 0) {\r\n      truncated_data = _.truncate(data, truncateLength);\r\n    }\r\n\r\n    console.log(JSON.stringify(truncated_data, null, \"  \"));\r\n\r\n    const callback_fn = response => {\r\n      callback(response, data);\r\n    };\r\n    let url = this.instance._get_config(\"track_url\");\r\n    const track_type = this.instance._get_config(\"track_type\");\r\n    if (track_type === \"img\") {\r\n      url += \"track.gif\";\r\n    }\r\n    if (\r\n      !this.instance._get_config(\"isBpoint\") ||\r\n      (user_set_properties &&\r\n        user_set_properties.smartConfig &&\r\n        !user_set_properties.smartConfig.isBpoint)\r\n    ) {\r\n      _.sendRequest(\r\n        url,\r\n        track_type,\r\n        {\r\n          data: _.base64Encode(_.JSONEncode(truncated_data)),\r\n          token: this.instance._get_config(\"token\")\r\n        },\r\n        callback_fn\r\n      );\r\n    } else {\r\n      try {\r\n        this.instance[\"bpoint\"].push(truncated_data);\r\n      } catch (error) {\r\n        _.sendRequest(\r\n          url,\r\n          track_type,\r\n          {\r\n            data: _.base64Encode(_.JSONEncode(truncated_data)),\r\n            token: this.instance._get_config(\"token\")\r\n          },\r\n          callback_fn\r\n        );\r\n      }\r\n    }\r\n\r\n    // 当触发的事件不是这些事件(smart_session_start,smart_session_close,smart_activate)时，触发检测 session 方法\r\n    if (\r\n      [\"smart_session_start\", \"smart_session_close\", \"smart_activate\"].indexOf(\r\n        event_name\r\n      ) === -1\r\n    ) {\r\n      this._session();\r\n    }\r\n\r\n    // 保存最后一次用户触发事件（除了会话事件以外）的事件id以及时间，通过这个时间确定会话关闭时的时间\r\n    if (\r\n      [\"smart_session_start\", \"smart_session_close\"].indexOf(event_name) === -1\r\n    ) {\r\n      this[\"local_storage\"].register({\r\n        LASTEVENT: {\r\n          eventId: event_name,\r\n          time: time\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * 用户登录和注册时调用\r\n   * @param {String} user_id\r\n   */\r\n  login(user_id) {\r\n    this._signup(user_id);\r\n    this[\"local_storage\"].register({ userId: user_id });\r\n    this.track(\"smart_u_login\");\r\n  }\r\n  // 清除本地用户信息，退出用户（选则调用）\r\n  logout() {\r\n    this[\"local_storage\"].unregister(\"userId\");\r\n    this.track(\"smart_u_logout\");\r\n  }\r\n}\r\n\r\nexport default EVENT_TRACK;\r\n","import {_, console} from './utils';\r\n\r\n\r\nclass LOCAL_STORAGE {\r\n  /**\r\n   * \r\n   * @param {Object} config\r\n   */\r\n  constructor(config) {\r\n    const local_storage = config['local_storage'];\r\n    if (_.isObject(local_storage)) {\r\n      this['name'] = local_storage['name'] || ('smart_' + config['token'] + '_sdk');\r\n      let storage_type = local_storage['type'] || 'cookie';\r\n\r\n      // 判断是否支持 localStorage\r\n      const localStorage_supported = () => {\r\n        let supported = true;\r\n        try {\r\n          let key = '__smartssupport__',\r\n          val = 'smart_web_data_sdk';\r\n          _.localStorage.set(key, val);\r\n          if (_.localStorage.get(key) !== val) {\r\n              supported = false;\r\n          }\r\n          _.localStorage.remove(key);\r\n        } catch (error) {\r\n          supported = false;\r\n        }\r\n        if (!supported) {\r\n          console.error('localStorage 不支持，自动退回到cookie存储方式');\r\n        }\r\n        return supported;\r\n      };\r\n\r\n      if (storage_type === 'localStorage' && localStorage_supported()) {\r\n        this['storage'] = _.localStorage;\r\n      } else {\r\n        this['storage'] = _.cookie;\r\n      }\r\n      \r\n      this.load();\r\n      this.update_config(local_storage);\r\n      // TODO: upgrade\r\n      this.upgrade();\r\n      this.save();\r\n    } else {\r\n      console.error('local_storage配置设置错误');\r\n    }\r\n  }\r\n  // 加载本地存储信息\r\n  load() {\r\n    const localData = this['storage'].parse(this['name']);\r\n    if (localData) {\r\n      this['props'] = _.extend({}, localData);\r\n    }\r\n  }\r\n  // 更新配置信息\r\n  update_config(localStorageConfig) {\r\n    // 到期时间(cookie存储设置有效)\r\n    this.default_expiry = this.expire_days = localStorageConfig['cookie_expiration'];\r\n    this.set_disabled(localStorageConfig['disable']);\r\n    this.set_cross_subdomain(localStorageConfig['cross_subdomain_cookie']);\r\n    this.set_secure(localStorageConfig['secure_cookie']);\r\n  }\r\n  // 设置关闭本地保存操作，设置为关闭后，本地数据移除\r\n  set_disabled(disabled) {\r\n    this.disabled = disabled;\r\n    if (this.disabled) {\r\n      this.remove();\r\n    }\r\n  }\r\n  // 移除本地数据\r\n  remove() {\r\n    // cookie存储时，移除二级域以及子域下的cookie,此时参数有两个\r\n    this.storage.remove(this.name, false);\r\n    this.storage.remove(this.name, true);\r\n  }\r\n  // 清除存储的数据\r\n  clear() {\r\n    this.remove();\r\n    this['props'] = {};\r\n  }\r\n  /**\r\n   * 跨子域设置,cookie存储方式下有效\r\n   * @param {Boolean} cross_subdomain \r\n   */\r\n  set_cross_subdomain(cross_subdomain) {\r\n    if (cross_subdomain !== this.cross_subdomain) {\r\n      this.cross_subdomain = cross_subdomain;\r\n      this.remove();\r\n      this.save();\r\n    }\r\n  }\r\n  /**\r\n   * cookie存储方式下有效\r\n   * cookie存储时，采用安全的方式存储数据，调用该方法后，重新保存数据\r\n   * 当secure属性设置为true时，cookie只有在https协议下才能上传到服务器，\r\n   * 而在http协议下是没法上传的，所以也不会被窃听\r\n   * @param {Boolean} secure \r\n   */\r\n  set_secure(secure) {\r\n    if (secure !== this.secure) {\r\n      this.secure = secure ? true : false;\r\n      this.remove();\r\n      this.save();\r\n    }\r\n  }\r\n  // sdk升级，旧的sdk存储数据移到新的sdk存储数据中，然后删除旧的存储数据（暂不实现）\r\n  // 存储方式改变，改为cookie切换到 localStorage\r\n  upgrade(config) {\r\n    let old_cookie;\r\n    if (this.storage === _.localStorage) {\r\n      old_cookie = _.cookie.parse(this.name);\r\n      _.cookie.remove(this.name);\r\n      _.cookie.remove(this.name, true);\r\n\r\n      if (old_cookie) {\r\n        this.register_once(old_cookie);\r\n      }\r\n    }\r\n  }\r\n  // 数据保存到本地\r\n  save() {\r\n    // disabled配置为true, 数据不保存到本地\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n    this.storage.set(\r\n      this['name'],\r\n      _.JSONEncode(this['props']),\r\n      this.expire_days,\r\n      this.cross_subdomain,\r\n      this.secure\r\n    );\r\n  }\r\n  /**\r\n   * 缓存指定的数据，同时将该数据保存到本地\r\n   * @param {Object} props \r\n   * @param {Number} days\r\n   * @returns {Boolean} 返回true表示成功\r\n   */\r\n  register(props, days) {\r\n    if (_.isObject(props)) {\r\n      this.expire_days = ( typeof days === 'undefined' ) ? this.default_expiry : days;\r\n      _.extend(this['props'], props);\r\n      this.save();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * 只缓存一次指定的数据，下次设置该数据时不会覆盖前一次数据\r\n   * 若想更新已设置的属性值，那么default_value参数值要等于本地缓存数据中需重置的属性的值(默认值)\r\n   * this['props'][prop] === default_value   prop为需更新的属性\r\n   * @param {Object} props\r\n   * @param {*} default_value\r\n   * @param {Number} days\r\n   * @returns {Boolean} 返回true表示成功\r\n   */\r\n  register_once(props, default_value, days) {\r\n    if (_.isObject(props)) {\r\n      if (typeof default_value === 'undefined') {\r\n        default_value = 'None';\r\n      }\r\n      this.expire_days = ( typeof days === 'undefined' ) ? this.default_expiry : days;\r\n\r\n      _.each(props, function(val, prop) {\r\n        if (!this['props'][prop] || this['props'][prop] === default_value) {\r\n          this['props'][prop] = val;\r\n        }\r\n      }, this);\r\n\r\n      this.save();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * 移除指定的缓存数据，同时也清除本地的对应数据\r\n   * @param {string} prop\r\n   */\r\n  unregister(prop) {\r\n    if (prop in this['props']) {\r\n      delete this['props'][prop];\r\n      this.save();\r\n    }\r\n  }\r\n  /**\r\n   * 设置一个事件计时器，记录用户触发指定事件需要的时间，同时保存到本地\r\n   * @param {String} event_name 该计时器的名称\r\n   * @param {Date} timestamp 该计时器开始时间戳\r\n   */\r\n  set_event_timer(event_name, timestamp) {\r\n    const timers = this['props']['costTime'] || {};\r\n    timers[event_name] = timestamp;\r\n    this['props']['costTime'] = timers;\r\n    this.save();\r\n  }\r\n  /**\r\n   * 移除指定计时器，同时将本地存储的该计时器信息清除\r\n   * @param {String} event_name\r\n   * @returns {Date} 返回移除该计时器的时间戳\r\n   */\r\n  remove_event_timer(event_name) {\r\n    const timers = this['props']['costTime'] || {};\r\n    const timestamp = timers[event_name];\r\n    if (!_.isUndefined(timestamp)) {\r\n      delete this['props']['costTime'][event_name];\r\n      this.save();\r\n    }\r\n    return timestamp;\r\n  }\r\n};\r\n\r\nexport default LOCAL_STORAGE;","/**\r\n * 单页面模块\r\n */\r\nimport {_} from './utils'\r\n\r\nfunction on(obj, event, callFn) {\r\n  if(obj[event]) {\r\n    const fn = obj[event];\r\n    obj[event] = function() {\r\n      const args = Array.prototype.slice.call(arguments);\r\n      callFn.apply(this, args);\r\n      fn.apply(this, args);\r\n    };\r\n  } else {\r\n    obj[event] = function() {\r\n      const args = Array.prototype.slice.call(arguments);\r\n      callFn.apply(this, args);\r\n    };\r\n  }\r\n}\r\n\r\nfunction getPath() {\r\n  return location.pathname + location.search;\r\n}\r\n\r\nconst SPA = {\r\n  config: {\r\n    mode: 'hash',\r\n    track_replace_state: false,\r\n    callback_fn: () => {}\r\n  },\r\n  init(config) {\r\n    this.config = _.extend(this.config, config || {});\r\n    this.path = getPath();\r\n    this.url= document.URL;\r\n    this.event();\r\n  },\r\n  event() {\r\n    if(this.config.mode === 'history') {\r\n      if(!history.pushState || !window.addEventListener) return;\r\n      on(history, 'pushState', this.pushStateOverride.bind(this) );\r\n      on(history, 'replaceState', this.replaceStateOverride.bind(this) );\r\n      window.addEventListener('popstate', this.handlePopState.bind(this));\r\n    } else if(this.config.mode === 'hash') {\r\n      _.register_hash_event( this.handleHashState.bind(this) );\r\n    }\r\n  },\r\n  pushStateOverride(){\r\n    this.handleUrlChange(true);\r\n  },\r\n  replaceStateOverride() {\r\n    this.handleUrlChange(false);\r\n  },\r\n  handlePopState() {\r\n    this.handleUrlChange(true);\r\n  },\r\n  handleHashState() {\r\n    this.handleUrlChange(true);\r\n  },\r\n  handleUrlChange(historyDidUpdate) {\r\n    setTimeout(() => {\r\n      if(this.config.mode === 'hash') {\r\n        if(_.isFunction(this.config.callback_fn)) {\r\n          this.config.callback_fn.call();\r\n          _.innerEvent.trigger('singlePage:change', {\r\n            oldUrl: this.url,\r\n            nowUrl: document.URL\r\n          });\r\n          this.url = document.URL;\r\n        }\r\n      } else if( this.config.mode === 'history' ) {\r\n        const oldPath = this.path;\r\n        const newPath = getPath();\r\n        if(oldPath != newPath && this.shouldTrackUrlChange(newPath, oldPath)) {\r\n          this.path = newPath;\r\n          if(historyDidUpdate || this.config.track_replace_state) {\r\n            if(typeof this.config.callback_fn === 'function') {\r\n              this.config.callback_fn.call();\r\n              _.innerEvent.trigger('singlePage:change', {\r\n                oldUrl: this.url,\r\n                nowUrl: document.URL\r\n              });\r\n              this.url = document.URL;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }, 0);\r\n  },\r\n  shouldTrackUrlChange(newPath, oldPath) {\r\n    return !!(newPath && oldPath);\r\n  }\r\n};\r\n\r\nexport default SPA;\r\n","import {\r\n  CHANNEL_PARAMS\r\n} from './config'\r\n\r\nimport {_} from './utils'\r\n\r\nclass CHANNEL {\r\n  constructor(instance) {\r\n    this.instance = instance;\r\n    // 渠道推广的参数信息\r\n    this.channel_params = {};\r\n    this.cookie_name = 'smart_' + this.instance._get_config('token') + '_c';\r\n    this._set_channel_params();\r\n  }\r\n  // 转变参数(TODO)\r\n  _change() {\r\n\r\n  }\r\n  // 从url 或 本地cookie 拿取推广信息\r\n  _set_channel_params() {\r\n    // 从url上拿取，此时还需保存到本地cookie\r\n    if (this._check_chennel()) {\r\n      this.channel_params = this._url_channel_params();\r\n      this._save();\r\n    } else {\r\n     // 从本地cookie拿取\r\n     const cookie = _.cookie.get(this.cookie_name);\r\n     if (cookie) {\r\n      this.channel_params = _.JSONDecode(cookie);\r\n     }\r\n    }\r\n  }\r\n  // 得到url上推广的参数信息\r\n  _url_channel_params() {\r\n    const channel_keywords = 'utm_source utm_medium utm_campaign utm_content utm_term promotional_id'.split(' ');\r\n    let val = '';\r\n    const params = {};\r\n    _.each(channel_keywords, function(key) {\r\n      val = _.getQueryParam(document.URL, key);\r\n      if (val) {\r\n        params[key] = val;\r\n      }\r\n    });\r\n    return params;\r\n  }\r\n  // 检测是否为渠道推广\r\n  _check_chennel() {\r\n    const params = this._url_channel_params();\r\n    let is_channel = false;\r\n    if (params.utm_source && params.utm_medium && params.utm_campaign && params.promotional_id) {\r\n      is_channel = true;\r\n    }\r\n    return is_channel;\r\n  }\r\n  // 将推广参数值保存到客户端本地的cookie，30天后失效\r\n  _save() {\r\n    if (this._check_chennel()) {\r\n      _.cookie.set(\r\n        this.cookie_name, \r\n        _.JSONEncode(this.channel_params), \r\n        30, \r\n        this.instance._get_config('local_storage').cross_subdomain_cookie\r\n      );\r\n    }\r\n  }\r\n  // 检测是否要上报广告点击事件\r\n  // 条件： 1. 必须是渠道推广；2. 必须有 referrer；3. 当前打开的页面url必须是对外推广的url（有短链和长链）, 表现为当前url上的参数无 t_re(turn_redirect) 字段值；\r\n  // 其它说明：一般情况下对外推广的链接是短链（不一定跟落地页域名一致），但有些渠道不支持，那么只能使用长链（落地页url+ 推广参数）\r\n  check_ad_click() {\r\n    let is_ad_click = false;\r\n    const t_re =  _.getQueryParam(document.URL, 't_re');\r\n    if (this._check_chennel()) {\r\n      if (document.referrer && !t_re) {\r\n        is_ad_click = true;\r\n      }\r\n    }\r\n    return is_ad_click;\r\n  }\r\n  // 返回参数\r\n  get_channel_params() {\r\n    this._set_channel_params();\r\n    const params = {\r\n      utmSource: this.channel_params.utm_source,\r\n      utmMedium: this.channel_params.utm_medium,\r\n      promotionalID: this.channel_params.promotional_id,\r\n      utmCampaign: this.channel_params.utm_campaign,\r\n      utmContent: this.channel_params.utm_content,\r\n      utmTerm: this.channel_params.utm_term\r\n    };\r\n    return _.deleteEmptyProperty(params);\r\n  }\r\n}\r\n\r\nexport default CHANNEL;","import { CHANNEL_PARAMS, CONFIG } from \"./config\";\nimport { _, console } from \"./utils\";\n\nclass BPOINT {\n  constructor(instance) {\n    this.instance = instance;\n    this._infoStack = []; //信息存储栈 收集的信息将暂存到这里 等待打包移动到待发送队列\n\n    this._waitSendQueue = []; //待发送队列，存储多个信息存储栈帧 等待被发送给后台\n\n    this._queueSending = false; //是否在队列递归发送栈帧\n\n    this._scanStackIntervalId = null; //stack 扫描定时器的id\n\n    this._scanWaitSendQqueueIntervalId = null; //WaitSendQqueue 扫描定时器的id\n    this._loadFN = []; //用于存储调用者需要在插件load时的执行的fn\n  }\n  /**\n   * 上一个页面的历史数据提交\n   * @private\n   */\n  _oldDataCheck() {\n    var oldData = _.localStorage.get(\"_bp_wqueue\");\n    if (oldData != null && oldData != \"\") {\n      try {\n        oldData = eval(\"(\" + oldData + \")\");\n        if (_.isArray(oldData) && oldData.length > 0) {\n          var sendData = {};\n          sendData = _.localStorage.set(\"_bp_infoConf\");\n          sendData = eval(\"(\" + sendData + \")\");\n\n          for (; oldData.length > 0; ) {\n            sendData = oldData.pop();\n            //数据发送\n            //发送栈帧+环境配置信息\n            this._sendByImg(sendData);\n          }\n        }\n      } catch (e) {}\n\n      _.localStorage.remove(\"_bp_wqueue\");\n    }\n  }\n  /**\n   * 扫描信息栈中是否有数据 有数据 则将数据栈移入队列\n   * @param t\n   * @private\n   */\n  _scanStack(t) {\n    if (t != null && t >= 1) {\n      if (this._scanStackIntervalId != null) {\n        //如果已经存在定时器 需要先删除此定时，再创建新的定时器，防止出现重复定时器创建，最终导致内存泄露\n        clearInterval(this._scanStackIntervalId);\n      }\n      this._scanStackIntervalId = setInterval(() => {\n        this.stack2queue();\n      }, t * 1000);\n    } else {\n      console.log(\"埋点内置对象丢失,栈扫描器创建失败\", 1);\n      throw new ReferenceError(\"埋点内置对象丢失,栈扫描器创建失败\");\n    }\n  }\n  _scanWaitSendQqueue(t) {\n    if (t != null && t >= 1) {\n      if (this._scanWaitSendQqueueIntervalId != null) {\n        //如果已经存在定时器 需要先删除此定时，再创建新的定时器，防止出现重复定时器创建，最终导致内存泄露\n        clearInterval(this._scanWaitSendQqueueIntervalId);\n      }\n      this._scanWaitSendQqueueIntervalId = setInterval(() => {\n        console.log(\"开启等待发送--scanWaitSendQqueue\");\n        this.send();\n      }, t * 1000);\n    } else {\n      console.log(\"埋点内置对象丢失,队列扫描器创建失败\", 1);\n      throw new ReferenceError(\"埋点内置对象丢失,队列扫描器创建失败\");\n    }\n  }\n  /**\n   * 发送队列里最老的栈帧\n   */\n  sendOldestStack() {\n    var stack = this._waitSendQueue.pop();\n    if (_.localStorage) {\n      _.localStorage.set(\"_bp_wqueue\", JSON.stringify(this._waitSendQueue));\n    }\n\n    console.log(\"send stack(queue pop):\");\n\n    var sendData = {};\n    sendData = stack;\n\n    //数据发送\n    //发送栈帧+环境配置信息\n    this._sendByImg(sendData);\n  }\n  _sendByImg(truncated_data) {\n    console.log(\"truncated_data\", truncated_data);\n    let url = this.instance._get_config(\"track_url\");\n    const track_type = this.instance._get_config(\"track_type\");\n    if (track_type === \"img\") {\n      url += \"track.gif\";\n    }\n    _.sendRequest(\n      url,\n      track_type,\n      {\n        data: _.base64Encode(_.JSONEncode(truncated_data)),\n        token: this.instance._get_config(\"token\")\n      },\n      () => {}\n    );\n  }\n  /**\n   * 设置存在埋点信息的栈的大小\n   * 调用此方法，如果栈的数据量>stackSize，则触发栈帧入待发送队列\n   * @param stackSize 栈的大小 大于0的整数 如果是小数或者字符串，将先使用parseInt处理\n   */\n  setStackSize(stackSize) {\n    stackSize = parseInt(stackSize);\n    if (stackSize < 1) {\n      return;\n    }\n    this._option.stackSize = stackSize;\n\n    if (this._infoStack.length >= stackSize) {\n      // 如果已经满了 则送入待发送队列\n      this.stack2queue();\n    }\n  }\n\n  /**\n   * 栈帧入队列  等待被发送\n   */\n  stack2queue() {\n    console.log(\"开始扫描--scanStack\");\n    var is = this._infoStack;\n    // if (window._sxfmt && window._sxfmt.length > 0) {\n    //   console.log(\"_sxfmt.length=\" + _sxfmt.length);\n    //   console.log(_sxfmt);\n    //   is = is.concat(_sxfmt);\n    //   window._sxfmt = [];\n    // }\n\n    console.log(\"infoStack length=\" + is.length);\n    if (is.length > 0) {\n      console.log(is);\n\n      this._queueSave(is);\n      this._infoStack = [];\n    } else {\n      console.log(\"关闭扫描--_scanStackInterval\");\n      clearInterval(this._scanStackIntervalId);\n    }\n  }\n  _queueSave(is) {\n    this._waitSendQueue.push(is);\n\n    if (_.localStorage) {\n      _.localStorage.set(\"_bp_wqueue\", JSON.stringify(this._waitSendQueue));\n    }\n  }\n  _stackSave(infoObj) {\n    this._infoStack.push(infoObj);\n    //检查信息栈是否已经满了\n    if (this._infoStack.length >= CONFIG.stackSize) {\n      // 如果已经满了 则送入待发送队列\n      this.stack2queue();\n    }\n  }\n  send() {\n    if (this._waitSendQueue.length == 0 || this._queueSending) {\n      return;\n    }\n\n    this._send();\n  }\n  /**\n   * 将队列的栈帧都间隔递归发送出去\n   */\n  _send() {\n    console.log(\"start send\");\n    console.log(\"waitSendQueue length=\" + this._waitSendQueue.length);\n    if (this._waitSendQueue.length == 0) {\n      console.log(\"关闭等待发送--_scanWaitSendQqueueInterval\");\n      clearInterval(this._scanWaitSendQqueueIntervalId);\n      this._queueSending = false;\n      return;\n    }\n\n    this._queueSending = true;\n    setTimeout(() => {\n      this.sendOldestStack();\n      this._send();\n    }, 500);\n  }\n\n  /**\n   * 收集的信息入栈\n   * @param infoObj\n   *\n   *  {\n   *      oc : //业务编码 opeCode\n   *      ac ：//行为编码 actionCode\n   *      v ：//行为结果 value 例如 输入框产生的值\n   *      ed:  //扩展信息 json\n   *  }\n   *\n   */\n  push(infoObj) {\n    if (infoObj) {\n      infoObj.dateTime = new Date().getTime();\n      console.log(infoObj);\n      this._scanStack(CONFIG.stackTime);\n      this._scanWaitSendQqueue(CONFIG.queueTime);\n      this._stackSave(infoObj);\n    }\n  }\n}\n\nexport default BPOINT;\n","/**\r\n * 远程拉取js插件，包含：可视化埋点（圈选）元素、热力图展示、可视化实验（样式配置）、debug展示\r\n * \r\n * 按需拉取插件规则（根据当前页的url上参数确定拉取）：\r\n * \r\n * 1.可视化埋点圈选元素：当前页url 上含有 'smart_auto_visualization_token' 字段且值存在（该token是保存信息的凭证）\r\n * 2. 其它待定\r\n */\r\n\r\nimport {_, console} from './utils'\r\n\r\n class LOAD_CONTROL_JS {\r\n    constructor(instance) {\r\n      this.instance = instance;\r\n      this._load_js();\r\n    }\r\n    _load_js() {\r\n\r\n    }\r\n    // 拉取可视化埋点（圈选）插件\r\n    _load_visualization() {\r\n\r\n    }\r\n    is_visualization() {\r\n      \r\n    }\r\n }\r\n\r\n export default LOAD_CONTROL_JS;\r\n","import { CONFIG, DEFAULT_CONFIG } from \"./config\";\r\n\r\nimport { _, console } from \"./utils\";\r\n\r\n// 用户属性追踪\r\nimport USER_TRACK from \"./user_track\";\r\n// 用户事件追踪\r\nimport EVENT_TRACK from \"./event_track\";\r\n// 本地存储\r\nimport LOCAL_STORAGE from \"./local_storage\";\r\n// 单页面\r\nimport SPA from \"./spa\";\r\n// 渠道跟踪\r\nimport CHANNEL from \"./channel\";\r\n// 断点发送\r\nimport BPOINT from \"./bpoint_send\";\r\n// 远程拉取js文件（插件，具体内容请查看该文件）\r\nimport LOAD_CONTROL_JS from \"./load_control_js\";\r\n\r\nclass SMARTLib {\r\n  /**\r\n   *\r\n   * @param {String} token 上报数据凭证\r\n   * @param {Object} config sdk客户端配置\r\n   */\r\n  constructor(token, config) {\r\n    this[\"__loaded\"] = true;\r\n    this._ = _;\r\n    this[\"config\"] = {};\r\n    this._set_config(\r\n      _.extend({}, DEFAULT_CONFIG, CONFIG, config, {\r\n        token: token\r\n      })\r\n    );\r\n    this[\"local_storage\"] = new LOCAL_STORAGE(this[\"config\"]);\r\n    // 运行钩子函数\r\n    this._loaded();\r\n    // 实例化拉取远程库对象（按需加载）\r\n    this[\"load_control_js\"] = new LOAD_CONTROL_JS(this);\r\n    // 实例化事件对象\r\n    this[\"event\"] = new EVENT_TRACK(this);\r\n    // 实例化用户对象\r\n    this[\"user\"] = new USER_TRACK(this);\r\n    // 实例化渠道跟踪对象\r\n    this[\"channel\"] = new CHANNEL(this);\r\n    // 断点发送对象\r\n    // 设置设备凭证\r\n    this._set_device_id();\r\n    // 开启是否断点发送\r\n    if (this._get_config(\"isBpoint\")) {\r\n      this[\"bpoint\"] = new BPOINT(this);\r\n      this[\"bpoint\"]._oldDataCheck();\r\n      this[\"bpoint\"]._scanStack(CONFIG.stackTime);\r\n      this[\"bpoint\"]._scanWaitSendQqueue(CONFIG.queueTime);\r\n    }\r\n\r\n    // 上报广告点击事件\r\n    if (this[\"channel\"].check_ad_click()) {\r\n      this._ad_click();\r\n    }\r\n\r\n    this._track_pv();\r\n\r\n    // persistedTime 首次访问应用时间\r\n    this[\"local_storage\"].register_once(\r\n      { persistedTime: new Date().getTime() },\r\n      \"\"\r\n    );\r\n    // 单页面\r\n    if (this._get_config(\"SPA\").is) {\r\n      this._SPA();\r\n    }\r\n  }\r\n  // 广告点击事件\r\n  _ad_click() {\r\n    this.track_event(\"smart_ad_click\");\r\n  }\r\n  // 内部使用的PV方法\r\n  _track_pv(properties, callback) {\r\n    // 配置为自动触发PV事件\r\n    if (this._get_config(\"pageview\")) {\r\n      this[\"event\"].track_pv(properties, callback);\r\n    } else {\r\n      // 若没有自动触发事件，还需检测session (说明：当触发PV 时，实际已经检测了session)\r\n      this[\"event\"]._session();\r\n    }\r\n  }\r\n  // 单页面应用（影响PV）\r\n  _SPA() {\r\n    SPA.init({\r\n      mode: this._get_config(\"SPA\").mode,\r\n      callback_fn: () => {\r\n        this._track_pv();\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * 设置配置\r\n   * @param {Object} config\r\n   */\r\n  _set_config(config) {\r\n    if (_.isObject(config)) {\r\n      this[\"config\"] = _.extend(this[\"config\"], config);\r\n      CONFIG.DEBUG = CONFIG.DEBUG || this._get_config(\"debug\");\r\n      CONFIG.isBpoint = CONFIG.isBpoint || this._get_config(\"isBpoint\");\r\n    }\r\n  }\r\n  /**\r\n   * 获取某个配置\r\n   * @param {String} prop_name\r\n   * @returns {*}\r\n   */\r\n  _get_config(prop_name) {\r\n    return this[\"config\"][prop_name];\r\n  }\r\n  // sdk初始化之前触发的钩子函数，该方法必须在初始化子模块前以及上报数据前使用\r\n  _loaded() {\r\n    try {\r\n      this._get_config(\"loaded\")(this);\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n  /**\r\n   * 设置本地设备凭证\r\n   * 若是首次访问（本地无设备凭证），上报用户首次访问网站事件\r\n   */\r\n  _set_device_id() {\r\n    let track_data = {};\r\n    if (!this.get_device_id()) {\r\n      this[\"local_storage\"].register_once({ deviceId: _.UUID() }, \"\");\r\n      track_data = this.track_event(\"smart_activate\");\r\n    }\r\n    return track_data;\r\n  }\r\n\r\n  // 获取唯一凭证（设备标记）\r\n  get_device_id() {\r\n    return this.get_property(\"deviceId\");\r\n  }\r\n  // 获取指定本地存储属性（缓存和本地）\r\n  get_property(prop_name) {\r\n    return this[\"local_storage\"][\"props\"][prop_name];\r\n  }\r\n  /**\r\n   * 设置一个指定事件的耗时监听器\r\n   * @param {String} event_name\r\n   */\r\n  time_event(event_name) {\r\n    this[\"event\"].time_event(event_name);\r\n  }\r\n  /**\r\n   * 发送PV事件，在此之前检测session\r\n   * @param {Object} properties  pv属性\r\n   * @param {*} callback\r\n   */\r\n  track_pv(properties, callback) {\r\n    this[\"event\"].track_pv(properties, callback);\r\n  }\r\n  /**\r\n   * 追踪事件（上报用户事件触发数据）\r\n   * @param {String} event_name 事件名称（必须）\r\n   * @param {Object} properties 事件属性\r\n   * @param {Function} callback 上报后的回调方法\r\n   * @param {String} event_type 自定义事件类型\r\n   * @returns {Object} track_data 上报的数据\r\n   */\r\n  track_event(event_name, properties, callback, event_type) {\r\n    this[\"event\"].track(event_name, properties, callback, event_type);\r\n  }\r\n  /**\r\n   * 设置事件自定义通用属性\r\n   * 成功设置事件通用属性后，再通过 track_event: 追踪事件时，事件通用属性会被添加进每个事件中。\r\n   * 重复调用 register_event_super_properties: 会覆盖之前已设置的通用属性。\r\n   */\r\n  register_event_super_properties(prop, to) {\r\n    let set_props = {};\r\n    let super_properties = this.get_property(\"superProperties\");\r\n    if (_.isObject(prop)) {\r\n      _.each(prop, (v, k) => {\r\n        set_props[k] = v;\r\n      });\r\n    } else {\r\n      set_props[prop] = to;\r\n    }\r\n    // 注意合并顺序\r\n    super_properties = _.extend({}, super_properties, set_props);\r\n    this[\"local_storage\"].register({\r\n      superProperties: super_properties\r\n    });\r\n  }\r\n  /**\r\n   * 设置事件自定义通用属性\r\n   * 成功设置事件通用属性后，再通过 track_event: 追踪事件时，事件通用属性会被添加进每个事件中。\r\n   * 不覆盖之前已经设定的通用属性。\r\n   */\r\n  register_event_super_properties_once(prop, to) {\r\n    let set_props = {};\r\n    let super_properties = this.get_property(\"superProperties\");\r\n    if (_.isObject(prop)) {\r\n      _.each(prop, (v, k) => {\r\n        set_props[k] = v;\r\n      });\r\n    } else {\r\n      set_props[prop] = to;\r\n    }\r\n    // 注意合并顺序\r\n    super_properties = _.extend({}, set_props, super_properties);\r\n    this[\"local_storage\"].register({\r\n      superProperties: super_properties\r\n    });\r\n  }\r\n  /**\r\n   * 删除指定通用事件属性\r\n   * @param {String} prop_name\r\n   */\r\n  unregister_event_super_properties(prop_name) {\r\n    if (_.isString(prop_name)) {\r\n      let super_properties = this.get_property(\"superProperties\");\r\n      if (_.isObject(super_properties)) {\r\n        delete super_properties[prop_name];\r\n        this[\"local_storage\"].register({\r\n          superProperties: super_properties\r\n        });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 清除本地已设置的通用事件属性\r\n   */\r\n  clear_event_super_properties() {\r\n    this[\"local_storage\"].register({\r\n      superProperties: {}\r\n    });\r\n  }\r\n  /**\r\n   * 查看当前已设置的通用事件属性\r\n   */\r\n  current_event_super_properties() {\r\n    return this.get_property(\"superProperties\");\r\n  }\r\n  /**\r\n   * 用户登录和注册时调用\r\n   * @param {String} user_id\r\n   */\r\n  login(user_id) {\r\n    this[\"event\"].login(user_id);\r\n  }\r\n  // 清除本地用户信息，退出用户（选则调用）,建议平台网站不必调用（无需匿名用户的平台）\r\n  logout() {\r\n    this[\"event\"].logout();\r\n  }\r\n}\r\nclass LoaderSync {\r\n  constructor() {\r\n    window[\"smart\"] = this;\r\n  }\r\n  init(token, config) {\r\n    if (this[\"__loaded\"]) {\r\n      return;\r\n    }\r\n    this.instance = new SMARTLib(token, config);\r\n    this.instance.init = this[\"init\"];\r\n    window[\"smart\"] = this.instance;\r\n  }\r\n}\r\nexport default new LoaderSync();\r\n"],"names":["DEFAULT_CONFIG","CONFIG","SYSTEM_EVENT_TYPE","BUSSINESS_EVENT_TYPE","SYSTEM_EVENT_OBJECT","PEOPLE_RESERVED_PROPERTY","PEOPLE_PROPERTY_ID","previousDevice","window","device","changeOrientationList","documentElement","document","userAgent","navigator","toLowerCase","television","macos","find","ios","iphone","ipod","ipad","windows","android","androidPhone","androidTablet","blackberry","blackberryPhone","blackberryTablet","windowsPhone","windowsTablet","fxos","fxosPhone","fxosTablet","meego","cordova","location","protocol","nodeWebkit","babelHelpers.typeof","process","mobile","tablet","desktop","i","length","portrait","screen","orientation","Object","prototype","hasOwnProperty","call","type","includes","innerHeight","innerWidth","landscape","noConflict","needle","indexOf","hasClass","className","match","RegExp","addClass","currentClassNames","replace","removeClass","handleOrientation","walkOnChangeOrientationList","newOrientation","index","onChangeOrientation","cb","push","orientationEvent","addEventListener","attachEvent","findMatch","arr","os","setOrientationCache","utf8Encode","string","utftext","start","end","stringl","n","c1","charCodeAt","enc","String","fromCharCode","substring","base64Encode","data","b64","o1","o2","o3","h1","h2","h3","h4","bits","ac","tmp_arr","charAt","join","slice","win","toString","object","isObject","isFunction","each","factory","l","NA_VERSION","external","appVersion","vendor","detector","re_msie","re_blackberry_10","re_blackberry_6_7","re_blackberry_4_5","DEVICES","ua","re_mediapad","test","OS","m","version","ENGINE","BROWSER","x","checkTW360External","mxVersion","max_version","ex","LiebaoGetVersion","re_opera_old","re_opera_new","key","runpath","twGetRunPath","security","twGetSecurityID","twGetVersion","IEMode","engineMode","engineVersion","browserMode","browserVersion","exec","v_version","split","parseInt","v_mode","detect","name","expression","expr","info","t","na","init","patterns","detected","pattern","d","parse","v","parseFloat","ieCore","mode","engine","compatible","browser","breaker","_","obj","iterator","context","undefined","Array","forEach","arguments","source","prop","isArray","iterable","toArray","isArguments","values","results","value","JSON","error","json","stringify","fn","bool","str","ret","val","truncate","formdata","arg_separator","use_val","use_key","isUndefined","encodeURIComponent","timeString","reg","url","host","URL","regex","param","target","regexS","decodeURIComponent","apply","loadScript","para","extend","g","getElementsByTagName","appendChild","createElement","rel","href","async","setAttribute","src","onload","onreadystatechange","readyState","success","onerror","appendCall","register_event","element","handler","oldSchool","useCapture","ontype","old_handler","makeHandler","new_handler","old_handlers","event","fixEvent","old_result","new_result","preventDefault","stopPropagation","returnValue","cancelBubble","register_hash_event","callback","referrer","deviceModel","sss","windowsOs","devicePlatform","trim","isWindows","deviceOsVersion","fullVersion","title","pathname","domain","language","width","height","innerEvent","_list","args","arrFn","sendRequest","Date","getTime","HTTPBuildQuery","img","onabort","ajax","get","options","timeout","that","params","req","XMLHttpRequest","open","setRequestHeader","withCredentials","ontimeout","status","JSONDecode","responseText","message","statusText","send","JSONEncode","e","UUID","T","R","Math","random","UA","ch","buffer","xor","result","byte_array","j","tmp","unshift","se","localStorage","msg","getItem","err","setItem","removeItem","cookie","nameEQ","ca","c","seconds","cross_subdomain","is_secure","cdomain","expires","secure","matches","hostname","date","setTime","toGMTString","days","new_cookie_val","set","windowConsole","console","DEBUG","log","arg","concat","compile","code","uncompile","USER_TRACK","instance","properties","get_device_id","get_property","get_channel_params","truncateLength","_get_config","truncated_data","isNumber","callback_fn","response","track_type","token","to","set_props","k","_is_reserved_property","_send_request","EVENT_TRACK","register_once","register","mark_page_url","on","eventName","urlParams","is_other_channel","getHost","event_name","track","time","sessionStartTime","LASTEVENT","sessionTotalLength","session_start_time","updated_time","now_date_time_ms","now_date_time_se","other_channel_Bool","_check_channel","_start_new_session","_close_cur_session","user_id","anonymous_id","logout","_event_is_disabled","set_event_timer","_session","event_type","load","user_set_properties","costTime","start_listen_timestamp","remove_event_timer","data_type","sessionCloseTime","LIB_VERSION","is","sessionReferrer","smartConfig","isBpoint","_signup","userId","unregister","LOCAL_STORAGE","config","local_storage","storage_type","localStorage_supported","supported","remove","update_config","upgrade","save","localData","localStorageConfig","default_expiry","expire_days","set_disabled","set_cross_subdomain","set_secure","disabled","storage","old_cookie","props","default_value","timestamp","timers","callFn","getPath","search","SPA","path","history","pushState","pushStateOverride","bind","replaceStateOverride","handlePopState","handleHashState","handleUrlChange","historyDidUpdate","trigger","oldPath","newPath","shouldTrackUrlChange","track_replace_state","CHANNEL","channel_params","cookie_name","_set_channel_params","_check_chennel","_url_channel_params","_save","channel_keywords","getQueryParam","is_channel","utm_source","utm_medium","utm_campaign","promotional_id","cross_subdomain_cookie","is_ad_click","t_re","utm_content","utm_term","deleteEmptyProperty","BPOINT","_infoStack","_waitSendQueue","_queueSending","_scanStackIntervalId","_scanWaitSendQqueueIntervalId","_loadFN","oldData","eval","sendData","pop","_sendByImg","setInterval","stack2queue","ReferenceError","stack","stackSize","_option","_queueSave","infoObj","_send","sendOldestStack","dateTime","_scanStack","stackTime","_scanWaitSendQqueue","queueTime","_stackSave","LOAD_CONTROL_JS","_load_js","SMARTLib","_set_config","_loaded","_set_device_id","_oldDataCheck","check_ad_click","_ad_click","_track_pv","persistedTime","_SPA","track_event","track_pv","prop_name","track_data","deviceId","time_event","super_properties","isString","login","LoaderSync"],"mappings":"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"}