"use strict";var DEFAULT_CONFIG={track_url:"http://localhost:3300/",debug:!1,local_storage:{type:"localStorage",name:"",disable:!1,secure_cookie:!1,cross_subdomain_cookie:!1,cookie_expiration:1e3},loaded:function(){},track_type:"img",SPA:{is:!1,mode:"hash"},pageview:!0,truncateLength:-1,session_interval_mins:.05,isBpoint:!0,auto_visualization_src:"http://localhost:3300/build/plugins/auto_visualization/main.js",stackSize:10,stackTime:3,queueSize:20,queueTime:5},CONFIG={DEBUG:!1,LIB_VERSION:"0.1.0",isBpoint:!0,stackSize:10,stackTime:3,queueSize:20,queueTime:5},SYSTEM_EVENT_TYPE="se",BUSSINESS_EVENT_TYPE="be",SYSTEM_EVENT_OBJECT={sxfData_session_start:{data_type:SYSTEM_EVENT_TYPE},sxfData_session_close:{data_type:SYSTEM_EVENT_TYPE},sxfData_pv:{data_type:SYSTEM_EVENT_TYPE},sxfData_ad_click:{data_type:SYSTEM_EVENT_TYPE},sxfData_activate:{data_type:SYSTEM_EVENT_TYPE},sxfData_abtest:{data_type:SYSTEM_EVENT_TYPE},sxfData_error:{data_type:SYSTEM_EVENT_TYPE},sxfData_u_signup:{data_type:SYSTEM_EVENT_TYPE},sxfData_u_login:{data_type:SYSTEM_EVENT_TYPE},sxfData_u_logout:{data_type:SYSTEM_EVENT_TYPE},sxfData_u_property:{data_type:SYSTEM_EVENT_TYPE}},PEOPLE_RESERVED_PROPERTY=["$deviceUdid","$toekn"],PEOPLE_PROPERTY_ID="sxfData_user_property",_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),previousDevice=window.device,device={},changeOrientationList=[];window.device=device;var documentElement=window.document.documentElement,userAgent=window.navigator.userAgent.toLowerCase(),television=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"];function find(e){return-1!==userAgent.indexOf(e)}function hasClass(e){return documentElement.className.match(new RegExp(e,"i"))}function addClass(e){var t=null;hasClass(e)||(t=documentElement.className.replace(/^\s+|\s+$/g,""),documentElement.className=t+" "+e)}function removeClass(e){hasClass(e)&&(documentElement.className=documentElement.className.replace(" "+e,""))}function handleOrientation(){device.landscape()?(removeClass("portrait"),addClass("landscape"),walkOnChangeOrientationList("landscape")):(removeClass("landscape"),addClass("portrait"),walkOnChangeOrientationList("portrait")),setOrientationCache()}function walkOnChangeOrientationList(e){for(var t in changeOrientationList)changeOrientationList[t](e)}device.macos=function(){return find("mac")},device.ios=function(){return device.iphone()||device.ipod()||device.ipad()},device.iphone=function(){return!device.windows()&&find("iphone")},device.ipod=function(){return find("ipod")},device.ipad=function(){return find("ipad")},device.android=function(){return!device.windows()&&find("android")},device.androidPhone=function(){return device.android()&&find("mobile")},device.androidTablet=function(){return device.android()&&!find("mobile")},device.blackberry=function(){return find("blackberry")||find("bb10")||find("rim")},device.blackberryPhone=function(){return device.blackberry()&&!find("tablet")},device.blackberryTablet=function(){return device.blackberry()&&find("tablet")},device.windows=function(){return find("windows")},device.windowsPhone=function(){return device.windows()&&find("phone")},device.windowsTablet=function(){return device.windows()&&find("touch")&&!device.windowsPhone()},device.fxos=function(){return(find("(mobile")||find("(tablet"))&&find(" rv:")},device.fxosPhone=function(){return device.fxos()&&find("mobile")},device.fxosTablet=function(){return device.fxos()&&find("tablet")},device.meego=function(){return find("meego")},device.cordova=function(){return window.cordova&&"file:"===location.protocol},device.nodeWebkit=function(){return"object"===_typeof(window.process)},device.mobile=function(){return device.androidPhone()||device.iphone()||device.ipod()||device.windowsPhone()||device.blackberryPhone()||device.fxosPhone()||device.meego()},device.tablet=function(){return device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet()},device.desktop=function(){return!device.tablet()&&!device.mobile()},device.television=function(){for(var e=0;e<television.length;){if(find(television[e]))return!0;e++}return!1},device.portrait=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?screen.orientation.type.includes("portrait"):1<window.innerHeight/window.innerWidth},device.landscape=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?screen.orientation.type.includes("landscape"):window.innerHeight/window.innerWidth<1},device.noConflict=function(){return window.device=previousDevice,this},device.ios()?device.ipad()?addClass("ios ipad tablet"):device.iphone()?addClass("ios iphone mobile"):device.ipod()&&addClass("ios ipod mobile"):device.macos()?addClass("macos desktop"):device.android()?device.androidTablet()?addClass("android tablet"):addClass("android mobile"):device.blackberry()?device.blackberryTablet()?addClass("blackberry tablet"):addClass("blackberry mobile"):device.windows()?device.windowsTablet()?addClass("windows tablet"):device.windowsPhone()?addClass("windows mobile"):addClass("windows desktop"):device.fxos()?device.fxosTablet()?addClass("fxos tablet"):addClass("fxos mobile"):device.meego()?addClass("meego mobile"):device.nodeWebkit()?addClass("node-webkit"):device.television()?addClass("television"):device.desktop()&&addClass("desktop"),device.cordova()&&addClass("cordova"),device.onChangeOrientation=function(e){"function"==typeof e&&changeOrientationList.push(e)};var orientationEvent="resize";function findMatch(e){for(var t=0;t<e.length;t++)if(device[e[t]]())return e[t];return"unknown"}function setOrientationCache(){device.orientation=findMatch(["portrait","landscape"])}Object.prototype.hasOwnProperty.call(window,"onorientationchange")&&(orientationEvent="orientationchange"),window.addEventListener?window.addEventListener(orientationEvent,handleOrientation,!1):window.attachEvent?window.attachEvent(orientationEvent,handleOrientation):window[orientationEvent]=handleOrientation,handleOrientation(),device.type=findMatch(["mobile","tablet","desktop"]),device.os=findMatch(["ios","iphone","ipad","ipod","android","blackberry","windows","fxos","meego","television"]),setOrientationCache();var utf8Encode=function(e){var t,n,i,o,r="";for(t=n=0,i=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,o=0;o<i;o++){var a=e.charCodeAt(o),s=null;a<128?n++:s=127<a&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==s&&(t<n&&(r+=e.substring(t,n)),r+=s,t=n=o+1)}return t<n&&(r+=e.substring(t,e.length)),r},base64Encode=function(e){var t,n,i,o,r,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,c=0,l="",u=[];if(!e)return e;for(e=utf8Encode(e);t=(r=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++))>>18&63,n=r>>12&63,i=r>>6&63,o=63&r,u[c++]=a.charAt(t)+a.charAt(n)+a.charAt(i)+a.charAt(o),s<e.length;);switch(l=u.join(""),e.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l},win$1=void 0;function toString(e){return Object.prototype.toString.call(e)}function isObject(e){return"[object Object]"===toString(e)}function isFunction(e){return"[object Function]"===toString(e)}function each(e,t){for(var n=0,i=e.length;n<i&&!1!==t.call(e,e[n],n);n++);}win$1="undefined"==typeof window?{navigator:{userAgent:""},location:{pathname:"",href:""},document:{},screen:{width:"",height:""}}:window;var NA_VERSION="-1",external=win$1.external,userAgent$1=win$1.navigator.userAgent||"",appVersion=win$1.navigator.appVersion||"",vendor=win$1.navigator.vendor||"",detector={},re_msie=/\b(?:msie |ie |trident\/[0-9].*rv[ :])([0-9.]+)/,re_blackberry_10=/\bbb10\b.+?\bversion\/([\d.]+)/,re_blackberry_6_7=/\bblackberry\b.+\bversion\/([\d.]+)/,re_blackberry_4_5=/\bblackberry\d+\/([\d.]+)/,DEVICES=[["nokia",function(e){return-1!==e.indexOf("nokia ")?/\bnokia ([0-9]+)?/:/\bnokia([a-z0-9]+)?/}],["samsung",function(e){return-1!==e.indexOf("samsung")?/\bsamsung(?:[ \-](?:sgh|gt|sm))?-([a-z0-9]+)/:/\b(?:sgh|sch|gt|sm)-([a-z0-9]+)/}],["wp",function(e){return-1!==e.indexOf("windows phone ")||-1!==e.indexOf("xblwp")||-1!==e.indexOf("zunewp")||-1!==e.indexOf("windows ce")}],["pc","windows"],["ipad","ipad"],["ipod","ipod"],["iphone",/\biphone\b|\biph(\d)/],["mac","macintosh"],["mi",/\bmi[ \-]?([a-z0-9 ]+(?= build|\)))/],["hongmi",/\bhm\b|redmi[ \-]?([a-z0-9]+)/],["aliyun",/\baliyunos\b(?:[\-](\d+))?/],["meizu",function(e){return 0<=e.indexOf("meizu")?/\bmeizu[\/ ]([a-z0-9]+)\b/:/\bm([0-9cx]{1,4})\b/}],["nexus",/\bnexus ([0-9s.]+)/],["huawei",function(e){var t=/\bmediapad (.+?)(?= build\/huaweimediapad\b)/;return-1!==e.indexOf("huawei-huawei")?/\bhuawei\-huawei\-([a-z0-9\-]+)/:t.test(e)?t:/\bhuawei[ _\-]?([a-z0-9]+)/}],["lenovo",function(e){return-1!==e.indexOf("lenovo-lenovo")?/\blenovo\-lenovo[ \-]([a-z0-9]+)/:/\blenovo[ \-]?([a-z0-9]+)/}],["zte",function(e){return/\bzte\-[tu]/.test(e)?/\bzte-[tu][ _\-]?([a-su-z0-9\+]+)/:/\bzte[ _\-]?([a-su-z0-9\+]+)/}],["vivo",/\bvivo(?: ([a-z0-9]+))?/],["htc",function(e){return/\bhtc[a-z0-9 _\-]+(?= build\b)/.test(e)?/\bhtc[ _\-]?([a-z0-9 ]+(?= build))/:/\bhtc[ _\-]?([a-z0-9 ]+)/}],["oppo",/\boppo[_]([a-z0-9]+)/],["konka",/\bkonka[_\-]([a-z0-9]+)/],["sonyericsson",/\bmt([a-z0-9]+)/],["coolpad",/\bcoolpad[_ ]?([a-z0-9]+)/],["lg",/\blg[\-]([a-z0-9]+)/],["android",/\bandroid\b|\badr\b/],["blackberry",function(e){return 0<=e.indexOf("blackberry")?/\bblackberry\s?(\d+)/:"bb10"}]],OS=[["wp",function(e){return-1!==e.indexOf("windows phone ")?/\bwindows phone (?:os )?([0-9.]+)/:-1!==e.indexOf("xblwp")?/\bxblwp([0-9.]+)/:-1!==e.indexOf("zunewp")?/\bzunewp([0-9.]+)/:"windows phone"}],["windows",/\bwindows nt ([0-9.]+)/],["macosx",/\bmac os x ([0-9._]+)/],["iOS",function(e){return/\bcpu(?: iphone)? os /.test(e)?/\bcpu(?: iphone)? os ([0-9._]+)/:-1!==e.indexOf("iph os ")?/\biph os ([0-9_]+)/:/\bios\b/}],["yunos",/\baliyunos ([0-9.]+)/],["Android",function(e){return 0<=e.indexOf("android")?/\bandroid[ \/-]?([0-9.x]+)?/:0<=e.indexOf("adr")?0<=e.indexOf("mqqbrowser")?/\badr[ ]\(linux; u; ([0-9.]+)?/:/\badr(?:[ ]([0-9.]+))?/:"android"}],["chromeos",/\bcros i686 ([0-9.]+)/],["linux","linux"],["windowsce",/\bwindows ce(?: ([0-9.]+))?/],["symbian",/\bsymbian(?:os)?\/([0-9.]+)/],["blackberry",function(e){var t=e.match(re_blackberry_10)||e.match(re_blackberry_6_7)||e.match(re_blackberry_4_5);return t?{version:t[1]}:"blackberry"}]],ENGINE=[["edgehtml",/edge\/([0-9.]+)/],["trident",re_msie],["blink",function(){return"chrome"in win$1&&"CSS"in win$1&&/\bapplewebkit[\/]?([0-9.+]+)/}],["webkit",/\bapplewebkit[\/]?([0-9.+]+)/],["gecko",function(e){var t;if(t=e.match(/\brv:([\d\w.]+).*\bgecko\/(\d+)/))return{version:t[1]+"."+t[2]}}],["presto",/\bpresto\/([0-9.]+)/],["androidwebkit",/\bandroidwebkit\/([0-9.]+)/],["coolpadwebkit",/\bcoolpadwebkit\/([0-9.]+)/],["u2",/\bu2\/([0-9.]+)/],["u3",/\bu3\/([0-9.]+)/]],BROWSER=[["edge",/edge\/([0-9.]+)/],["sogou",function(e){return 0<=e.indexOf("sogoumobilebrowser")?/sogoumobilebrowser\/([0-9.]+)/:0<=e.indexOf("sogoumse")||/ se ([0-9.x]+)/}],["theworld",function(){var e=checkTW360External("theworld");return void 0!==e?e:"theworld"}],["360",function(e){var t=checkTW360External("360se");return void 0!==t?t:-1!==e.indexOf("360 aphone browser")?/\b360 aphone browser \(([^\)]+)\)/:/\b360(?:se|ee|chrome|browser)\b/}],["maxthon",function(){try{if(external&&(external.mxVersion||external.max_version))return{version:external.mxVersion||external.max_version}}catch(e){}return/\b(?:maxthon|mxbrowser)(?:[ \/]([0-9.]+))?/}],["micromessenger",/\bmicromessenger\/([\d.]+)/],["qq",/\bm?qqbrowser\/([0-9.]+)/],["green","greenbrowser"],["tt",/\btencenttraveler ([0-9.]+)/],["liebao",function(e){if(0<=e.indexOf("liebaofast"))return/\bliebaofast\/([0-9.]+)/;if(-1===e.indexOf("lbbrowser"))return!1;var t;try{external&&external.LiebaoGetVersion&&(t=external.LiebaoGetVersion())}catch(e){}return{version:t||NA_VERSION}}],["tao",/\btaobrowser\/([0-9.]+)/],["coolnovo",/\bcoolnovo\/([0-9.]+)/],["saayaa","saayaa"],["baidu",/\b(?:ba?idubrowser|baiduhd)[ \/]([0-9.x]+)/],["ie",re_msie],["mi",/\bmiuibrowser\/([0-9.]+)/],["opera",function(e){var t=/\bopera.+version\/([0-9.ab]+)/;return t.test(e)?t:/\bopr\/([0-9.]+)/}],["oupeng",/\boupeng\/([0-9.]+)/],["yandex",/yabrowser\/([0-9.]+)/],["ali-ap",function(e){return 0<e.indexOf("aliapp")?/\baliapp\(ap\/([0-9.]+)\)/:/\balipayclient\/([0-9.]+)\b/}],["ali-ap-pd",/\baliapp\(ap-pd\/([0-9.]+)\)/],["ali-am",/\baliapp\(am\/([0-9.]+)\)/],["ali-tb",/\baliapp\(tb\/([0-9.]+)\)/],["ali-tb-pd",/\baliapp\(tb-pd\/([0-9.]+)\)/],["ali-tm",/\baliapp\(tm\/([0-9.]+)\)/],["ali-tm-pd",/\baliapp\(tm-pd\/([0-9.]+)\)/],["uc",function(e){return 0<=e.indexOf("ucbrowser/")?/\bucbrowser\/([0-9.]+)/:0<=e.indexOf("ubrowser/")?/\bubrowser\/([0-9.]+)/:/\buc\/[0-9]/.test(e)?/\buc\/([0-9.]+)/:0<=e.indexOf("ucweb")?/\bucweb([0-9.]+)?/:/\b(?:ucbrowser|uc)\b/}],["chrome",/ (?:chrome|crios|crmo)\/([0-9.]+)/],["android",function(e){if(-1!==e.indexOf("android"))return/\bversion\/([0-9.]+(?: beta)?)/}],["blackberry",function(e){var t=e.match(re_blackberry_10)||e.match(re_blackberry_6_7)||e.match(re_blackberry_4_5);return t?{version:t[1]}:"blackberry"}],["safari",/\bversion\/([0-9.]+(?: beta)?)(?: mobile(?:\/[a-z0-9]+)?)? safari\//],["webview",/\bcpu(?: iphone)? os (?:[0-9._]+).+\bapplewebkit\b/],["firefox",/\bfirefox\/([0-9.ab]+)/],["nokia",/\bnokiabrowser\/([0-9.]+)/]];function checkTW360External(e){if(external)try{var t=external.twGetRunPath.toLowerCase(),n=external.twGetSecurityID(win$1),i=external.twGetVersion(n);if(t&&-1===t.indexOf(e))return!1;if(i)return{version:i}}catch(e){}}function IEMode(e){if(!re_msie.test(e))return null;var t,n,i,o,r;if(-1!==e.indexOf("trident/")&&(t=/\btrident\/([0-9.]+)/.exec(e))&&2<=t.length){i=t[1];var a=t[1].split(".");a[0]=parseInt(a[0],10)+4,r=a.join(".")}o=(t=re_msie.exec(e))[1];var s=t[1].split(".");return void 0===r&&(r=o),s[0]=parseInt(s[0],10)-4,n=s.join("."),void 0===i&&(i=n),{browserVersion:r,browserMode:o,engineVersion:i,engineMode:n,compatible:i!==n}}function detect(e,t,n){var i=isFunction(t)?t.call(null,n):t;if(!i)return null;var o={name:e,version:NA_VERSION,codename:""},r=toString(i);if(!0===i)return o;if("[object String]"===r){if(-1!==n.indexOf(i))return o}else{if(isObject(i))return i.hasOwnProperty("version")&&(o.version=i.version),o;if(i.exec){var a=i.exec(n);if(a)return 2<=a.length&&a[1]?o.version=a[1].replace(/_/g,"."):o.version=NA_VERSION,o}}}var na={name:"",version:""};function init(n,e,t,i){var o=na;each(e,function(e){var t=detect(e[0],e[1],n);if(t)return o=t,!1}),t.call(i,o.name,o.version)}var parse=function(e){e=(e||"").toLowerCase();var o={};init(e,DEVICES,function(e,t){var n=parseFloat(t);o.device={name:e,version:n,fullVersion:t},o.device[e]=n},o),init(e,OS,function(e,t){var n=parseFloat(t);o.os={name:e,version:n,fullVersion:t},o.os[e]=n},o);var r=IEMode(e);return init(e,ENGINE,function(e,t){var n=t;r&&(t=r.engineVersion||r.engineMode,n=r.engineMode);var i=parseFloat(t);o.engine={name:e,version:i,fullVersion:t,mode:parseFloat(n),fullMode:n,compatible:!!r&&r.compatible},o.engine[e]=i},o),init(e,BROWSER,function(e,t){var n=t;r&&("ie"===e&&(t=r.browserVersion),n=r.browserMode);var i=parseFloat(t);o.browser={name:e,version:i,fullVersion:t,mode:parseFloat(n),fullMode:n,compatible:!!r&&r.compatible},o.browser[e]=i},o),o};detector=parse(userAgent$1+" "+appVersion+" "+vendor);var detector$1=detector,ArrayProto=Array.prototype,FuncProto=Function.prototype,slice=ArrayProto.slice,nativeBind=FuncProto.bind,win=void 0;win="undefined"==typeof window?{navigator:{userAgent:""},location:{pathname:"",href:""},document:{URL:""},screen:{width:"",height:""}}:window;var breaker={},_={each:function(e,t,n){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,o=e.length;i<o;i++)if(i in e&&t.call(n,e[i],i,e)===breaker)return}else for(var r in e)if(e.hasOwnProperty.call(e,r)&&t.call(n,e[r],r,e)===breaker)return},extend:function(n){return _.each(Array.prototype.slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(n[t]=e[t])}),n},isObject:function(e){return e===Object(e)&&!_.isArray(e)},isUndefined:function(e){return void 0===e},isArguments:function(e){return!(!e||!hasOwnProperty.call(e,"callee"))},toArray:function(e){return e?e.toArray?e.toArray():_.isArray(e)?Array.prototype.slice.call(e):_.isArguments(e)?Array.prototype.slice.call(e):_.values(e):[]},values:function(e){var t=[];return null===e||_.each(e,function(e){t[t.length]=e}),t},JSONDecode:function(e){try{return JSON.parse(e)}catch(e){return{}}},JSONEncode:function(e){try{return JSON.stringify(e)}catch(e){return""}},isFunction:function(e){var t=!1;return"function"==typeof e&&(t=!0),t},base64Encode:function(e){return base64Encode(e)},sha1:function(e){return""},truncate:function(e,n){var i=void 0;return"string"==typeof e?i=e.slice(0,n):_.isArray(e)?(i=[],_.each(e,function(e){i.push(_.truncate(e,n))})):_.isObject(e)?(i={},_.each(e,function(e,t){i[t]=_.truncate(e,n)})):i=e,i},isNumber:function(e){return"[object Number]"==Object.prototype.toString.call(e)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},HTTPBuildQuery:function(e,t){var n=void 0,i=void 0,o=[];return _.isUndefined(t)&&(t="&"),_.each(e,function(e,t){n=encodeURIComponent(e&&e.toString()),i=encodeURIComponent(t),o[o.length]=i+"="+n}),o.join(t)},trim:function(e){if(e)return e.replace(/(^\s*)|(\s*$)/g,"")},checkTime:function(e){return!!e&&!!/^(\d{4})-(\d{2})-(\d{2})$/.test(e)},getHost:function(e){var t="",n=(e=e||document.URL).match(/.*\:\/\/([^\/]*).*/);return n&&(t=n[1]),t},getQueryParam:function(e,t){var n=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(e);return null===i||i&&"string"!=typeof i[1]&&i[1].length?"":decodeURIComponent(i[1]).replace(/\+/g," ")},deleteEmptyProperty:function(e){if(this.isObject(e)){for(var t in e)e.hasOwnProperty(t)&&(null!==e[t]&&!this.isUndefined(e[t])&&""!==e[t]||delete e[t]);return e}}};_.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.apply(e)},_.loadScript=function(e){e=_.extend({success:function(){},error:function(){},appendCall:function(e){document.getElementsByTagName("head")[0].appendChild(e)}},e);var t=null;"css"===e.type&&((t=document.createElement("link")).rel="stylesheet",t.href=e.url),"js"===e.type&&((t=document.createElement("script")).async="async",t.setAttribute("charset","UTF-8"),t.src=e.url,t.type="text/javascript"),t.onload=t.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e.success(),t.onload=t.onreadystatechange=null)},t.onerror=function(){e.error(),t.onerror=null},e.appendCall(t)},_.register_event=function(){function s(e){return e&&(e.preventDefault=s.preventDefault,e.stopPropagation=s.stopPropagation),e}return s.preventDefault=function(){this.returnValue=!1},s.stopPropagation=function(){this.cancelBubble=!0},function(e,t,n,i,o){if(e)if(e.addEventListener&&!i)e.addEventListener(t,n,!!o);else{var r="on"+t,a=e[r];e[r]=function(o,r,a){return function(e){if(e=e||s(window.event)){var t,n,i=!0;return _.isFunction(a)&&(t=a(e)),n=r.call(o,e),!1!==t&&!1!==n||(i=!1),i}}}(e,n,a)}else console$1.error("No valid element provided to register_event")}}(),_.register_hash_event=function(e){_.register_event(window,"hashchange",e)},_.getHashParam=function(e,t){var n=e.match(new RegExp(t+"=([^&]*)"));return n?n[1]:null},_.info={domain:function(e){var t=e.split("/");return 3<=t.length?t[2]:""},deviceModel:function(){var e="";if(device.android()){var t=win.navigator.userAgent.split(";"),n=t.indexOf("Build/");-1<n&&(e=t[n].substring(0,t[n].indexOf("Build/")))}else device.ios()&&device.iphone()&&(e="iPhone");return e},properties:function(){var e={"5.0":"Win2000",5.1:"WinXP",5.2:"Win2003","6.0":"WindowsVista",6.1:"Win7",6.2:"Win8",6.3:"Win8.1","10.0":"Win10"},t=device.type,n=_.trim(this.deviceModel()),i=device.windows(),o=detector$1.os.name+" "+detector$1.os.fullVersion;return i&&e[detector$1.os.fullVersion]&&(o=e[detector$1.os.fullVersion]),{deviceModel:n,deviceOs:detector$1.os.name,deviceOsVersion:o,devicePlatform:t,browser:detector$1.browser.name,browserVersion:detector$1.browser.fullVersion,title:win.document.title||"",urlPath:win.location.pathname||"",currentUrl:document.URL,currentDomain:this.domain(document.URL),referrer:win.document.referrer,referringDomain:this.domain(win.document.referrer),language:win.navigator.language||"",screenWidth:win.screen.width,screenHeight:win.screen.height}}},_.innerEvent={on:function(e,t){this._list||(this._list={}),this._list[e]||(this._list[e]=[]),this._list[e].push(t)},off:function(e){this._list||(this._list={}),this._list[e]&&delete this._list[e]},trigger:function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=this._list&&this._list[t];if(n&&0!==n.length)for(var i=0;i<n.length;i++)"function"==typeof n[i]&&n[i].apply(this,e)}},_.sendRequest=function(e,t,n,i){if(n._=(new Date).getTime().toString(),"img"===t){e+="?"+_.HTTPBuildQuery(n);var o=document.createElement("img");o.src=e,o.width=1,o.height=1,_.isFunction(i)&&i(0),o.onload=function(){this.onload=null},o.onerror=function(){this.onerror=null},o.onabort=function(){this.onabort=null}}else"get"===t?(e+="?"+_.HTTPBuildQuery(n),_.ajax.get(e,i)):"post"===t&&_.ajax.get(e,n,i)},_.ajax={post:function(e,t,n,i){var o=this;o.callback=n||function(e){};try{var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-type","application/json"),r.withCredentials=!0,r.ontimeout=function(){o.callback({status:0,error:!0,message:"request "+e+" time out"})},r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)o.callback(_.JSONDecode(r.responseText));else{var e="Bad HTTP status: "+r.status+" "+r.statusText;o.callback({status:0,error:!0,message:e})}},r.timeout=i||5e3,r.send(_.JSONEncode(t))}catch(e){}},get:function(e,t){try{var n=new XMLHttpRequest;n.open("GET",e,!0),n.withCredentials=!0,n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status)t&&t(n.responseText);else if(t){var e="Bad HTTP status: "+n.status+" "+n.statusText;t({status:0,error:!0,message:e})}},n.send(null)}catch(e){}}},_.UUID=function(){function n(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)}return function(){var e=String(screen.height*screen.width);e=e&&/\d{5,}/.test(e)?e.toString(16):String(31242*Math.random()).replace(".","").slice(0,8);var t=n()+"-"+Math.random().toString(16).replace(".","")+"-"+function(){var e,t,n=navigator.userAgent,o=[],i=0;function r(e,t){var n,i=0;for(n=0;n<t.length;n++)i|=o[n]<<8*n;return e^i}for(e=0;e<n.length;e++)t=n.charCodeAt(e),o.unshift(255&t),4<=o.length&&(i=r(i,o),o=[]);return 0<o.length&&(i=r(i,o)),i.toString(16)}()+"-"+e+"-"+n();return t||(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15)}}(),_.localStorage={error:function(e){console$1.error("localStorage error: "+e)},get:function(e){try{return window.localStorage.getItem(e)}catch(e){_.localStorage.error(e)}return null},parse:function(e){try{return _.JSONDecode(_.localStorage.get(e))||{}}catch(e){}return null},set:function(e,t){try{window.localStorage.setItem(e,t)}catch(e){_.localStorage.error(e)}},remove:function(e){try{window.localStorage.removeItem(e)}catch(e){_.localStorage.error(e)}}},_.cookie={get:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}return null},parse:function(e){var t;try{t=_.JSONDecode(_.cookie.get(e))||{}}catch(e){}return t},set_seconds:function(e,t,n,i,o){var r="",a="",s="";if(i){var c=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),l=c?c[0]:"";r=l?"; domain=."+l:""}if(n){var u=new Date;u.setTime(u.getTime()+1e3*n),a="; expires="+u.toGMTString()}o&&(s="; secure"),document.cookie=e+"="+encodeURIComponent(t)+a+"; path=/"+r+s},set:function(e,t,n,i,o){var r="",a="",s="";if(i){var c=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),l=c?c[0]:"";r=l?"; domain=."+l:""}if(n){var u=new Date;u.setTime(u.getTime()+24*n*60*60*1e3),a="; expires="+u.toGMTString()}o&&(s="; secure");var d=e+"="+encodeURIComponent(t)+a+"; path=/"+r+s;return document.cookie=d},remove:function(e,t){_.cookie.set(e,"",-1,t)}};var windowConsole=win.console,console$1={log:function(){if(CONFIG.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole)try{windowConsole.log.apply(windowConsole,arguments)}catch(e){_.each(arguments,function(e){windowConsole.log(e)})}},error:function(){if(CONFIG.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole){var t=["DATracker error:"].concat(_.toArray(arguments));try{windowConsole.error.apply(windowConsole,t)}catch(e){_.each(t,function(e){windowConsole.error(e)})}}},critical:function(){if(!_.isUndefined(windowConsole)&&windowConsole){var t=["error:"].concat(_.toArray(arguments));try{windowConsole.error.apply(windowConsole,t)}catch(e){_.each(t,function(e){windowConsole.error(e)})}}}};_.compile=function(e){for(var t=String.fromCharCode(e.charCodeAt(0)+e.length),n=1;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)+e.charCodeAt(n-1));return t},_.uncompile=function(e){for(var t=String.fromCharCode(e.charCodeAt(0)-e.length),n=1;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)-t.charCodeAt(n-1));return t},_.bind=function(i,o){var r,a;if(nativeBind&&i.bind===nativeBind)return nativeBind.apply(i,slice.call(arguments,1));if(!_.isFunction(i))throw new TypeError;return r=slice.call(arguments,2),a=function(){if(!(this instanceof a))return i.apply(o,r.concat(slice.call(arguments)));var e={};e.prototype=i.prototype;var t=new e;e.prototype=null;var n=i.apply(t,r.concat(slice.call(arguments)));return Object(n)===n?n:t}},_.bindInstanceMethods=function(e){for(var t in e)"function"==typeof e[t]&&(e[t]=_.bind(e[t],e))},_.safewrap=function(e){return function(){try{return e.apply(this,arguments)}catch(e){console$1.log("Implementation error. Please turn on debug and contact support@mixpanel.com."),CONFIG.DEBUG&&console$1.log(e)}}},_.safewrap_class=function(e,t){for(var n=0;n<t.length;n++)e.prototype[t[n]]=_.safewrap(e.prototype[t[n]])},_.safewrapInstanceMethods=function(e){for(var t in e)"function"==typeof e[t]&&(e[t]=_.safewrap(e[t]))},_.getById=function(e){return document.getElementById(e)};var USER_TRACK=function(){function t(e){classCallCheck(this,t),this.instance=e,this.local_storage=this.instance.local_storage}return createClass(t,[{key:"_is_reserved_property",value:function(e){return-1<PEOPLE_RESERVED_PROPERTY.indexOf("prop")}},{key:"_send_request",value:function(e,t){_.isFunction(t)||(t=function(){}),e=e||{};var n={dataType:SYSTEM_EVENT_TYPE,deviceId:this.instance.get_device_id(),userId:this.instance.get_property("user_id"),time:(new Date).getTime(),sdkType:"js",eventId:PEOPLE_PROPERTY_ID,persistedTime:this.instance.get_property("persistedTime"),pageOpenScene:"Browser",attributes:e};n=_.extend({},n,this.instance.channel.get_channel_params());var i=this.instance._get_config("truncateLength"),o=n;_.isNumber(i)&&0<i&&(o=_.truncate(n,i)),console$1.log(JSON.stringify(o,null,"  "));var r=this.instance._get_config("track_url"),a=this.instance._get_config("track_type");"img"===a&&(r+="track.gif"),_.sendRequest(r,a,{data:_.base64Encode(_.JSONEncode(o)),token:this.instance._get_config("token")},function(e){t(e,n)})}},{key:"set",value:function(e,t,n){var i=this,o={};return _.isObject(e)?(_.each(e,function(e,t){i._is_reserved_property(t)||(o[t]=e)}),n=t):o[e]=t,this._send_request(o,n)}}]),t}(),EVENT_TRACK=function(){function t(e){var n=this;classCallCheck(this,t),this.instance=e,this.local_storage=this.instance.local_storage,this.local_storage.register_once({updatedTime:0,sessionStartTime:0}),this.local_storage.register({sessionReferrer:document.referrer});var i=document.URL;_.innerEvent.on("singlePage:change",function(e,t){console$1.log("订阅"),n.local_storage.register({sessionReferrer:i}),i=document.URL})}return createClass(t,[{key:"_check_channel",value:function(){var e=this.instance.get_property("sessionReferrer"),t=!1;return _.getHost(e)!==window.location.host&&(t=!0),t}},{key:"_event_is_disabled",value:function(e){return!1}},{key:"_start_new_session",value:function(){this.local_storage.register({sessionUuid:_.UUID(),sessionStartTime:(new Date).getTime()}),this.track("sxfData_session_start")}},{key:"_close_cur_session",value:function(){var e=(new Date).getTime()-1,t=this.instance.get_property("sessionStartTime"),n=this.instance.get_property("LASTEVENT");n&&n.time&&(e=n.time+1);var i=e-t;0<=i&&this.track("sxfData_session_close",{sessionCloseTime:e,sessionTotalLength:i})}},{key:"_session",value:function(e){var t=1*this.instance.get_property("sessionStartTime")/1e3,n=1*this.instance.get_property("updatedTime")/1e3,i=(new Date).getTime(),o=1*i/1e3,r=this._check_channel();(0==t||o>n+60*this.instance._get_config("session_interval_mins")||r)&&(console$1.log(t),0==t||this._close_cur_session(),this._start_new_session()),this.local_storage.register({updatedTime:i}),_.isFunction(e)&&e()}},{key:"_signup",value:function(e){var t=this.instance.get_property("userId");t!==e&&(t&&this.logout(),this.track("sxfData_u_signup",{anonymousId:t,newUserId:e}))}},{key:"time_event",value:function(e){_.isUndefined(e)?console$1.error("事件耗时监听器需要一个事件名称"):this._event_is_disabled(e)||this.local_storage.set_event_timer(e,(new Date).getTime())}},{key:"track_pv",value:function(e,t){var n=this;this._session(function(){n.track("sxfData_pv",_.extend({},e),t)})}},{key:"track",value:function(e,t,n,i){if(_.isUndefined(e))console$1.error("上报数据需要一个事件名称");else if(_.isFunction(n)||(n=function(){}),this._event_is_disabled(e))n(0);else{this.local_storage.load(),t=t||{};var o=_.JSONDecode(_.JSONEncode(t))||{},r=void 0,a=this.local_storage.remove_event_timer(e);_.isUndefined(a)||(r=(new Date).getTime()-a,console$1.log("事件耗时",r,e));var s=BUSSINESS_EVENT_TYPE;i?s=i:SYSTEM_EVENT_OBJECT[e]&&(s=SYSTEM_EVENT_OBJECT[e].data_type);var c=(new Date).getTime();"sxfData_session_close"===e&&(c=t.sessionCloseTime,delete o.sessionCloseTime,delete o.sessionTotalLength),o=_.extend({},this.instance.get_property("superProperties"),o);var l={dataType:s,userId:this.instance.get_property("userId"),sdkType:"js",sdkVersion:CONFIG.LIB_VERSION,eventId:e,time:c,persistedTime:this.instance.get_property("persistedTime"),deviceId:this.instance.get_device_id(),pageOpenScene:"Browser",token:this.instance._get_config("token"),costTime:r,sessionTotalLength:t.sessionTotalLength,sessionUuid:this.instance.get_property("sessionUuid"),attributes:o};if(l=_.extend({},l,_.info.properties()),l=_.extend({},l,this.instance.channel.get_channel_params()),s===BUSSINESS_EVENT_TYPE&&this._check_channel()&&this.local_storage.register({sessionReferrer:document.URL}),this.instance._get_config("SPA").is||0<["sxfData_activate","sxfData_session_close"].indexOf(e)&&this.local_storage.register({sessionReferrer:document.URL}),this.instance._get_config("SPA").is){var u=this.instance.get_property("sessionReferrer");u!==l.referrer&&(l.referrer=u,l.referringDomain=_.info.domain(u))}var d=this.instance._get_config("truncateLength"),h=l;_.isNumber(d)&&0<d&&(h=_.truncate(l,d)),console$1.log(JSON.stringify(h,null,"  "));var f=function(e){n(e,l)},p=this.instance._get_config("track_url"),v=this.instance._get_config("track_type");if("img"===v&&(p+="track.gif"),!this.instance._get_config("isBpoint")||o&&o.sxfDataConfig&&!o.sxfDataConfig.isBpoint)_.sendRequest(p,v,{data:_.base64Encode(_.JSONEncode(h)),token:this.instance._get_config("token")},f);else try{this.instance.bpoint.push(h)}catch(e){_.sendRequest(p,v,{data:_.base64Encode(_.JSONEncode(h)),token:this.instance._get_config("token")},f)}-1===["sxfData_session_start","sxfData_session_close","sxfData_activate"].indexOf(e)&&this._session(),-1===["sxfData_session_start","sxfData_session_close"].indexOf(e)&&this.local_storage.register({LASTEVENT:{eventId:e,time:c}})}}},{key:"login",value:function(e){this._signup(e),this.local_storage.register({userId:e}),this.track("sxfData_u_login")}},{key:"logout",value:function(){this.local_storage.unregister("userId"),this.track("sxfData_u_logout")}}]),t}(),LOCAL_STORAGE=function(){function n(e){classCallCheck(this,n);var t=e.local_storage;if(_.isObject(t)){this.name=t.name||"sxfData_"+e.token+"_sdk";"localStorage"===(t.type||"cookie")&&function(){var t=!0;try{var e="__sxfDatassupport__",n="sxfData_web_data_sdk";_.localStorage.set(e,n),_.localStorage.get(e)!==n&&(t=!1),_.localStorage.remove(e)}catch(e){t=!1}return t||console$1.error("localStorage 不支持，自动退回到cookie存储方式"),t}()?this.storage=_.localStorage:this.storage=_.cookie,this.load(),this.update_config(t),this.upgrade(),this.save()}else console$1.error("local_storage配置设置错误")}return createClass(n,[{key:"load",value:function(){var e=this.storage.parse(this.name);e&&(this.props=_.extend({},e))}},{key:"update_config",value:function(e){this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie)}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled&&this.remove()}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=!!e,this.remove(),this.save())}},{key:"upgrade",value:function(e){var t=void 0;this.storage===_.localStorage&&(t=_.cookie.parse(this.name),_.cookie.remove(this.name),_.cookie.remove(this.name,!0),t&&this.register_once(t))}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,_.JSONEncode(this.props),this.expire_days,this.cross_subdomain,this.secure)}},{key:"register",value:function(e,t){return!!_.isObject(e)&&(this.expire_days=void 0===t?this.default_expiry:t,_.extend(this.props,e),this.save(),!0)}},{key:"register_once",value:function(e,n,t){return!!_.isObject(e)&&(void 0===n&&(n="None"),this.expire_days=void 0===t?this.default_expiry:t,_.each(e,function(e,t){this.props[t]&&this.props[t]!==n||(this.props[t]=e)},this),this.save(),!0)}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"set_event_timer",value:function(e,t){var n=this.props.costTime||{};n[e]=t,this.props.costTime=n,this.save()}},{key:"remove_event_timer",value:function(e){var t=(this.props.costTime||{})[e];return _.isUndefined(t)||(delete this.props.costTime[e],this.save()),t}}]),n}();function on(e,t,n){if(e[t]){var i=e[t];e[t]=function(){var e=Array.prototype.slice.call(arguments);n.apply(this,e),i.apply(this,e)}}else e[t]=function(){var e=Array.prototype.slice.call(arguments);n.apply(this,e)}}function getPath(){return location.pathname+location.search}var SPA={config:{mode:"hash",track_replace_state:!1,callback_fn:function(){}},init:function(e){this.config=_.extend(this.config,e||{}),this.path=getPath(),this.url=document.URL,this.event()},event:function(){if("history"===this.config.mode){if(!history.pushState||!window.addEventListener)return;on(history,"pushState",this.pushStateOverride.bind(this)),on(history,"replaceState",this.replaceStateOverride.bind(this)),window.addEventListener("popstate",this.handlePopState.bind(this))}else"hash"===this.config.mode&&_.register_hash_event(this.handleHashState.bind(this))},pushStateOverride:function(){this.handleUrlChange(!0)},replaceStateOverride:function(){this.handleUrlChange(!1)},handlePopState:function(){this.handleUrlChange(!0)},handleHashState:function(){this.handleUrlChange(!0)},handleUrlChange:function(n){var i=this;setTimeout(function(){if("hash"===i.config.mode)_.isFunction(i.config.callback_fn)&&(i.config.callback_fn.call(),console.log("推送"),_.innerEvent.trigger("singlePage:change",{oldUrl:i.url,nowUrl:document.URL}),i.url=document.URL);else if("history"===i.config.mode){var e=i.path,t=getPath();e!=t&&i.shouldTrackUrlChange(t,e)&&(i.path=t,(n||i.config.track_replace_state)&&"function"==typeof i.config.callback_fn&&(i.config.callback_fn.call(),console.log("推送"),_.innerEvent.trigger("singlePage:change",{oldUrl:i.url,nowUrl:document.URL}),i.url=document.URL))}},0)},shouldTrackUrlChange:function(e,t){return!(!e||!t)}},CHANNEL=function(){function t(e){classCallCheck(this,t),this.instance=e,this.channel_params={},this.cookie_name="sxfData_"+this.instance._get_config("token")+"_c",this._set_channel_params()}return createClass(t,[{key:"_change",value:function(){}},{key:"_set_channel_params",value:function(){if(this._check_chennel())this.channel_params=this._url_channel_params(),this._save();else{var e=_.cookie.get(this.cookie_name);e&&(this.channel_params=_.JSONDecode(e))}}},{key:"_url_channel_params",value:function(){var e="utm_source utm_medium utm_campaign utm_content utm_term promotional_id".split(" "),t="",n={};return _.each(e,function(e){(t=_.getQueryParam(document.URL,e))&&(n[e]=t)}),n}},{key:"_check_chennel",value:function(){var e=this._url_channel_params(),t=!1;return e.utm_source&&e.utm_medium&&e.utm_campaign&&e.promotional_id&&(t=!0),t}},{key:"_save",value:function(){this._check_chennel()&&_.cookie.set(this.cookie_name,_.JSONEncode(this.channel_params),30,this.instance._get_config("local_storage").cross_subdomain_cookie)}},{key:"check_ad_click",value:function(){var e=!1,t=_.getQueryParam(document.URL,"t_re");return this._check_chennel()&&document.referrer&&!t&&(e=!0),e}},{key:"get_channel_params",value:function(){this._set_channel_params();var e={utmSource:this.channel_params.utm_source,utmMedium:this.channel_params.utm_medium,promotionalID:this.channel_params.promotional_id,utmCampaign:this.channel_params.utm_campaign,utmContent:this.channel_params.utm_content,utmTerm:this.channel_params.utm_term};return _.deleteEmptyProperty(e)}}]),t}(),BPOINT=function(){function BPOINT(e){classCallCheck(this,BPOINT),this.instance=e,this._infoStack=[],this._waitSendQueue=[],this._queueSending=!1,this._scanStackIntervalId=null,this._scanWaitSendQqueueIntervalId=null,this._loadFN=[]}return createClass(BPOINT,[{key:"_oldDataCheck",value:function _oldDataCheck(){var oldData=_.localStorage.get("_bp_wqueue");if(null!=oldData&&""!=oldData){try{if(oldData=eval("("+oldData+")"),_.isArray(oldData)&&0<oldData.length){var sendData={};for(sendData=_.localStorage.set("_bp_infoConf"),sendData=eval("("+sendData+")");0<oldData.length;)sendData=oldData.pop(),this._sendByImg(sendData)}}catch(e){}_.localStorage.remove("_bp_wqueue")}}},{key:"_scanStack",value:function(e){var t=this;if(!(null!=e&&1<=e))throw console$1.log("埋点内置对象丢失,栈扫描器创建失败",1),new ReferenceError("埋点内置对象丢失,栈扫描器创建失败");null!=this._scanStackIntervalId&&clearInterval(this._scanStackIntervalId),this._scanStackIntervalId=setInterval(function(){t.stack2queue()},1e3*e)}},{key:"_scanWaitSendQqueue",value:function(e){var t=this;if(!(null!=e&&1<=e))throw console$1.log("埋点内置对象丢失,队列扫描器创建失败",1),new ReferenceError("埋点内置对象丢失,队列扫描器创建失败");null!=this._scanWaitSendQqueueIntervalId&&clearInterval(this._scanWaitSendQqueueIntervalId),this._scanWaitSendQqueueIntervalId=setInterval(function(){console$1.log("开启等待发送--scanWaitSendQqueue"),t.send()},1e3*e)}},{key:"sendOldestStack",value:function(){var e=this._waitSendQueue.pop();_.localStorage&&_.localStorage.set("_bp_wqueue",JSON.stringify(this._waitSendQueue)),console$1.log("send stack(queue pop):");var t;t=e,this._sendByImg(t)}},{key:"_sendByImg",value:function(e){console$1.log("truncated_data",e);var t=this.instance._get_config("track_url"),n=this.instance._get_config("track_type");"img"===n&&(t+="track.gif"),_.sendRequest(t,n,{data:_.base64Encode(_.JSONEncode(e)),token:this.instance._get_config("token")},function(){})}},{key:"setStackSize",value:function(e){(e=parseInt(e))<1||(this._option.stackSize=e,this._infoStack.length>=e&&this.stack2queue())}},{key:"stack2queue",value:function(){console$1.log("开始扫描--scanStack");var e=this._infoStack;console$1.log("infoStack length="+e.length),0<e.length?(console$1.log(e),this._queueSave(e),this._infoStack=[]):(console$1.log("关闭扫描--_scanStackInterval"),clearInterval(this._scanStackIntervalId))}},{key:"_queueSave",value:function(e){this._waitSendQueue.push(e),this._scanWaitSendQqueue(CONFIG.queueTime),_.localStorage&&_.localStorage.set("_bp_wqueue",JSON.stringify(this._waitSendQueue))}},{key:"_stackSave",value:function(e){this._infoStack.push(e),this._infoStack.length>=CONFIG.stackSize&&this.stack2queue()}},{key:"send",value:function(){0==this._waitSendQueue.length||this._queueSending||this._send()}},{key:"_send",value:function(){var e=this;if(console$1.log("start send"),console$1.log("waitSendQueue length="+this._waitSendQueue.length),0==this._waitSendQueue.length)return console$1.log("关闭等待发送--_scanWaitSendQqueueInterval"),clearInterval(this._scanWaitSendQqueueIntervalId),void(this._queueSending=!1);this._queueSending=!0,setTimeout(function(){e.sendOldestStack(),e._send()},500)}},{key:"push",value:function(e){e&&(e.dateTime=(new Date).getTime(),console$1.log(e),this._scanStack(CONFIG.stackTime),this._stackSave(e))}}]),BPOINT}(),LOAD_CONTROL_JS=function(){function t(e){classCallCheck(this,t),this.instance=e,this._load_js()}return createClass(t,[{key:"_load_js",value:function(){}},{key:"_load_visualization",value:function(){}},{key:"is_visualization",value:function(){}}]),t}(),INPUTLISTEN=function(){function t(e){classCallCheck(this,t),this.instance=e}return createClass(t,[{key:"_addDomEventHandlers",value:function(e){var t=this,n=_.getById(e);this.bind(n,{focus:function(e){console$1.log("focus",e)},blur:function(e){console$1.log("blur",e)},keydown:function(e){console$1.log("keydown",e)},keyup:function(e){console$1.log("keyup",e),e&&8===e.keyCode&&(console$1.log("delete",e),t.instance.event.track("input_delete",{input_value:e.target.value}))},change:function(e){console$1.log("change",e)},click:function(e){console$1.log("click",e)},select:function(e){console$1.log("select",e)},input:function(e){console$1.log("input",e)},paste:function(e){console$1.log("paste",e)}})}},{key:"bind",value:function(e,t){if(e&&t){for(var n in t)e.addEventListener(n,t[n]);return e}}}]),t}(),SxfDataLib=function(){function n(e,t){classCallCheck(this,n),this.__loaded=!0,this._=_,this.config={},this._set_config(_.extend({},DEFAULT_CONFIG,CONFIG,t,{token:e})),this.local_storage=new LOCAL_STORAGE(this.config),this._loaded(),this.load_control_js=new LOAD_CONTROL_JS(this),this.event=new EVENT_TRACK(this),this.user=new USER_TRACK(this),this.channel=new CHANNEL(this),this.inputlisten=new INPUTLISTEN(this),this._set_device_id(),this._get_config("isBpoint")&&(this.bpoint=new BPOINT(this),this.bpoint._oldDataCheck(),this.bpoint._scanStack(CONFIG.stackTime)),this.channel.check_ad_click()&&this._ad_click(),this._track_pv(),this.local_storage.register_once({persistedTime:(new Date).getTime()},""),this._get_config("SPA").is&&this._SPA()}return createClass(n,[{key:"_ad_click",value:function(){this.track_event("sxfData_ad_click")}},{key:"_track_pv",value:function(e,t){this._get_config("pageview")?this.event.track_pv(e,t):this.event._session()}},{key:"_SPA",value:function(){var e=this;SPA.init({mode:this._get_config("SPA").mode,callback_fn:function(){e._track_pv()}})}},{key:"_set_config",value:function(e){_.isObject(e)&&(this.config=_.extend(this.config,e),CONFIG.DEBUG=CONFIG.DEBUG||this._get_config("debug"),CONFIG.isBpoint=CONFIG.isBpoint||this._get_config("isBpoint"))}},{key:"_get_config",value:function(e){return this.config[e]}},{key:"_loaded",value:function(){try{this._get_config("loaded")(this)}catch(e){console$1.error(e)}}},{key:"_set_device_id",value:function(){var e={};return this.get_device_id()||(this.local_storage.register_once({deviceId:_.UUID()},""),e=this.track_event("sxfData_activate")),e}},{key:"get_device_id",value:function(){return this.get_property("deviceId")}},{key:"get_property",value:function(e){return this.local_storage.props[e]}},{key:"_addlisten",value:function(e){this.inputlisten._addDomEventHandlers(e)}},{key:"time_event",value:function(e){this.event.time_event(e)}},{key:"track_pv",value:function(e,t){this.event.track_pv(e,t)}},{key:"track_event",value:function(e,t,n,i){this.event.track(e,t,n,i)}},{key:"register_event_super_properties",value:function(e,t){var n={},i=this.get_property("superProperties");_.isObject(e)?_.each(e,function(e,t){n[t]=e}):n[e]=t,i=_.extend({},i,n),this.local_storage.register({superProperties:i})}},{key:"register_event_super_properties_once",value:function(e,t){var n={},i=this.get_property("superProperties");_.isObject(e)?_.each(e,function(e,t){n[t]=e}):n[e]=t,i=_.extend({},n,i),this.local_storage.register({superProperties:i})}},{key:"unregister_event_super_properties",value:function(e){if(_.isString(e)){var t=this.get_property("superProperties");_.isObject(t)&&(delete t[e],this.local_storage.register({superProperties:t}))}}},{key:"clear_event_super_properties",value:function(){this.local_storage.register({superProperties:{}})}},{key:"current_event_super_properties",value:function(){return this.get_property("superProperties")}},{key:"login",value:function(e){this.event.login(e)}},{key:"logout",value:function(){this.event.logout()}}]),n}(),LoaderSync=function(){function e(){classCallCheck(this,e),window.sxfData=this}return createClass(e,[{key:"init",value:function(e,t){this.__loaded||(this.instance=new SxfDataLib(e,t),this.instance.init=this.init,window.sxfData=this.instance)}}]),e}(),index=new LoaderSync;module.exports=index;
//# sourceMappingURL=index.js.map
