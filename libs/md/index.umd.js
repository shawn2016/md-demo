!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.md=t()}(this,function(){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n={track_url:"http://localhost:3300/",debug:!1,local_storage:{type:"localStorage",name:"",disable:!1,secure_cookie:!1,cross_subdomain_cookie:!1,cookie_expiration:1e3},loaded:function(){},track_type:"img",SPA:{is:!1,mode:"hash"},pageview:!0,truncateLength:-1,session_interval_mins:30,auto_visualization_src:"http://localhost:3300/build/plugins/auto_visualization/main.js"},_={DEBUG:!1,LIB_VERSION:"0.1.0"},s="se",g={smart_session_start:{data_type:s},smart_session_close:{data_type:s},smart_pv:{data_type:s},smart_ad_click:{data_type:s},smart_activate:{data_type:s},smart_abtest:{data_type:s},smart_error:{data_type:s},smart_u_signup:{data_type:s},smart_u_login:{data_type:s},smart_u_logout:{data_type:s},smart_u_property:{data_type:s}},t=["$deviceUdid","$toekn"],e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=window.device,c={},u=[];window.device=c;var l=window.document.documentElement,d=window.navigator.userAgent.toLowerCase(),h=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"];function f(e){return-1!==d.indexOf(e)}function p(e){return l.className.match(new RegExp(e,"i"))}function m(e){var t=null;p(e)||(t=l.className.replace(/^\s+|\s+$/g,""),l.className=t+" "+e)}function v(e){p(e)&&(l.className=l.className.replace(" "+e,""))}function b(){c.landscape()?(v("portrait"),m("landscape"),y("landscape")):(v("landscape"),m("portrait"),y("portrait")),x()}function y(e){for(var t in u)u[t](e)}c.macos=function(){return f("mac")},c.ios=function(){return c.iphone()||c.ipod()||c.ipad()},c.iphone=function(){return!c.windows()&&f("iphone")},c.ipod=function(){return f("ipod")},c.ipad=function(){return f("ipad")},c.android=function(){return!c.windows()&&f("android")},c.androidPhone=function(){return c.android()&&f("mobile")},c.androidTablet=function(){return c.android()&&!f("mobile")},c.blackberry=function(){return f("blackberry")||f("bb10")||f("rim")},c.blackberryPhone=function(){return c.blackberry()&&!f("tablet")},c.blackberryTablet=function(){return c.blackberry()&&f("tablet")},c.windows=function(){return f("windows")},c.windowsPhone=function(){return c.windows()&&f("phone")},c.windowsTablet=function(){return c.windows()&&f("touch")&&!c.windowsPhone()},c.fxos=function(){return(f("(mobile")||f("(tablet"))&&f(" rv:")},c.fxosPhone=function(){return c.fxos()&&f("mobile")},c.fxosTablet=function(){return c.fxos()&&f("tablet")},c.meego=function(){return f("meego")},c.cordova=function(){return window.cordova&&"file:"===location.protocol},c.nodeWebkit=function(){return"object"===e(window.process)},c.mobile=function(){return c.androidPhone()||c.iphone()||c.ipod()||c.windowsPhone()||c.blackberryPhone()||c.fxosPhone()||c.meego()},c.tablet=function(){return c.ipad()||c.androidTablet()||c.blackberryTablet()||c.windowsTablet()||c.fxosTablet()},c.desktop=function(){return!c.tablet()&&!c.mobile()},c.television=function(){for(var e=0;e<h.length;){if(f(h[e]))return!0;e++}return!1},c.portrait=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?screen.orientation.type.includes("portrait"):1<window.innerHeight/window.innerWidth},c.landscape=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?screen.orientation.type.includes("landscape"):window.innerHeight/window.innerWidth<1},c.noConflict=function(){return window.device=a,this},c.ios()?c.ipad()?m("ios ipad tablet"):c.iphone()?m("ios iphone mobile"):c.ipod()&&m("ios ipod mobile"):c.macos()?m("macos desktop"):c.android()?c.androidTablet()?m("android tablet"):m("android mobile"):c.blackberry()?c.blackberryTablet()?m("blackberry tablet"):m("blackberry mobile"):c.windows()?c.windowsTablet()?m("windows tablet"):c.windowsPhone()?m("windows mobile"):m("windows desktop"):c.fxos()?c.fxosTablet()?m("fxos tablet"):m("fxos mobile"):c.meego()?m("meego mobile"):c.nodeWebkit()?m("node-webkit"):c.television()?m("television"):c.desktop()&&m("desktop"),c.cordova()&&m("cordova"),c.onChangeOrientation=function(e){"function"==typeof e&&u.push(e)};var w="resize";function k(e){for(var t=0;t<e.length;t++)if(c[e[t]]())return e[t];return"unknown"}function x(){c.orientation=k(["portrait","landscape"])}Object.prototype.hasOwnProperty.call(window,"onorientationchange")&&(w="orientationchange"),window.addEventListener?window.addEventListener(w,b,!1):window.attachEvent?window.attachEvent(w,b):window[w]=b,b(),c.type=k(["mobile","tablet","desktop"]),c.os=k(["ios","iphone","ipad","ipod","android","blackberry","windows","fxos","meego","television"]),x();function S(e){var t,n,i,r,o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,c=0,u="",l=[];if(!e)return e;for(e=function(e){var t,n,i,r,o="";for(t=n=0,i=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,r=0;r<i;r++){var a=e.charCodeAt(r),s=null;a<128?n++:s=127<a&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==s&&(t<n&&(o+=e.substring(t,n)),o+=s,t=n=r+1)}return t<n&&(o+=e.substring(t,e.length)),o}(e);t=(o=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++))>>18&63,n=o>>12&63,i=o>>6&63,r=63&o,l[c++]=a.charAt(t)+a.charAt(n)+a.charAt(i)+a.charAt(r),s<e.length;);switch(u=l.join(""),e.length%3){case 1:u=u.slice(0,-2)+"==";break;case 2:u=u.slice(0,-1)+"="}return u}var O=void 0;function T(e){return Object.prototype.toString.call(e)}O="undefined"==typeof window?{navigator:{userAgent:""},location:{pathname:"",href:""},document:{},screen:{width:"",height:""}}:window;var U="-1",P=O.external,A=O.navigator.userAgent||"",E=O.navigator.appVersion||"",j=O.navigator.vendor||"",z=/\b(?:msie |ie |trident\/[0-9].*rv[ :])([0-9.]+)/,C=/\bbb10\b.+?\bversion\/([\d.]+)/,L=/\bblackberry\b.+\bversion\/([\d.]+)/,R=/\bblackberry\d+\/([\d.]+)/,D=[["nokia",function(e){return-1!==e.indexOf("nokia ")?/\bnokia ([0-9]+)?/:/\bnokia([a-z0-9]+)?/}],["samsung",function(e){return-1!==e.indexOf("samsung")?/\bsamsung(?:[ \-](?:sgh|gt|sm))?-([a-z0-9]+)/:/\b(?:sgh|sch|gt|sm)-([a-z0-9]+)/}],["wp",function(e){return-1!==e.indexOf("windows phone ")||-1!==e.indexOf("xblwp")||-1!==e.indexOf("zunewp")||-1!==e.indexOf("windows ce")}],["pc","windows"],["ipad","ipad"],["ipod","ipod"],["iphone",/\biphone\b|\biph(\d)/],["mac","macintosh"],["mi",/\bmi[ \-]?([a-z0-9 ]+(?= build|\)))/],["hongmi",/\bhm\b|redmi[ \-]?([a-z0-9]+)/],["aliyun",/\baliyunos\b(?:[\-](\d+))?/],["meizu",function(e){return 0<=e.indexOf("meizu")?/\bmeizu[\/ ]([a-z0-9]+)\b/:/\bm([0-9cx]{1,4})\b/}],["nexus",/\bnexus ([0-9s.]+)/],["huawei",function(e){var t=/\bmediapad (.+?)(?= build\/huaweimediapad\b)/;return-1!==e.indexOf("huawei-huawei")?/\bhuawei\-huawei\-([a-z0-9\-]+)/:t.test(e)?t:/\bhuawei[ _\-]?([a-z0-9]+)/}],["lenovo",function(e){return-1!==e.indexOf("lenovo-lenovo")?/\blenovo\-lenovo[ \-]([a-z0-9]+)/:/\blenovo[ \-]?([a-z0-9]+)/}],["zte",function(e){return/\bzte\-[tu]/.test(e)?/\bzte-[tu][ _\-]?([a-su-z0-9\+]+)/:/\bzte[ _\-]?([a-su-z0-9\+]+)/}],["vivo",/\bvivo(?: ([a-z0-9]+))?/],["htc",function(e){return/\bhtc[a-z0-9 _\-]+(?= build\b)/.test(e)?/\bhtc[ _\-]?([a-z0-9 ]+(?= build))/:/\bhtc[ _\-]?([a-z0-9 ]+)/}],["oppo",/\boppo[_]([a-z0-9]+)/],["konka",/\bkonka[_\-]([a-z0-9]+)/],["sonyericsson",/\bmt([a-z0-9]+)/],["coolpad",/\bcoolpad[_ ]?([a-z0-9]+)/],["lg",/\blg[\-]([a-z0-9]+)/],["android",/\bandroid\b|\badr\b/],["blackberry",function(e){return 0<=e.indexOf("blackberry")?/\bblackberry\s?(\d+)/:"bb10"}]],I=[["wp",function(e){return-1!==e.indexOf("windows phone ")?/\bwindows phone (?:os )?([0-9.]+)/:-1!==e.indexOf("xblwp")?/\bxblwp([0-9.]+)/:-1!==e.indexOf("zunewp")?/\bzunewp([0-9.]+)/:"windows phone"}],["windows",/\bwindows nt ([0-9.]+)/],["macosx",/\bmac os x ([0-9._]+)/],["iOS",function(e){return/\bcpu(?: iphone)? os /.test(e)?/\bcpu(?: iphone)? os ([0-9._]+)/:-1!==e.indexOf("iph os ")?/\biph os ([0-9_]+)/:/\bios\b/}],["yunos",/\baliyunos ([0-9.]+)/],["Android",function(e){return 0<=e.indexOf("android")?/\bandroid[ \/-]?([0-9.x]+)?/:0<=e.indexOf("adr")?0<=e.indexOf("mqqbrowser")?/\badr[ ]\(linux; u; ([0-9.]+)?/:/\badr(?:[ ]([0-9.]+))?/:"android"}],["chromeos",/\bcros i686 ([0-9.]+)/],["linux","linux"],["windowsce",/\bwindows ce(?: ([0-9.]+))?/],["symbian",/\bsymbian(?:os)?\/([0-9.]+)/],["blackberry",function(e){var t=e.match(C)||e.match(L)||e.match(R);return t?{version:t[1]}:"blackberry"}]],N=[["edgehtml",/edge\/([0-9.]+)/],["trident",z],["blink",function(){return"chrome"in O&&"CSS"in O&&/\bapplewebkit[\/]?([0-9.+]+)/}],["webkit",/\bapplewebkit[\/]?([0-9.+]+)/],["gecko",function(e){var t;if(t=e.match(/\brv:([\d\w.]+).*\bgecko\/(\d+)/))return{version:t[1]+"."+t[2]}}],["presto",/\bpresto\/([0-9.]+)/],["androidwebkit",/\bandroidwebkit\/([0-9.]+)/],["coolpadwebkit",/\bcoolpadwebkit\/([0-9.]+)/],["u2",/\bu2\/([0-9.]+)/],["u3",/\bu3\/([0-9.]+)/]],V=[["edge",/edge\/([0-9.]+)/],["sogou",function(e){return 0<=e.indexOf("sogoumobilebrowser")?/sogoumobilebrowser\/([0-9.]+)/:0<=e.indexOf("sogoumse")||/ se ([0-9.x]+)/}],["theworld",function(){var e=M("theworld");return void 0!==e?e:"theworld"}],["360",function(e){var t=M("360se");return void 0!==t?t:-1!==e.indexOf("360 aphone browser")?/\b360 aphone browser \(([^\)]+)\)/:/\b360(?:se|ee|chrome|browser)\b/}],["maxthon",function(){try{if(P&&(P.mxVersion||P.max_version))return{version:P.mxVersion||P.max_version}}catch(e){}return/\b(?:maxthon|mxbrowser)(?:[ \/]([0-9.]+))?/}],["micromessenger",/\bmicromessenger\/([\d.]+)/],["qq",/\bm?qqbrowser\/([0-9.]+)/],["green","greenbrowser"],["tt",/\btencenttraveler ([0-9.]+)/],["liebao",function(e){if(0<=e.indexOf("liebaofast"))return/\bliebaofast\/([0-9.]+)/;if(-1===e.indexOf("lbbrowser"))return!1;var t;try{P&&P.LiebaoGetVersion&&(t=P.LiebaoGetVersion())}catch(e){}return{version:t||U}}],["tao",/\btaobrowser\/([0-9.]+)/],["coolnovo",/\bcoolnovo\/([0-9.]+)/],["saayaa","saayaa"],["baidu",/\b(?:ba?idubrowser|baiduhd)[ \/]([0-9.x]+)/],["ie",z],["mi",/\bmiuibrowser\/([0-9.]+)/],["opera",function(e){var t=/\bopera.+version\/([0-9.ab]+)/;return t.test(e)?t:/\bopr\/([0-9.]+)/}],["oupeng",/\boupeng\/([0-9.]+)/],["yandex",/yabrowser\/([0-9.]+)/],["ali-ap",function(e){return 0<e.indexOf("aliapp")?/\baliapp\(ap\/([0-9.]+)\)/:/\balipayclient\/([0-9.]+)\b/}],["ali-ap-pd",/\baliapp\(ap-pd\/([0-9.]+)\)/],["ali-am",/\baliapp\(am\/([0-9.]+)\)/],["ali-tb",/\baliapp\(tb\/([0-9.]+)\)/],["ali-tb-pd",/\baliapp\(tb-pd\/([0-9.]+)\)/],["ali-tm",/\baliapp\(tm\/([0-9.]+)\)/],["ali-tm-pd",/\baliapp\(tm-pd\/([0-9.]+)\)/],["uc",function(e){return 0<=e.indexOf("ucbrowser/")?/\bucbrowser\/([0-9.]+)/:0<=e.indexOf("ubrowser/")?/\bubrowser\/([0-9.]+)/:/\buc\/[0-9]/.test(e)?/\buc\/([0-9.]+)/:0<=e.indexOf("ucweb")?/\bucweb([0-9.]+)?/:/\b(?:ucbrowser|uc)\b/}],["chrome",/ (?:chrome|crios|crmo)\/([0-9.]+)/],["android",function(e){if(-1!==e.indexOf("android"))return/\bversion\/([0-9.]+(?: beta)?)/}],["blackberry",function(e){var t=e.match(C)||e.match(L)||e.match(R);return t?{version:t[1]}:"blackberry"}],["safari",/\bversion\/([0-9.]+(?: beta)?)(?: mobile(?:\/[a-z0-9]+)?)? safari\//],["webview",/\bcpu(?: iphone)? os (?:[0-9._]+).+\bapplewebkit\b/],["firefox",/\bfirefox\/([0-9.ab]+)/],["nokia",/\bnokiabrowser\/([0-9.]+)/]];function M(e){if(P)try{var t=P.twGetRunPath.toLowerCase(),n=P.twGetSecurityID(O),i=P.twGetVersion(n);if(t&&-1===t.indexOf(e))return!1;if(i)return{version:i}}catch(e){}}function B(e,t,n){var i=function(e){return"[object Function]"===T(e)}(t)?t.call(null,n):t;if(!i)return null;var r={name:e,version:U,codename:""},o=T(i);if(!0===i)return r;if("[object String]"===o){if(-1!==n.indexOf(i))return r}else{if(function(e){return"[object Object]"===T(e)}(i))return i.hasOwnProperty("version")&&(r.version=i.version),r;if(i.exec){var a=i.exec(n);if(a)return 2<=a.length&&a[1]?r.version=a[1].replace(/_/g,"."):r.version=U,r}}}var q={name:"",version:""};function F(n,e,t,i){var r=q;!function(e,t){for(var n=0,i=e.length;n<i&&!1!==t.call(e,e[n],n);n++);}(e,function(e){var t=B(e[0],e[1],n);if(t)return r=t,!1}),t.call(i,r.name,r.version)}var H=function(e){e=(e||"").toLowerCase();var r={};F(e,D,function(e,t){var n=parseFloat(t);r.device={name:e,version:n,fullVersion:t},r.device[e]=n},r),F(e,I,function(e,t){var n=parseFloat(t);r.os={name:e,version:n,fullVersion:t},r.os[e]=n},r);var o=function(e){if(!z.test(e))return null;var t,n,i,r,o;if(-1!==e.indexOf("trident/")&&(t=/\btrident\/([0-9.]+)/.exec(e))&&2<=t.length){i=t[1];var a=t[1].split(".");a[0]=parseInt(a[0],10)+4,o=a.join(".")}r=(t=z.exec(e))[1];var s=t[1].split(".");return void 0===o&&(o=r),s[0]=parseInt(s[0],10)-4,n=s.join("."),void 0===i&&(i=n),{browserVersion:o,browserMode:r,engineVersion:i,engineMode:n,compatible:i!==n}}(e);return F(e,N,function(e,t){var n=t;o&&(t=o.engineVersion||o.engineMode,n=o.engineMode);var i=parseFloat(t);r.engine={name:e,version:i,fullVersion:t,mode:parseFloat(n),fullMode:n,compatible:!!o&&o.compatible},r.engine[e]=i},r),F(e,V,function(e,t){var n=t;o&&("ie"===e&&(t=o.browserVersion),n=o.browserMode);var i=parseFloat(t);r.browser={name:e,version:i,fullVersion:t,mode:parseFloat(n),fullMode:n,compatible:!!o&&o.compatible},r.browser[e]=i},r),r}(A+" "+E+" "+j),J=void 0;J="undefined"==typeof window?{navigator:{userAgent:""},location:{pathname:"",href:""},document:{URL:""},screen:{width:"",height:""}}:window;var G={},W={each:function(e,t,n){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i,e)===G)return}else for(var o in e)if(e.hasOwnProperty.call(e,o)&&t.call(n,e[o],o,e)===G)return},extend:function(n){return W.each(Array.prototype.slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(n[t]=e[t])}),n},isObject:function(e){return e===Object(e)&&!W.isArray(e)},isUndefined:function(e){return void 0===e},isArguments:function(e){return!(!e||!hasOwnProperty.call(e,"callee"))},toArray:function(e){return e?e.toArray?e.toArray():W.isArray(e)?Array.prototype.slice.call(e):W.isArguments(e)?Array.prototype.slice.call(e):W.values(e):[]},values:function(e){var t=[];return null===e||W.each(e,function(e){t[t.length]=e}),t},JSONDecode:function(e){try{return JSON.parse(e)}catch(e){return{}}},JSONEncode:function(e){try{return JSON.stringify(e)}catch(e){return""}},isFunction:function(e){var t=!1;return"function"==typeof e&&(t=!0),t},base64Encode:function(e){return S(e)},sha1:function(e){return""},truncate:function(e,n){var i=void 0;return"string"==typeof e?i=e.slice(0,n):W.isArray(e)?(i=[],W.each(e,function(e){i.push(W.truncate(e,n))})):W.isObject(e)?(i={},W.each(e,function(e,t){i[t]=W.truncate(e,n)})):i=e,i},isNumber:function(e){return"[object Number]"==Object.prototype.toString.call(e)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},HTTPBuildQuery:function(e,t){var n=void 0,i=void 0,r=[];return W.isUndefined(t)&&(t="&"),W.each(e,function(e,t){n=encodeURIComponent(e.toString()),i=encodeURIComponent(t),r[r.length]=i+"="+n}),r.join(t)},trim:function(e){if(e)return e.replace(/(^\s*)|(\s*$)/g,"")},checkTime:function(e){return!!e&&!!/^(\d{4})-(\d{2})-(\d{2})$/.test(e)},getHost:function(e){var t="",n=(e=e||document.URL).match(/.*\:\/\/([^\/]*).*/);return n&&(t=n[1]),t},getQueryParam:function(e,t){var n=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(e);return null===i||i&&"string"!=typeof i[1]&&i[1].length?"":decodeURIComponent(i[1]).replace(/\+/g," ")},deleteEmptyProperty:function(e){if(this.isObject(e)){for(var t in e)e.hasOwnProperty(t)&&(null!==e[t]&&!this.isUndefined(e[t])&&""!==e[t]||delete e[t]);return e}}};function Q(e){return e&&(e.preventDefault=Q.preventDefault,e.stopPropagation=Q.stopPropagation),e}function $(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)}W.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.apply(e)},W.loadScript=function(e){e=W.extend({success:function(){},error:function(){},appendCall:function(e){document.getElementsByTagName("head")[0].appendChild(e)}},e);var t=null;"css"===e.type&&((t=document.createElement("link")).rel="stylesheet",t.href=e.url),"js"===e.type&&((t=document.createElement("script")).async="async",t.setAttribute("charset","UTF-8"),t.src=e.url,t.type="text/javascript"),t.onload=t.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e.success(),t.onload=t.onreadystatechange=null)},t.onerror=function(){e.error(),t.onerror=null},e.appendCall(t)},W.register_event=(Q.preventDefault=function(){this.returnValue=!1},Q.stopPropagation=function(){this.cancelBubble=!0},function(e,t,n,i,r){if(e)if(e.addEventListener&&!i)e.addEventListener(t,n,!!r);else{var o="on"+t,a=e[o];e[o]=function(r,o,a){return function(e){if(e=e||Q(window.event)){var t,n,i=!0;return W.isFunction(a)&&(t=a(e)),n=o.call(r,e),!1!==t&&!1!==n||(i=!1),i}}}(e,n,a)}else K.error("No valid element provided to register_event")}),W.register_hash_event=function(e){W.register_event(window,"hashchange",e)},W.info={domain:function(e){var t=e.split("/");return 3<=t.length?t[2]:""},deviceModel:function(){var e="";if(c.android()){var t=J.navigator.userAgent.split(";"),n=t.indexOf("Build/");-1<n&&(e=t[n].substring(0,t[n].indexOf("Build/")))}else c.ios()&&c.iphone()&&(e="iPhone");return e},properties:function(){var e={"5.0":"Win2000",5.1:"WinXP",5.2:"Win2003","6.0":"WindowsVista",6.1:"Win7",6.2:"Win8",6.3:"Win8.1","10.0":"Win10"},t=c.type,n=W.trim(this.deviceModel()),i=c.windows(),r=H.os.name+" "+H.os.fullVersion;return i&&e[H.os.fullVersion]&&(r=e[H.os.fullVersion]),{deviceModel:n,deviceOs:H.os.name,deviceOsVersion:r,devicePlatform:t,browser:H.browser.name,browserVersion:H.browser.fullVersion,title:J.document.title||"",urlPath:J.location.pathname||"",currentUrl:document.URL,currentDomain:this.domain(document.URL),referrer:J.document.referrer,referringDomain:this.domain(J.document.referrer),language:J.navigator.language||"",screenWidth:J.screen.width,screenHeight:J.screen.height}}},W.innerEvent={on:function(e,t){this._list||(this._list={}),this._list[e]||(this._list[e]=[]),this._list[e].push(t)},off:function(e){this._list||(this._list={}),this._list[e]&&delete this._list[e]},trigger:function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=this._list&&this._list[t];if(n&&0!==n.length)for(var i=0;i<n.length;i++)"function"==typeof n[i]&&n[i].apply(this,e)}},W.sendRequest=function(e,t,n,i){if(n._=(new Date).getTime().toString(),"img"===t){e+="?"+W.HTTPBuildQuery(n);var r=document.createElement("img");r.src=e,r.width=1,r.height=1,W.isFunction(i)&&i(0),r.onload=function(){this.onload=null},r.onerror=function(){this.onerror=null},r.onabort=function(){this.onabort=null}}else"get"===t?(e+="?"+W.HTTPBuildQuery(n),W.ajax.get(e,i)):"post"===t&&W.ajax.get(e,n,i)},W.ajax={post:function(e,t,n,i){var r=this;r.callback=n||function(e){};try{var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/json"),o.withCredentials=!0,o.ontimeout=function(){r.callback({status:0,error:!0,message:"request "+e+" time out"})},o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)r.callback(W.JSONDecode(o.responseText));else{var e="Bad HTTP status: "+o.status+" "+o.statusText;r.callback({status:0,error:!0,message:e})}},o.timeout=i||5e3,o.send(W.JSONEncode(t))}catch(e){}},get:function(e,t){try{var n=new XMLHttpRequest;n.open("GET",e,!0),n.withCredentials=!0,n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status)t&&t(n.responseText);else if(t){var e="Bad HTTP status: "+n.status+" "+n.statusText;t({status:0,error:!0,message:e})}},n.send(null)}catch(e){}}},W.UUID=function(){var e=String(screen.height*screen.width);e=e&&/\d{5,}/.test(e)?e.toString(16):String(31242*Math.random()).replace(".","").slice(0,8);var t=$()+"-"+Math.random().toString(16).replace(".","")+"-"+function(){var e,t,n=navigator.userAgent,r=[],i=0;function o(e,t){var n,i=0;for(n=0;n<t.length;n++)i|=r[n]<<8*n;return e^i}for(e=0;e<n.length;e++)t=n.charCodeAt(e),r.unshift(255&t),4<=r.length&&(i=o(i,r),r=[]);return 0<r.length&&(i=o(i,r)),i.toString(16)}()+"-"+e+"-"+$();return t||(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15)},W.localStorage={error:function(e){K.error("localStorage error: "+e)},get:function(e){try{return window.localStorage.getItem(e)}catch(e){W.localStorage.error(e)}return null},parse:function(e){try{return W.JSONDecode(W.localStorage.get(e))||{}}catch(e){}return null},set:function(e,t){try{window.localStorage.setItem(e,t)}catch(e){W.localStorage.error(e)}},remove:function(e){try{window.localStorage.removeItem(e)}catch(e){W.localStorage.error(e)}}},W.cookie={get:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return null},parse:function(e){var t;try{t=W.JSONDecode(W.cookie.get(e))||{}}catch(e){}return t},set_seconds:function(e,t,n,i,r){var o="",a="",s="";if(i){var c=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),u=c?c[0]:"";o=u?"; domain=."+u:""}if(n){var l=new Date;l.setTime(l.getTime()+1e3*n),a="; expires="+l.toGMTString()}r&&(s="; secure"),document.cookie=e+"="+encodeURIComponent(t)+a+"; path=/"+o+s},set:function(e,t,n,i,r){var o="",a="",s="";if(i){var c=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),u=c?c[0]:"";o=u?"; domain=."+u:""}if(n){var l=new Date;l.setTime(l.getTime()+24*n*60*60*1e3),a="; expires="+l.toGMTString()}r&&(s="; secure");var d=e+"="+encodeURIComponent(t)+a+"; path=/"+o+s;return document.cookie=d},remove:function(e,t){W.cookie.set(e,"",-1,t)}};var X=J.console,K={log:function(){if(_.DEBUG&&!W.isUndefined(X)&&X)try{X.log.apply(X,arguments)}catch(e){W.each(arguments,function(e){X.log(e)})}},error:function(){if(_.DEBUG&&!W.isUndefined(X)&&X){var t=["DATracker error:"].concat(W.toArray(arguments));try{X.error.apply(X,t)}catch(e){W.each(t,function(e){X.error(e)})}}}},Y=(i(Z,[{key:"_is_reserved_property",value:function(e){return-1<t.indexOf("prop")}},{key:"_send_request",value:function(e,t){W.isFunction(t)||(t=function(){}),e=e||{};var n={dataType:s,deviceId:this.instance.get_device_id(),userId:this.instance.get_property("user_id"),time:(new Date).getTime(),sdkType:"js",eventId:"smart_user_property",persistedTime:this.instance.get_property("persistedTime"),pageOpenScene:"Browser",attributes:e};n=W.extend({},n,this.instance.channel.get_channel_params());var i=this.instance._get_config("truncateLength"),r=n;W.isNumber(i)&&0<i&&(r=W.truncate(n,i)),K.log("上报的数据（截取后）:",r);var o=this.instance._get_config("track_url"),a=this.instance._get_config("track_type");"img"===a&&(o+="track.gif"),W.sendRequest(o,a,{data:W.base64Encode(W.JSONEncode(r)),token:this.instance._get_config("token")},function(e){t(e,n)})}},{key:"set",value:function(e,t,n){var i=this,r={};return W.isObject(e)?(W.each(e,function(e,t){i._is_reserved_property(t)||(r[t]=e)}),n=t):r[e]=t,this._send_request(r,n)}}]),Z);function Z(e){r(this,Z),this.instance=e,this.local_storage=this.instance.local_storage}var ee=(i(te,[{key:"_check_channel",value:function(){var e=this.instance.get_property("sessionReferrer"),t=!1;return W.getHost(e)!==window.location.host&&(t=!0),t}},{key:"_event_is_disabled",value:function(e){return!1}},{key:"_start_new_session",value:function(){this.local_storage.register({sessionUuid:W.UUID(),sessionStartTime:(new Date).getTime()}),this.track("smart_session_start")}},{key:"_close_cur_session",value:function(){var e=(new Date).getTime()-1,t=this.instance.get_property("sessionStartTime"),n=this.instance.get_property("LASTEVENT");n&&n.time&&(e=n.time+1);var i=e-t;0<=i&&this.track("smart_session_close",{sessionCloseTime:e,sessionTotalLength:i})}},{key:"_session",value:function(e){var t=1*this.instance.get_property("sessionStartTime")/1e3,n=1*this.instance.get_property("updatedTime")/1e3,i=(new Date).getTime(),r=1*i/1e3,o=this._check_channel();(0==t||r>n+60*this.instance._get_config("session_interval_mins")||o)&&(0==t||this._close_cur_session(),this._start_new_session()),this.local_storage.register({updatedTime:i}),W.isFunction(e)&&e()}},{key:"_signup",value:function(e){var t=this.instance.get_property("userId");t!==e&&(t&&this.logout(),this.track("smart_u_signup",{anonymousId:t,newUserId:e}))}},{key:"time_event",value:function(e){W.isUndefined(e)?K.error("事件耗时监听器需要一个事件名称"):this._event_is_disabled(e)||this.local_storage.set_event_timer(e,(new Date).getTime())}},{key:"track_pv",value:function(e,t){var n=this;this._session(function(){n.track("smart_pv",W.extend({},e),t)})}},{key:"track",value:function(e,t,n,i){if(W.isUndefined(e))K.error("上报数据需要一个事件名称");else if(W.isFunction(n)||(n=function(){}),this._event_is_disabled(e))n(0);else{this.local_storage.load(),t=t||{};var r=W.JSONDecode(W.JSONEncode(t))||{},o=void 0,a=this.local_storage.remove_event_timer(e);W.isUndefined(a)||(o=(new Date).getTime()-a);var s="be";i?s=i:g[e]&&(s=g[e].data_type);var c=(new Date).getTime();"smart_session_close"===e&&(c=t.sessionCloseTime,delete r.sessionCloseTime,delete r.sessionTotalLength),r=W.extend({},this.instance.get_property("superProperties"),r);var u={dataType:s,userId:this.instance.get_property("userId"),sdkType:"js",sdkVersion:_.LIB_VERSION,eventId:e,time:c,persistedTime:this.instance.get_property("persistedTime"),deviceId:this.instance.get_device_id(),pageOpenScene:"Browser",token:this.instance._get_config("token"),costTime:o,sessionTotalLength:t.sessionTotalLength,sessionUuid:this.instance.get_property("sessionUuid"),attributes:r};if(u=W.extend({},u,W.info.properties()),u=W.extend({},u,this.instance.channel.get_channel_params()),"be"===s&&this._check_channel()&&this.local_storage.register({sessionReferrer:document.URL}),this.instance._get_config("SPA").is||0<["smart_activate","smart_session_close"].indexOf(e)&&this.local_storage.register({sessionReferrer:document.URL}),this.instance._get_config("SPA").is){var l=this.instance.get_property("sessionReferrer");l!==u.referrer&&(u.referrer=l,u.referringDomain=W.info.domain(l))}var d=this.instance._get_config("truncateLength"),h=u;W.isNumber(d)&&0<d&&(h=W.truncate(u,d)),K.log("上报的数据（截取后）:",h);var f=this.instance._get_config("track_url"),p=this.instance._get_config("track_type");"img"===p&&(f+="track.gif"),W.sendRequest(f,p,{data:W.base64Encode(W.JSONEncode(h)),token:this.instance._get_config("token")},function(e){n(e,u)}),-1===["smart_session_start","smart_session_close","smart_activate"].indexOf(e)&&this._session(),-1===["smart_session_start","smart_session_close"].indexOf(e)&&this.local_storage.register({LASTEVENT:{eventId:e,time:c}})}}},{key:"login",value:function(e){this._signup(e),this.local_storage.register({userId:e}),this.track("smart_u_login")}},{key:"logout",value:function(){this.local_storage.unregister("userId"),this.track("smart_u_logout")}}]),te);function te(e){var n=this;r(this,te),this.instance=e,this.local_storage=this.instance.local_storage,this.local_storage.register_once({updatedTime:0,sessionStartTime:0}),this.local_storage.register({sessionReferrer:document.referrer});var i=document.URL;W.innerEvent.on("singlePage:change",function(e,t){n.local_storage.register({sessionReferrer:i}),i=document.URL})}var ne=(i(ie,[{key:"load",value:function(){var e=this.storage.parse(this.name);e&&(this.props=W.extend({},e))}},{key:"update_config",value:function(e){this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie)}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled&&this.remove()}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=!!e,this.remove(),this.save())}},{key:"upgrade",value:function(e){var t=void 0;this.storage===W.localStorage&&(t=W.cookie.parse(this.name),W.cookie.remove(this.name),W.cookie.remove(this.name,!0),t&&this.register_once(t))}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,W.JSONEncode(this.props),this.expire_days,this.cross_subdomain,this.secure)}},{key:"register",value:function(e,t){return!!W.isObject(e)&&(this.expire_days=void 0===t?this.default_expiry:t,W.extend(this.props,e),this.save(),!0)}},{key:"register_once",value:function(e,n,t){return!!W.isObject(e)&&(void 0===n&&(n="None"),this.expire_days=void 0===t?this.default_expiry:t,W.each(e,function(e,t){this.props[t]&&this.props[t]!==n||(this.props[t]=e)},this),this.save(),!0)}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"set_event_timer",value:function(e,t){var n=this.props.costTime||{};n[e]=t,this.props.costTime=n,this.save()}},{key:"remove_event_timer",value:function(e){var t=(this.props.costTime||{})[e];return W.isUndefined(t)||(delete this.props.costTime[e],this.save()),t}}]),ie);function ie(e){r(this,ie);var t=e.local_storage;if(W.isObject(t)){this.name=t.name||"smart_"+e.token+"_sdk";"localStorage"===(t.type||"cookie")&&function(){var t=!0;try{var e="__smartssupport__",n="smart_web_data_sdk";W.localStorage.set(e,n),W.localStorage.get(e)!==n&&(t=!1),W.localStorage.remove(e)}catch(e){t=!1}return t||K.error("localStorage 不支持，自动退回到cookie存储方式"),t}()?this.storage=W.localStorage:this.storage=W.cookie,this.load(),this.update_config(t),this.upgrade(),this.save()}else K.error("local_storage配置设置错误")}function re(e,t,n){if(e[t]){var i=e[t];e[t]=function(){var e=Array.prototype.slice.call(arguments);n.apply(this,e),i.apply(this,e)}}else e[t]=function(){var e=Array.prototype.slice.call(arguments);n.apply(this,e)}}function oe(){return location.pathname+location.search}var ae={config:{mode:"hash",track_replace_state:!1,callback_fn:function(){}},init:function(e){this.config=W.extend(this.config,e||{}),this.path=oe(),this.url=document.URL,this.event()},event:function(){if("history"===this.config.mode){if(!history.pushState||!window.addEventListener)return;re(history,"pushState",this.pushStateOverride.bind(this)),re(history,"replaceState",this.replaceStateOverride.bind(this)),window.addEventListener("popstate",this.handlePopState.bind(this))}else"hash"===this.config.mode&&W.register_hash_event(this.handleHashState.bind(this))},pushStateOverride:function(){this.handleUrlChange(!0)},replaceStateOverride:function(){this.handleUrlChange(!1)},handlePopState:function(){this.handleUrlChange(!0)},handleHashState:function(){this.handleUrlChange(!0)},handleUrlChange:function(n){var i=this;setTimeout(function(){if("hash"===i.config.mode)W.isFunction(i.config.callback_fn)&&(i.config.callback_fn.call(),W.innerEvent.trigger("singlePage:change",{oldUrl:i.url,nowUrl:document.URL}),i.url=document.URL);else if("history"===i.config.mode){var e=i.path,t=oe();e!=t&&i.shouldTrackUrlChange(t,e)&&(i.path=t,(n||i.config.track_replace_state)&&"function"==typeof i.config.callback_fn&&(i.config.callback_fn.call(),W.innerEvent.trigger("singlePage:change",{oldUrl:i.url,nowUrl:document.URL}),i.url=document.URL))}},0)},shouldTrackUrlChange:function(e,t){return!(!e||!t)}},se=(i(ce,[{key:"_change",value:function(){}},{key:"_set_channel_params",value:function(){if(this._check_chennel())this.channel_params=this._url_channel_params(),this._save();else{var e=W.cookie.get(this.cookie_name);e&&(this.channel_params=W.JSONDecode(e))}}},{key:"_url_channel_params",value:function(){var e="utm_source utm_medium utm_campaign utm_content utm_term promotional_id".split(" "),t="",n={};return W.each(e,function(e){(t=W.getQueryParam(document.URL,e))&&(n[e]=t)}),n}},{key:"_check_chennel",value:function(){var e=this._url_channel_params(),t=!1;return e.utm_source&&e.utm_medium&&e.utm_campaign&&e.promotional_id&&(t=!0),t}},{key:"_save",value:function(){this._check_chennel()&&W.cookie.set(this.cookie_name,W.JSONEncode(this.channel_params),30,this.instance._get_config("local_storage").cross_subdomain_cookie)}},{key:"check_ad_click",value:function(){var e=!1,t=W.getQueryParam(document.URL,"t_re");return this._check_chennel()&&document.referrer&&!t&&(e=!0),e}},{key:"get_channel_params",value:function(){this._set_channel_params();var e={utmSource:this.channel_params.utm_source,utmMedium:this.channel_params.utm_medium,promotionalID:this.channel_params.promotional_id,utmCampaign:this.channel_params.utm_campaign,utmContent:this.channel_params.utm_content,utmTerm:this.channel_params.utm_term};return W.deleteEmptyProperty(e)}}]),ce);function ce(e){r(this,ce),this.instance=e,this.channel_params={},this.cookie_name="smart_"+this.instance._get_config("token")+"_c",this._set_channel_params()}var ue=(i(le,[{key:"_load_js",value:function(){}},{key:"_load_visualization",value:function(){}},{key:"is_visualization",value:function(){}}]),le);function le(e){r(this,le),this.instance=e,this._load_js()}var de=(i(he,[{key:"_ad_click",value:function(){this.track_event("smart_ad_click")}},{key:"_track_pv",value:function(e,t){this._get_config("pageview")?this.event.track_pv(e,t):this.event._session()}},{key:"_SPA",value:function(){var e=this;ae.init({mode:this._get_config("SPA").mode,callback_fn:function(){e._track_pv()}})}},{key:"_set_config",value:function(e){W.isObject(e)&&(this.config=W.extend(this.config,e),_.DEBUG=_.DEBUG||this._get_config("debug"))}},{key:"_get_config",value:function(e){return this.config[e]}},{key:"_loaded",value:function(){try{this._get_config("loaded")(this)}catch(e){K.error(e)}}},{key:"_set_device_id",value:function(){var e={};return this.get_device_id()||(this.local_storage.register_once({deviceId:W.UUID()},""),e=this.track_event("smart_activate")),e}},{key:"get_device_id",value:function(){return this.get_property("deviceId")}},{key:"get_property",value:function(e){return this.local_storage.props[e]}},{key:"time_event",value:function(e){this.event.time_event(e)}},{key:"track_pv",value:function(e,t){this.event.track_pv(e,t)}},{key:"track_event",value:function(e,t,n,i){this.event.track(e,t,n,i)}},{key:"register_event_super_properties",value:function(e,t){var n={},i=this.get_property("superProperties");W.isObject(e)?W.each(e,function(e,t){n[t]=e}):n[e]=t,i=W.extend({},i,n),this.local_storage.register({superProperties:i})}},{key:"register_event_super_properties_once",value:function(e,t){var n={},i=this.get_property("superProperties");W.isObject(e)?W.each(e,function(e,t){n[t]=e}):n[e]=t,i=W.extend({},n,i),this.local_storage.register({superProperties:i})}},{key:"unregister_event_super_properties",value:function(e){if(W.isString(e)){var t=this.get_property("superProperties");W.isObject(t)&&(delete t[e],this.local_storage.register({superProperties:t}))}}},{key:"clear_event_super_properties",value:function(){this.local_storage.register({superProperties:{}})}},{key:"current_event_super_properties",value:function(){return this.get_property("superProperties")}},{key:"login",value:function(e){this.event.login(e)}},{key:"logout",value:function(){this.event.logout()}}]),he);function he(e,t){r(this,he),this.__loaded=!0,this._=W,this.config={},this._set_config(W.extend({},n,_,t,{token:e})),this.local_storage=new ne(this.config),this._loaded(),this.load_control_js=new ue(this),this.event=new ee(this),this.user=new Y(this),this.channel=new se(this),this._set_device_id(),this.channel.check_ad_click()&&this._ad_click(),this._track_pv(),this.local_storage.register_once({persistedTime:(new Date).getTime()},""),this._get_config("SPA").is&&this._SPA()}function fe(){r(this,fe),window.smart=this}return new(i(fe,[{key:"init",value:function(e,t){this.__loaded||(this.instance=new de(e,t),this.instance.init=this.init,window.smart=this.instance)}}]),fe)});
//# sourceMappingURL=index.umd.js.map
