{"version":3,"file":"index.umd.js","sources":["../../src/md/config.js","../../src/md/device.js","../../src/md/coding.js","../../src/md/useragent.js","../../src/md/utils.js","../../src/md/user_track.js","../../src/md/event_track.js","../../src/md/local_storage.js","../../src/md/spa.js","../../src/md/channel.js","../../src/md/load_control_js.js","../../src/md/index.js"],"sourcesContent":["// 默认配置\r\nconst DEFAULT_CONFIG = {\r\n  // 上报服务器域名配置\r\n  'track_url': 'http://localhost:3300/',\r\n  // debug启动配置\r\n  'debug': false,\r\n  // 本地存储配置\r\n  'local_storage': {\r\n    // 存储方式  localStorage || cookie\r\n    'type': 'localStorage',\r\n    // 存储名称\r\n    'name': '',\r\n    // 关闭存储功能\r\n    'disable': false,\r\n    // cookie存储时，采用安全的存储方式，即：\r\n    //当secure属性设置为true时，cookie只有在https协议下才能上传到服务器，而在http协议下是没法上传的，所以也不会被窃听\r\n    'secure_cookie': false,\r\n    // cookie存储时，跨主域名存储配置\r\n    'cross_subdomain_cookie': false,\r\n    // cookie方法存储时，配置保存过期时间\r\n    'cookie_expiration': 1000\r\n  },\r\n  // 初始化sdk时触发的方法\r\n  'loaded': function() {},\r\n  // 上报数据实现形式  post, get, img\r\n  'track_type': 'img',\r\n  // 单页面应用配置\r\n  'SPA': {\r\n    // 开启SPA配置\r\n    'is': false,\r\n    // SPA 实现类型，hash || history\r\n    'mode': 'hash'\r\n  },\r\n  // PV指标自动触发配置\r\n  'pageview': true,\r\n  // 上报数据前，每个字段长度截取配置，默认不截取\r\n  'truncateLength': -1,\r\n  // 会话超时时长，默认30分钟\r\n  'session_interval_mins': 30,\r\n  // 远程拉取可视化圈选插件地址\r\n  'auto_visualization_src': 'http://localhost:3300/build/plugins/auto_visualization/main.js'\r\n};\r\n\r\n\r\n// 配置\r\nconst CONFIG = {\r\n  DEBUG: false,\r\n  LIB_VERSION: '0.1.0'\r\n};\r\n\r\n// 系统事件类型（事件分为：系统事件和业务事件）\r\nconst SYSTEM_EVENT_TYPE = 'se';\r\n\r\n// 业务事件类型\r\nconst BUSSINESS_EVENT_TYPE = 'be';\r\n\r\n// 系统事件列表\r\nconst SYSTEM_EVENT_OBJECT = {\r\n  // 会话开始事件\r\n  'smart_session_start': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 会话结束事件\r\n  'smart_session_close': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // PV事件\r\n  'smart_pv': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 广告点击事件\r\n  'smart_ad_click': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户首次访问网站事件\r\n  'smart_activate': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // A/B 测试事件\r\n  'smart_abtest': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 异常错误事件\r\n  'smart_error': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户注册事件\r\n  'smart_u_signup': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户登录事件\r\n  'smart_u_login': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户登出事件\r\n  'smart_u_logout': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  },\r\n  // 用户属性设置事件\r\n  'smart_u_property': {\r\n    'data_type': SYSTEM_EVENT_TYPE\r\n  }\r\n};\r\n\r\n// People类系统保留属性，用户设置这些属性将无法成功\r\nconst PEOPLE_RESERVED_PROPERTY = ['$deviceUdid', '$toekn'];\r\n\r\n// People类属性事件id，全局唯一\r\nconst PEOPLE_PROPERTY_ID = 'smart_user_property';\r\n\r\n// 渠道推广参数全局配置, 左边sdk内部使用的参数，右边实际url上的参数\r\n// 若url上推广的参数不一致，请修改对应右边的值（一一对应）\r\n// 注意：系统暂时未支持自定义配置（TODO）,若要改动，请到文件 src/channel.js 修改。\r\nconst CHANNEL_PARAMS = {\r\n  // 广告来源(必须字段)\r\n  utm_source: 'utm_source',\r\n  // 广告媒介(必须字段)\r\n  utm_medium: 'utm_medium',\r\n  // 广告名称(必须字段)\r\n  utm_campaign: 'utm_campaign',\r\n  // 广告内容(选填)\r\n  utm_content: 'utm_content',\r\n  // 广告关键词(选填)\r\n  utm_term: 'utm_term',\r\n  // 广告id(必须字段)\r\n  promotional_id: 'promotional_id'\r\n};\r\n\r\n\r\nexport {\r\n  CONFIG,\r\n  DEFAULT_CONFIG,\r\n  SYSTEM_EVENT_TYPE,\r\n  BUSSINESS_EVENT_TYPE,\r\n  SYSTEM_EVENT_OBJECT,\r\n  PEOPLE_RESERVED_PROPERTY,\r\n  PEOPLE_PROPERTY_ID,\r\n  CHANNEL_PARAMS\r\n};\r\n","\r\n// Save the previous value of the device variable.\r\nvar previousDevice = window.device;\r\n\r\nvar device = {};\r\n\r\nvar changeOrientationList = [];\r\n\r\n// Add device as a global object.\r\nwindow.device = device;\r\n\r\n// The <html> element.\r\nvar documentElement = window.document.documentElement;\r\n\r\n// The client user agent string.\r\n// Lowercase, so we can use the more efficient indexOf(), instead of Regex\r\nvar userAgent = window.navigator.userAgent.toLowerCase();\r\n\r\n// Detectable television devices.\r\nvar television = ['googletv', 'viera', 'smarttv', 'internet.tv', 'netcast', 'nettv', 'appletv', 'boxee', 'kylo', 'roku', 'dlnadoc', 'roku', 'pov_tv', 'hbbtv', 'ce-html'];\r\n\r\n// Main functions\r\n// --------------\r\n\r\ndevice.macos = function () {\r\n  return find('mac');\r\n};\r\n\r\ndevice.ios = function () {\r\n  return device.iphone() || device.ipod() || device.ipad();\r\n};\r\n\r\ndevice.iphone = function () {\r\n  return !device.windows() && find('iphone');\r\n};\r\n\r\ndevice.ipod = function () {\r\n  return find('ipod');\r\n};\r\n\r\ndevice.ipad = function () {\r\n  return find('ipad');\r\n};\r\n\r\ndevice.android = function () {\r\n  return !device.windows() && find('android');\r\n};\r\n\r\ndevice.androidPhone = function () {\r\n  return device.android() && find('mobile');\r\n};\r\n\r\ndevice.androidTablet = function () {\r\n  return device.android() && !find('mobile');\r\n};\r\n\r\ndevice.blackberry = function () {\r\n  return find('blackberry') || find('bb10') || find('rim');\r\n};\r\n\r\ndevice.blackberryPhone = function () {\r\n  return device.blackberry() && !find('tablet');\r\n};\r\n\r\ndevice.blackberryTablet = function () {\r\n  return device.blackberry() && find('tablet');\r\n};\r\n\r\ndevice.windows = function () {\r\n  return find('windows');\r\n};\r\n\r\ndevice.windowsPhone = function () {\r\n  return device.windows() && find('phone');\r\n};\r\n\r\ndevice.windowsTablet = function () {\r\n  return device.windows() && find('touch') && !device.windowsPhone();\r\n};\r\n\r\ndevice.fxos = function () {\r\n  return (find('(mobile') || find('(tablet')) && find(' rv:');\r\n};\r\n\r\ndevice.fxosPhone = function () {\r\n  return device.fxos() && find('mobile');\r\n};\r\n\r\ndevice.fxosTablet = function () {\r\n  return device.fxos() && find('tablet');\r\n};\r\n\r\ndevice.meego = function () {\r\n  return find('meego');\r\n};\r\n\r\ndevice.cordova = function () {\r\n  return window.cordova && location.protocol === 'file:';\r\n};\r\n\r\ndevice.nodeWebkit = function () {\r\n  return typeof (window.process) === 'object';\r\n};\r\n\r\ndevice.mobile = function () {\r\n  return device.androidPhone() || device.iphone() || device.ipod() || device.windowsPhone() || device.blackberryPhone() || device.fxosPhone() || device.meego();\r\n};\r\n\r\ndevice.tablet = function () {\r\n  return device.ipad() || device.androidTablet() || device.blackberryTablet() || device.windowsTablet() || device.fxosTablet();\r\n};\r\n\r\ndevice.desktop = function () {\r\n  return !device.tablet() && !device.mobile();\r\n};\r\n\r\ndevice.television = function () {\r\n  var i = 0;\r\n  while (i < television.length) {\r\n    if (find(television[i])) {\r\n      return true;\r\n    }\r\n    i++;\r\n  }\r\n  return false;\r\n};\r\n\r\ndevice.portrait = function () {\r\n  if (screen.orientation && Object.prototype.hasOwnProperty.call(window, 'onorientationchange')) {\r\n    return screen.orientation.type.includes('portrait');\r\n  }\r\n  return window.innerHeight / window.innerWidth > 1;\r\n};\r\n\r\ndevice.landscape = function () {\r\n  if (screen.orientation && Object.prototype.hasOwnProperty.call(window, 'onorientationchange')) {\r\n    return screen.orientation.type.includes('landscape');\r\n  }\r\n  return window.innerHeight / window.innerWidth < 1;\r\n};\r\n\r\n// Public Utility Functions\r\n// ------------------------\r\n\r\n// Run device.js in noConflict mode,\r\n// returning the device variable to its previous owner.\r\ndevice.noConflict = function () {\r\n  window.device = previousDevice;\r\n  return this;\r\n};\r\n\r\n// Private Utility Functions\r\n// -------------------------\r\n\r\n// Simple UA string search\r\nfunction find(needle) {\r\n  return userAgent.indexOf(needle) !== -1;\r\n}\r\n\r\n// Check if documentElement already has a given class.\r\nfunction hasClass(className) {\r\n  return documentElement.className.match(new RegExp(className, 'i'));\r\n}\r\n\r\n// Add one or more CSS classes to the <html> element.\r\nfunction addClass(className) {\r\n  var currentClassNames = null;\r\n  if (!hasClass(className)) {\r\n    currentClassNames = documentElement.className.replace(/^\\s+|\\s+$/g, '');\r\n    documentElement.className = currentClassNames + ' ' + className;\r\n  }\r\n}\r\n\r\n// Remove single CSS class from the <html> element.\r\nfunction removeClass(className) {\r\n  if (hasClass(className)) {\r\n    documentElement.className = documentElement.className.replace(' ' + className, '');\r\n  }\r\n}\r\n\r\n// HTML Element Handling\r\n// ---------------------\r\n\r\n// Insert the appropriate CSS class based on the _user_agent.\r\n\r\nif (device.ios()) {\r\n  if (device.ipad()) {\r\n    addClass('ios ipad tablet');\r\n  } else if (device.iphone()) {\r\n    addClass('ios iphone mobile');\r\n  } else if (device.ipod()) {\r\n    addClass('ios ipod mobile');\r\n  }\r\n} else if (device.macos()) {\r\n  addClass('macos desktop');\r\n} else if (device.android()) {\r\n  if (device.androidTablet()) {\r\n    addClass('android tablet');\r\n  } else {\r\n    addClass('android mobile');\r\n  }\r\n} else if (device.blackberry()) {\r\n  if (device.blackberryTablet()) {\r\n    addClass('blackberry tablet');\r\n  } else {\r\n    addClass('blackberry mobile');\r\n  }\r\n} else if (device.windows()) {\r\n  if (device.windowsTablet()) {\r\n    addClass('windows tablet');\r\n  } else if (device.windowsPhone()) {\r\n    addClass('windows mobile');\r\n  } else {\r\n    addClass('windows desktop');\r\n  }\r\n} else if (device.fxos()) {\r\n  if (device.fxosTablet()) {\r\n    addClass('fxos tablet');\r\n  } else {\r\n    addClass('fxos mobile');\r\n  }\r\n} else if (device.meego()) {\r\n  addClass('meego mobile');\r\n} else if (device.nodeWebkit()) {\r\n  addClass('node-webkit');\r\n} else if (device.television()) {\r\n  addClass('television');\r\n} else if (device.desktop()) {\r\n  addClass('desktop');\r\n}\r\n\r\nif (device.cordova()) {\r\n  addClass('cordova');\r\n}\r\n\r\n// Orientation Handling\r\n// --------------------\r\n\r\n// Handle device orientation changes.\r\nfunction handleOrientation() {\r\n  if (device.landscape()) {\r\n    removeClass('portrait');\r\n    addClass('landscape');\r\n    walkOnChangeOrientationList('landscape');\r\n  } else {\r\n    removeClass('landscape');\r\n    addClass('portrait');\r\n    walkOnChangeOrientationList('portrait');\r\n  }\r\n  setOrientationCache();\r\n}\r\n\r\nfunction walkOnChangeOrientationList(newOrientation) {\r\n  for (var index in changeOrientationList) {\r\n    changeOrientationList[index](newOrientation);\r\n  }\r\n}\r\n\r\ndevice.onChangeOrientation = function (cb) {\r\n  if (typeof cb == 'function') {\r\n    changeOrientationList.push(cb);\r\n  }\r\n};\r\n\r\n// Detect whether device supports orientationchange event,\r\n// otherwise fall back to the resize event.\r\nvar orientationEvent = 'resize';\r\nif (Object.prototype.hasOwnProperty.call(window, 'onorientationchange')) {\r\n  orientationEvent = 'orientationchange';\r\n}\r\n\r\n// Listen for changes in orientation.\r\nif (window.addEventListener) {\r\n  window.addEventListener(orientationEvent, handleOrientation, false);\r\n} else if (window.attachEvent) {\r\n  window.attachEvent(orientationEvent, handleOrientation);\r\n} else {\r\n  window[orientationEvent] = handleOrientation;\r\n}\r\n\r\nhandleOrientation();\r\n\r\n// Public functions to get the current value of type, os, or orientation\r\n// ---------------------------------------------------------------------\r\n\r\nfunction findMatch(arr) {\r\n  for (var i = 0; i < arr.length; i++) {\r\n    if (device[arr[i]]()) {\r\n      return arr[i];\r\n    }\r\n  }\r\n  return 'unknown';\r\n}\r\n\r\ndevice.type = findMatch(['mobile', 'tablet', 'desktop']);\r\ndevice.os = findMatch(['ios', 'iphone', 'ipad', 'ipod', 'android', 'blackberry', 'windows', 'fxos', 'meego', 'television']);\r\n\r\nfunction setOrientationCache() {\r\n  device.orientation = findMatch(['portrait', 'landscape']);\r\n}\r\n\r\nsetOrientationCache();\r\n\r\nexport default device;","\nconst utf8Encode = function(string) {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n    var utftext = '',\n        start,\n        end;\n    var stringl = 0,\n        n;\n\n    start = end = 0;\n    stringl = string.length;\n\n    for (n = 0; n < stringl; n++) {\n        var c1 = string.charCodeAt(n);\n        var enc = null;\n\n        if (c1 < 128) {\n            end++;\n        } else if ((c1 > 127) && (c1 < 2048)) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128);\n        }\n        if (enc !== null) {\n            if (end > start) {\n                utftext += string.substring(start, end);\n            }\n            utftext += enc;\n            start = end = n + 1;\n        }\n    }\n\n    if (end > start) {\n        utftext += string.substring(start, string.length);\n    }\n\n    return utftext;\n};\n\nconst base64Encode = function(data) {\n    var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,\n        ac = 0,\n        enc = '',\n        tmp_arr = [];\n\n    if (!data) {\n        return data;\n    }\n\n    data = utf8Encode(data);\n\n    do { // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n\n        bits = o1 << 16 | o2 << 8 | o3;\n\n        h1 = bits >> 18 & 0x3f;\n        h2 = bits >> 12 & 0x3f;\n        h3 = bits >> 6 & 0x3f;\n        h4 = bits & 0x3f;\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n            break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n            break;\n    }\n\n    return enc;\n};\n\nconst sha1 = function(str){\n    \n   /*\n     * A Javascript implementation of the Secure Hash Algorithm, SHA-1, as defined\n     * in FIPS PUB 180-1\n     * Version 2.1-BETA Copyright Paul Johnston 2000 - 2002.\n     * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n     * Distributed under the BSD License\n     * See http://pajhome.org.uk/crypt/md5 for details.\n     */\n    /*\n     * Configurable variables. You may need to tweak these to be compatible with\n     * the server-side, but the defaults work in most cases.\n     */\n    var hexcase = 0; /* hex output format. 0 - lowercase; 1 - uppercase     */\n    var b64pad = \"\"; /* base-64 pad character. \"=\" for strict RFC compliance  */\n    var chrsz = 8; /* bits per input character. 8 - ASCII; 16 - Unicode    */\n    /*\n     * These are the functions you'll usually want to call\n     * They take string arguments and return either hex or base-64 encoded strings\n     */\n    function hex_sha1(s) {\n     return binb2hex(core_sha1(str2binb(s), s.length * chrsz));\n    }\n    function b64_sha1(s) {\n     return binb2b64(core_sha1(str2binb(s), s.length * chrsz));\n    }\n    function str_sha1(s) {\n     return binb2str(core_sha1(str2binb(s), s.length * chrsz));\n    }\n    function hex_hmac_sha1(key, data) {\n     return binb2hex(core_hmac_sha1(key, data));\n    }\n    function b64_hmac_sha1(key, data) {\n     return binb2b64(core_hmac_sha1(key, data));\n    }\n    function str_hmac_sha1(key, data) {\n     return binb2str(core_hmac_sha1(key, data));\n    }\n    /*\n     * Perform a simple self-test to see if the VM is working\n     */\n    function sha1_vm_test() {\n     return hex_sha1(\"abc\") == \"a9993e364706816aba3e25717850c26c9cd0d89d\";\n    }\n    /*\n     * Calculate the SHA-1 of an array of big-endian words, and a bit length\n     */\n    function core_sha1(x, len) {\n     /* append padding */\n     x[len >> 5] |= 0x80 << (24 - len % 32);\n     x[((len + 64 >> 9) << 4) + 15] = len;\n     var w = Array(80);\n     var a = 1732584193;\n     var b = -271733879;\n     var c = -1732584194;\n     var d = 271733878;\n     var e = -1009589776;\n     for (var i = 0; i < x.length; i += 16) {\n      var olda = a;\n      var oldb = b;\n      var oldc = c;\n      var oldd = d;\n      var olde = e;\n      for (var j = 0; j < 80; j++) {\n       if (j < 16) w[j] = x[i + j];\n       else w[j] = rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);\n       var t = safe_add(safe_add(rol(a, 5), sha1_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), sha1_kt(j)));\n       e = d;\n       d = c;\n       c = rol(b, 30);\n       b = a;\n       a = t;\n      }\n      a = safe_add(a, olda);\n      b = safe_add(b, oldb);\n      c = safe_add(c, oldc);\n      d = safe_add(d, oldd);\n      e = safe_add(e, olde);\n     }\n     return Array(a, b, c, d, e);\n    }\n    /*\n     * Perform the appropriate triplet combination function for the current\n     * iteration\n     */\n    function sha1_ft(t, b, c, d) {\n     if (t < 20) return (b & c) | ((~b) & d);\n     if (t < 40) return b ^ c ^ d;\n     if (t < 60) return (b & c) | (b & d) | (c & d);\n     return b ^ c ^ d;\n    }\n    /*\n     * Determine the appropriate additive constant for the current iteration\n     */\n    function sha1_kt(t) {\n     return (t < 20) ? 1518500249 : (t < 40) ? 1859775393 : (t < 60) ? -1894007588 : -899497514;\n    }\n    /*\n     * Calculate the HMAC-SHA1 of a key and some data\n     */\n    function core_hmac_sha1(key, data) {\n     var bkey = str2binb(key);\n     if (bkey.length > 16) bkey = core_sha1(bkey, key.length * chrsz);\n     var ipad = Array(16),\n      opad = Array(16);\n     for (var i = 0; i < 16; i++) {\n      ipad[i] = bkey[i] ^ 0x36363636;\n      opad[i] = bkey[i] ^ 0x5C5C5C5C;\n     }\n     var hash = core_sha1(ipad.concat(str2binb(data)), 512 + data.length * chrsz);\n     return core_sha1(opad.concat(hash), 512 + 160);\n    }\n    /*\n     * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n     * to work around bugs in some JS interpreters.\n     */\n    function safe_add(x, y) {\n     var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n     var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n     return (msw << 16) | (lsw & 0xFFFF);\n    }\n    /*\n     * Bitwise rotate a 32-bit number to the left.\n     */\n    function rol(num, cnt) {\n     return (num << cnt) | (num >>> (32 - cnt));\n    }\n    /*\n     * Convert an 8-bit or 16-bit string to an array of big-endian words\n     * In 8-bit function, characters >255 have their hi-byte silently ignored.\n     */\n    function str2binb(str) {\n     var bin = Array();\n     var mask = (1 << chrsz) - 1;\n     for (var i = 0; i < str.length * chrsz; i += chrsz)\n     bin[i >> 5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i % 32);\n     return bin;\n    }\n    /*\n     * Convert an array of big-endian words to a string\n     */\n    function binb2str(bin) {\n     var str = \"\";\n     var mask = (1 << chrsz) - 1;\n     for (var i = 0; i < bin.length * 32; i += chrsz)\n     str += String.fromCharCode((bin[i >> 5] >>> (24 - i % 32)) & mask);\n     return str;\n    }\n    /*\n     * Convert an array of big-endian words to a hex string.\n     */\n    function binb2hex(binarray) {\n     var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\n     var str = \"\";\n     for (var i = 0; i < binarray.length * 4; i++) {\n      str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) + hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);\n     }\n     return str;\n    }\n    /*\n     * Convert an array of big-endian words to a base-64 string\n     */\n    function binb2b64(binarray) {\n     var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n     var str = \"\";\n     for (var i = 0; i < binarray.length * 4; i += 3) {\n      var triplet = (((binarray[i >> 2] >> 8 * (3 - i % 4)) & 0xFF) << 16) | (((binarray[i + 1 >> 2] >> 8 * (3 - (i + 1) % 4)) & 0xFF) << 8) | ((binarray[i + 2 >> 2] >> 8 * (3 - (i + 2) % 4)) & 0xFF);\n      for (var j = 0; j < 4; j++) {\n       if (i * 8 + j * 6 > binarray.length * 32) str += b64pad;\n       else str += tab.charAt((triplet >> 6 * (3 - j)) & 0x3F);\n      }\n     }\n     return str;\n    }\n\n    return hex_sha1(str);\n};\n\nexport {\n  utf8Encode,\n  base64Encode,\n  sha1\n}","// 兼容单元测试环境\r\nlet win;\r\nif (typeof(window) === 'undefined') {\r\n    win = {\r\n      navigator: {\r\n        userAgent: ''\r\n      },\r\n      location: {\r\n        pathname: '',\r\n        href: ''\r\n      },\r\n      document: {\r\n        \r\n      },\r\n      screen: {\r\n        width: '',\r\n        height: ''\r\n      }\r\n    };\r\n} else {\r\n  win = window;\r\n}\r\n\r\nfunction toString(object) {\r\n    return Object.prototype.toString.call(object);\r\n  }\r\n  \r\n  function isObject(object) {\r\n    return toString(object) === \"[object Object]\";\r\n  }\r\n  \r\n  function isFunction(object) {\r\n     return toString(object) === \"[object Function]\";\r\n  }\r\n  \r\n  function each(object, factory) {\r\n      for (var i = 0, l = object.length; i < l; i++) {\r\n          if (factory.call(object, object[i], i) === false) {\r\n          break;\r\n          }\r\n      }\r\n  }\r\n\r\nvar NA_VERSION = \"-1\";\r\nvar external = win.external;\r\nvar userAgent = win.navigator.userAgent || \"\";\r\nvar appVersion = win.navigator.appVersion || \"\";\r\nvar vendor = win.navigator.vendor || \"\";\r\nvar detector = {};\r\n\r\nvar re_msie = /\\b(?:msie |ie |trident\\/[0-9].*rv[ :])([0-9.]+)/;\r\nvar re_blackberry_10 = /\\bbb10\\b.+?\\bversion\\/([\\d.]+)/;\r\nvar re_blackberry_6_7 = /\\bblackberry\\b.+\\bversion\\/([\\d.]+)/;\r\nvar re_blackberry_4_5 = /\\bblackberry\\d+\\/([\\d.]+)/;\r\n\r\n// http://zakwu.me/2015/12/15/an-zhuo-shou-ji-uashou-ji/ 参考\r\n// 硬件设备信息识别表达式。\r\n// 使用数组可以按优先级排序。\r\nvar DEVICES = [\r\n  [\"nokia\", function(ua) {\r\n      // 不能将两个表达式合并，因为可能出现 \"nokia; nokia 960\"\r\n      // 这种情况下会优先识别出 nokia/-1\r\n      if (ua.indexOf(\"nokia \") !== -1) {\r\n      return /\\bnokia ([0-9]+)?/;\r\n      } else {\r\n      return /\\bnokia([a-z0-9]+)?/;\r\n      }\r\n  }],\r\n  // 三星有 Android 和 WP 设备。\r\n  [\"samsung\", function(ua) {\r\n      if (ua.indexOf(\"samsung\") !== -1) {\r\n      return /\\bsamsung(?:[ \\-](?:sgh|gt|sm))?-([a-z0-9]+)/;\r\n      } else {\r\n      return /\\b(?:sgh|sch|gt|sm)-([a-z0-9]+)/;\r\n      }\r\n  }],\r\n  [\"wp\", function(ua) {\r\n      return ua.indexOf(\"windows phone \") !== -1 ||\r\n      ua.indexOf(\"xblwp\") !== -1 ||\r\n      ua.indexOf(\"zunewp\") !== -1 ||\r\n      ua.indexOf(\"windows ce\") !== -1;\r\n  }],\r\n  [\"pc\", \"windows\"],\r\n  [\"ipad\", \"ipad\"],\r\n  // ipod 规则应置于 iphone 之前。\r\n  [\"ipod\", \"ipod\"],\r\n  [\"iphone\", /\\biphone\\b|\\biph(\\d)/],\r\n  [\"mac\", \"macintosh\"],\r\n  // 小米\r\n  [\"mi\", /\\bmi[ \\-]?([a-z0-9 ]+(?= build|\\)))/],\r\n  // 红米\r\n  [\"hongmi\", /\\bhm\\b|redmi[ \\-]?([a-z0-9]+)/],\r\n  [\"aliyun\", /\\baliyunos\\b(?:[\\-](\\d+))?/],\r\n  [\"meizu\", function(ua) {\r\n      return ua.indexOf(\"meizu\") >= 0 ?\r\n      /\\bmeizu[\\/ ]([a-z0-9]+)\\b/\r\n      :\r\n      /\\bm([0-9cx]{1,4})\\b/;\r\n  }],\r\n  [\"nexus\", /\\bnexus ([0-9s.]+)/],\r\n  [\"huawei\", function(ua) {\r\n      var re_mediapad = /\\bmediapad (.+?)(?= build\\/huaweimediapad\\b)/;\r\n      if (ua.indexOf(\"huawei-huawei\") !== -1) {\r\n      return /\\bhuawei\\-huawei\\-([a-z0-9\\-]+)/;\r\n      } else if (re_mediapad.test(ua)) {\r\n      return re_mediapad;\r\n      } else {\r\n      return /\\bhuawei[ _\\-]?([a-z0-9]+)/;\r\n      }\r\n  }],\r\n  [\"lenovo\", function(ua) {\r\n      if (ua.indexOf(\"lenovo-lenovo\") !== -1) {\r\n      return /\\blenovo\\-lenovo[ \\-]([a-z0-9]+)/;\r\n      } else {\r\n      return /\\blenovo[ \\-]?([a-z0-9]+)/;\r\n      }\r\n  }],\r\n  // 中兴\r\n  [\"zte\", function(ua) {\r\n      if (/\\bzte\\-[tu]/.test(ua)) {\r\n      return /\\bzte-[tu][ _\\-]?([a-su-z0-9\\+]+)/;\r\n      } else {\r\n      return /\\bzte[ _\\-]?([a-su-z0-9\\+]+)/;\r\n      }\r\n  }],\r\n  // 步步高\r\n  [\"vivo\", /\\bvivo(?: ([a-z0-9]+))?/],\r\n  [\"htc\", function(ua) {\r\n      if (/\\bhtc[a-z0-9 _\\-]+(?= build\\b)/.test(ua)) {\r\n      return /\\bhtc[ _\\-]?([a-z0-9 ]+(?= build))/;\r\n      } else {\r\n      return /\\bhtc[ _\\-]?([a-z0-9 ]+)/;\r\n      }\r\n  }],\r\n  [\"oppo\", /\\boppo[_]([a-z0-9]+)/],\r\n  [\"konka\", /\\bkonka[_\\-]([a-z0-9]+)/],\r\n  [\"sonyericsson\", /\\bmt([a-z0-9]+)/],\r\n  [\"coolpad\", /\\bcoolpad[_ ]?([a-z0-9]+)/],\r\n  [\"lg\", /\\blg[\\-]([a-z0-9]+)/],\r\n  [\"android\", /\\bandroid\\b|\\badr\\b/],\r\n  [\"blackberry\", function(ua) {\r\n      if (ua.indexOf(\"blackberry\") >= 0) {\r\n      return /\\bblackberry\\s?(\\d+)/;\r\n      }\r\n      return \"bb10\";\r\n  }]\r\n];\r\n// 操作系统信息识别表达式\r\nvar OS = [\r\n  [\"wp\", function(ua) {\r\n      if (ua.indexOf(\"windows phone \") !== -1) {\r\n      return /\\bwindows phone (?:os )?([0-9.]+)/;\r\n      } else if (ua.indexOf(\"xblwp\") !== -1) {\r\n      return /\\bxblwp([0-9.]+)/;\r\n      } else if (ua.indexOf(\"zunewp\") !== -1) {\r\n      return /\\bzunewp([0-9.]+)/;\r\n      }\r\n      return \"windows phone\";\r\n  }],\r\n  [\"windows\", /\\bwindows nt ([0-9.]+)/],\r\n  [\"macosx\", /\\bmac os x ([0-9._]+)/],\r\n  [\"iOS\", function(ua) {\r\n      if (/\\bcpu(?: iphone)? os /.test(ua)) {\r\n      return /\\bcpu(?: iphone)? os ([0-9._]+)/;\r\n      } else if (ua.indexOf(\"iph os \") !== -1) {\r\n      return /\\biph os ([0-9_]+)/;\r\n      } else {\r\n      return /\\bios\\b/;\r\n      }\r\n  }],\r\n  [\"yunos\", /\\baliyunos ([0-9.]+)/],\r\n  [\"Android\", function(ua) {\r\n      if (ua.indexOf(\"android\") >= 0) {\r\n      return /\\bandroid[ \\/-]?([0-9.x]+)?/;\r\n      } else if (ua.indexOf(\"adr\") >= 0) {\r\n      if (ua.indexOf(\"mqqbrowser\") >= 0) {\r\n          return /\\badr[ ]\\(linux; u; ([0-9.]+)?/;\r\n      } else {\r\n          return /\\badr(?:[ ]([0-9.]+))?/;\r\n      }\r\n      }\r\n      return \"android\";\r\n      //return /\\b(?:android|\\badr)(?:[\\/\\- ](?:\\(linux; u; )?)?([0-9.x]+)?/;\r\n  }],\r\n  [\"chromeos\", /\\bcros i686 ([0-9.]+)/],\r\n  [\"linux\", \"linux\"],\r\n  [\"windowsce\", /\\bwindows ce(?: ([0-9.]+))?/],\r\n  [\"symbian\", /\\bsymbian(?:os)?\\/([0-9.]+)/],\r\n  [\"blackberry\", function(ua) {\r\n      var m = ua.match(re_blackberry_10) ||\r\n      ua.match(re_blackberry_6_7) ||\r\n      ua.match(re_blackberry_4_5);\r\n      return m ? {version: m[1]} : \"blackberry\";\r\n  }]\r\n];\r\n//浏览器内核\r\nvar ENGINE = [\r\n  [\"edgehtml\", /edge\\/([0-9.]+)/],\r\n  [\"trident\", re_msie],\r\n  [\"blink\", function() {\r\n      return \"chrome\" in win && \"CSS\" in win && /\\bapplewebkit[\\/]?([0-9.+]+)/;\r\n  }],\r\n  [\"webkit\", /\\bapplewebkit[\\/]?([0-9.+]+)/],\r\n  [\"gecko\", function(ua) {\r\n      var match;\r\n      if ((match = ua.match(/\\brv:([\\d\\w.]+).*\\bgecko\\/(\\d+)/))) {\r\n      return {\r\n          version: match[1] + \".\" + match[2]\r\n      };\r\n      }\r\n  }],\r\n  [\"presto\", /\\bpresto\\/([0-9.]+)/],\r\n  [\"androidwebkit\", /\\bandroidwebkit\\/([0-9.]+)/],\r\n  [\"coolpadwebkit\", /\\bcoolpadwebkit\\/([0-9.]+)/],\r\n  [\"u2\", /\\bu2\\/([0-9.]+)/],\r\n  [\"u3\", /\\bu3\\/([0-9.]+)/]\r\n];\r\nvar BROWSER = [\r\n  // Microsoft Edge Browser, Default browser in Windows 10.\r\n  [\"edge\", /edge\\/([0-9.]+)/],\r\n  // Sogou.\r\n  [\"sogou\", function(ua) {\r\n      if (ua.indexOf(\"sogoumobilebrowser\") >= 0) {\r\n      return /sogoumobilebrowser\\/([0-9.]+)/;\r\n      } else if (ua.indexOf(\"sogoumse\") >= 0) {\r\n      return true;\r\n      }\r\n      return / se ([0-9.x]+)/;\r\n  }],\r\n  // TheWorld (世界之窗)\r\n  // 由于裙带关系，TheWorld API 与 360 高度重合。\r\n  // 只能通过 UA 和程序安装路径中的应用程序名来区分。\r\n  // TheWorld 的 UA 比 360 更靠谱，所有将 TheWorld 的规则放置到 360 之前。\r\n  [\"theworld\", function() {\r\n      var x = checkTW360External(\"theworld\");\r\n      if (typeof x !== \"undefined\") {\r\n      return x;\r\n      }\r\n      return \"theworld\";\r\n  }],\r\n  // 360SE, 360EE.\r\n  [\"360\", function(ua) {\r\n      var x = checkTW360External(\"360se\");\r\n      if (typeof x !== \"undefined\") {\r\n      return x;\r\n      }\r\n      if (ua.indexOf(\"360 aphone browser\") !== -1) {\r\n      return /\\b360 aphone browser \\(([^\\)]+)\\)/;\r\n      }\r\n      return /\\b360(?:se|ee|chrome|browser)\\b/;\r\n  }],\r\n  // Maxthon\r\n  [\"maxthon\", function() {\r\n      try {\r\n      if (external && (external.mxVersion || external.max_version)) {\r\n          return {\r\n          version: external.mxVersion || external.max_version\r\n          };\r\n      }\r\n      } catch (ex) { /* */\r\n      }\r\n      return /\\b(?:maxthon|mxbrowser)(?:[ \\/]([0-9.]+))?/;\r\n  }],\r\n  [\"micromessenger\", /\\bmicromessenger\\/([\\d.]+)/],\r\n  [\"qq\", /\\bm?qqbrowser\\/([0-9.]+)/],\r\n  [\"green\", \"greenbrowser\"],\r\n  [\"tt\", /\\btencenttraveler ([0-9.]+)/],\r\n  [\"liebao\", function(ua) {\r\n      if (ua.indexOf(\"liebaofast\") >= 0) {\r\n      return /\\bliebaofast\\/([0-9.]+)/;\r\n      }\r\n      if (ua.indexOf(\"lbbrowser\") === -1) {\r\n      return false;\r\n      }\r\n      var version;\r\n      try {\r\n      if (external && external.LiebaoGetVersion) {\r\n          version = external.LiebaoGetVersion();\r\n      }\r\n      } catch (ex) { /* */\r\n      }\r\n      return {\r\n      version: version || NA_VERSION\r\n      };\r\n  }],\r\n  [\"tao\", /\\btaobrowser\\/([0-9.]+)/],\r\n  [\"coolnovo\", /\\bcoolnovo\\/([0-9.]+)/],\r\n  [\"saayaa\", \"saayaa\"],\r\n  // 有基于 Chromniun 的急速模式和基于 IE 的兼容模式。必须在 IE 的规则之前。\r\n  [\"baidu\", /\\b(?:ba?idubrowser|baiduhd)[ \\/]([0-9.x]+)/],\r\n  // 后面会做修复版本号，这里只要能识别是 IE 即可。\r\n  [\"ie\", re_msie],\r\n  [\"mi\", /\\bmiuibrowser\\/([0-9.]+)/],\r\n  // Opera 15 之后开始使用 Chromniun 内核，需要放在 Chrome 的规则之前。\r\n  [\"opera\", function(ua) {\r\n      var re_opera_old = /\\bopera.+version\\/([0-9.ab]+)/;\r\n      var re_opera_new = /\\bopr\\/([0-9.]+)/;\r\n      return re_opera_old.test(ua) ? re_opera_old : re_opera_new;\r\n  }],\r\n  [\"oupeng\", /\\boupeng\\/([0-9.]+)/],\r\n  [\"yandex\", /yabrowser\\/([0-9.]+)/],\r\n  // 支付宝手机客户端\r\n  [\"ali-ap\", function(ua) {\r\n      if (ua.indexOf(\"aliapp\") > 0) {\r\n      return /\\baliapp\\(ap\\/([0-9.]+)\\)/;\r\n      } else {\r\n      return /\\balipayclient\\/([0-9.]+)\\b/;\r\n      }\r\n  }],\r\n  // 支付宝平板客户端\r\n  [\"ali-ap-pd\", /\\baliapp\\(ap-pd\\/([0-9.]+)\\)/],\r\n  // 支付宝商户客户端\r\n  [\"ali-am\", /\\baliapp\\(am\\/([0-9.]+)\\)/],\r\n  // 淘宝手机客户端\r\n  [\"ali-tb\", /\\baliapp\\(tb\\/([0-9.]+)\\)/],\r\n  // 淘宝平板客户端\r\n  [\"ali-tb-pd\", /\\baliapp\\(tb-pd\\/([0-9.]+)\\)/],\r\n  // 天猫手机客户端\r\n  [\"ali-tm\", /\\baliapp\\(tm\\/([0-9.]+)\\)/],\r\n  // 天猫平板客户端\r\n  [\"ali-tm-pd\", /\\baliapp\\(tm-pd\\/([0-9.]+)\\)/],\r\n  // UC 浏览器，可能会被识别为 Android 浏览器，规则需要前置。\r\n  // UC 桌面版浏览器携带 Chrome 信息，需要放在 Chrome 之前。\r\n  [\"uc\", function(ua) {\r\n      if (ua.indexOf(\"ucbrowser/\") >= 0) {\r\n      return /\\bucbrowser\\/([0-9.]+)/;\r\n      } else if (ua.indexOf(\"ubrowser/\") >= 0) {\r\n      return /\\bubrowser\\/([0-9.]+)/;\r\n      } else if (/\\buc\\/[0-9]/.test(ua)) {\r\n      return /\\buc\\/([0-9.]+)/;\r\n      } else if (ua.indexOf(\"ucweb\") >= 0) {\r\n      // `ucweb/2.0` is compony info.\r\n      // `UCWEB8.7.2.214/145/800` is browser info.\r\n      return /\\bucweb([0-9.]+)?/;\r\n      } else {\r\n      return /\\b(?:ucbrowser|uc)\\b/;\r\n      }\r\n  }],\r\n  [\"chrome\", / (?:chrome|crios|crmo)\\/([0-9.]+)/],\r\n  // Android 默认浏览器。该规则需要在 safari 之前。\r\n  [\"android\", function(ua) {\r\n      if (ua.indexOf(\"android\") === -1) {\r\n      return;\r\n      }\r\n      return /\\bversion\\/([0-9.]+(?: beta)?)/;\r\n  }],\r\n  [\"blackberry\", function(ua) {\r\n      var m = ua.match(re_blackberry_10) ||\r\n      ua.match(re_blackberry_6_7) ||\r\n      ua.match(re_blackberry_4_5);\r\n      return m ? {version: m[1]} : \"blackberry\";\r\n  }],\r\n  [\"safari\", /\\bversion\\/([0-9.]+(?: beta)?)(?: mobile(?:\\/[a-z0-9]+)?)? safari\\//],\r\n  // 如果不能被识别为 Safari，则猜测是 WebView。\r\n  [\"webview\", /\\bcpu(?: iphone)? os (?:[0-9._]+).+\\bapplewebkit\\b/],\r\n  [\"firefox\", /\\bfirefox\\/([0-9.ab]+)/],\r\n  [\"nokia\", /\\bnokiabrowser\\/([0-9.]+)/]\r\n];\r\n// 针对同源的 TheWorld 和 360 的 external 对象进行检测。\r\n// @param {String} key, 关键字，用于检测浏览器的安装路径中出现的关键字。\r\n// @return {Undefined,Boolean,Object} 返回 undefined 或 false 表示检测未命中。\r\nfunction checkTW360External(key) {\r\n  if (!external) {\r\n      return;\r\n  } // return undefined.\r\n  try {\r\n      //        360安装路径：\r\n      //        C:%5CPROGRA~1%5C360%5C360se3%5C360SE.exe\r\n      var runpath = external.twGetRunPath.toLowerCase();\r\n      // 360SE 3.x ~ 5.x support.\r\n      // 暴露的 external.twGetVersion 和 external.twGetSecurityID 均为 undefined。\r\n      // 因此只能用 try/catch 而无法使用特性判断。\r\n      var security = external.twGetSecurityID(win);\r\n      var version = external.twGetVersion(security);\r\n\r\n      if (runpath && runpath.indexOf(key) === -1) {\r\n      return false;\r\n      }\r\n      if (version) {\r\n      return {version: version};\r\n      }\r\n  } catch (ex) { /* */\r\n  }\r\n}\r\n// 解析使用 Trident 内核的浏览器的 `浏览器模式` 和 `文档模式` 信息。\r\n// @param {String} ua, userAgent string.\r\n// @return {Object}\r\nfunction IEMode(ua) {\r\n  if (!re_msie.test(ua)) {\r\n      return null;\r\n  }\r\n\r\n  var m,\r\n      engineMode, engineVersion,\r\n      browserMode, browserVersion;\r\n\r\n  // IE8 及其以上提供有 Trident 信息，\r\n  // 默认的兼容模式，UA 中 Trident 版本不发生变化。\r\n  if (ua.indexOf(\"trident/\") !== -1) {\r\n      m = /\\btrident\\/([0-9.]+)/.exec(ua);\r\n      if (m && m.length >= 2) {\r\n      // 真实引擎版本。\r\n      engineVersion = m[1];\r\n      var v_version = m[1].split(\".\");\r\n      v_version[0] = parseInt(v_version[0], 10) + 4;\r\n      browserVersion = v_version.join(\".\");\r\n      }\r\n  }\r\n\r\n  m = re_msie.exec(ua);\r\n  browserMode = m[1];\r\n  var v_mode = m[1].split(\".\");\r\n  if (typeof browserVersion === \"undefined\") {\r\n      browserVersion = browserMode;\r\n  }\r\n  v_mode[0] = parseInt(v_mode[0], 10) - 4;\r\n  engineMode = v_mode.join(\".\");\r\n  if (typeof engineVersion === \"undefined\") {\r\n      engineVersion = engineMode;\r\n  }\r\n\r\n  return {\r\n      browserVersion: browserVersion,\r\n      browserMode: browserMode,\r\n      engineVersion: engineVersion,\r\n      engineMode: engineMode,\r\n      compatible: engineVersion !== engineMode\r\n  };\r\n}\r\n// UserAgent Detector.\r\n// @param {String} ua, userAgent.\r\n// @param {Object} expression\r\n// @return {Object}\r\n//    返回 null 表示当前表达式未匹配成功。\r\nfunction detect(name, expression, ua) {\r\n  var expr = isFunction(expression) ? expression.call(null, ua) : expression;\r\n  if (!expr) {\r\n      return null;\r\n  }\r\n  var info = {\r\n      name: name,\r\n      version: NA_VERSION,\r\n      codename: \"\"\r\n  };\r\n  var t = toString(expr);\r\n  if (expr === true) {\r\n      return info;\r\n  } else if (t === \"[object String]\") {\r\n      if (ua.indexOf(expr) !== -1) {\r\n      return info;\r\n      }\r\n  } else if (isObject(expr)) { // Object\r\n      if (expr.hasOwnProperty(\"version\")) {\r\n      info.version = expr.version;\r\n      }\r\n      return info;\r\n  } else if (expr.exec) { // RegExp\r\n      var m = expr.exec(ua);\r\n      if (m) {\r\n      if (m.length >= 2 && m[1]) {\r\n          info.version = m[1].replace(/_/g, \".\");\r\n      } else {\r\n          info.version = NA_VERSION;\r\n      }\r\n      return info;\r\n      }\r\n  }\r\n}\r\n\r\nvar na = {name: \"\", version: \"\"};\r\n// 初始化识别。\r\nfunction init(ua, patterns, factory, detector) {\r\n  var detected = na;\r\n  each(patterns, function(pattern) {\r\n      var d = detect(pattern[0], pattern[1], ua);\r\n      if (d) {\r\n      detected = d;\r\n      return false;\r\n      }\r\n  });\r\n  factory.call(detector, detected.name, detected.version);\r\n}\r\n// 解析 UserAgent 字符串\r\n// @param {String} ua, userAgent string.\r\n// @return {Object}\r\nvar parse = function(ua) {\r\n  ua = (ua || \"\").toLowerCase();\r\n  var d = {};\r\n\r\n  init(ua, DEVICES, function(name, version) {\r\n      var v = parseFloat(version);\r\n      d.device = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version\r\n      };\r\n      d.device[name] = v;\r\n  }, d);\r\n\r\n  init(ua, OS, function(name, version) {\r\n      var v = parseFloat(version);\r\n      d.os = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version\r\n      };\r\n      d.os[name] = v;\r\n  }, d);\r\n\r\n  var ieCore = IEMode(ua);\r\n\r\n  init(ua, ENGINE, function(name, version) {\r\n      var mode = version;\r\n      // IE 内核的浏览器，修复版本号及兼容模式。\r\n      if (ieCore) {\r\n      version = ieCore.engineVersion || ieCore.engineMode;\r\n      mode = ieCore.engineMode;\r\n      }\r\n      var v = parseFloat(version);\r\n      d.engine = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version,\r\n      mode: parseFloat(mode),\r\n      fullMode: mode,\r\n      compatible: ieCore ? ieCore.compatible : false\r\n      };\r\n      d.engine[name] = v;\r\n  }, d);\r\n\r\n  init(ua, BROWSER, function(name, version) {\r\n      var mode = version;\r\n      // IE 内核的浏览器，修复浏览器版本及兼容模式。\r\n      if (ieCore) {\r\n      // 仅修改 IE 浏览器的版本，其他 IE 内核的版本不修改。\r\n      if (name === \"ie\") {\r\n          version = ieCore.browserVersion;\r\n      }\r\n      mode = ieCore.browserMode;\r\n      }\r\n      var v = parseFloat(version);\r\n      d.browser = {\r\n      name: name,\r\n      version: v,\r\n      fullVersion: version,\r\n      mode: parseFloat(mode),\r\n      fullMode: mode,\r\n      compatible: ieCore ? ieCore.compatible : false\r\n      };\r\n      d.browser[name] = v;\r\n  }, d);\r\n  return d;\r\n};\r\n\r\ndetector = parse(userAgent + \" \" + appVersion + \" \" + vendor);\r\n\r\n\r\nexport default detector;","import {\r\n  CONFIG\r\n} from './config'\r\n\r\n\r\nimport device from './device'\r\n\r\nimport {base64Encode} from './coding'\r\n\r\nimport detector from './useragent'\r\n\r\n// 兼容单元测试环境\r\nlet win;\r\nif (typeof(window) === 'undefined') {\r\n    win = {\r\n      navigator: {\r\n        userAgent: ''\r\n      },\r\n      location: {\r\n        pathname: '',\r\n        href: ''\r\n      },\r\n      document: {\r\n        URL: ''\r\n      },\r\n      screen: {\r\n        width: '',\r\n        height: ''\r\n      }\r\n    };\r\n} else {\r\n  win = window;\r\n}\r\n\r\nconst breaker = {};\r\n\r\nconst _ = {\r\n  each(obj, iterator, context) {\r\n    if (obj === null || obj === undefined) {\r\n      return;\r\n    }\r\n    if (Array.prototype.forEach && obj.forEach === Array.prototype.forEach) {\r\n      obj.forEach(iterator, context);\r\n    } else if (obj.length === +obj.length) {\r\n        for (let i = 0, l = obj.length; i < l; i++) {\r\n            if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\r\n                return;\r\n            }\r\n        }\r\n    } else {\r\n      for (let key in obj) {\r\n        if (obj.hasOwnProperty.call(obj, key)) {\r\n          if (iterator.call(context, obj[key], key, obj) === breaker) {\r\n              return;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  extend(obj) {\r\n    _.each(Array.prototype.slice.call(arguments, 1), function(source) {\r\n      for (let prop in source) {\r\n          if (source[prop] !== void 0) {\r\n              obj[prop] = source[prop];\r\n          }\r\n      }\r\n    });\r\n    return obj;\r\n  },\r\n  isObject(obj) {\r\n    return (obj === Object(obj) && !_.isArray(obj));\r\n  },\r\n  isUndefined(obj) {\r\n    return obj === void 0;\r\n  },\r\n  isArguments(obj) {\r\n    return !!(obj && hasOwnProperty.call(obj, 'callee'));\r\n  },\r\n  toArray(iterable) {\r\n    if (!iterable) {\r\n      return [];\r\n    }\r\n    if (iterable.toArray) {\r\n      return iterable.toArray();\r\n    }\r\n    if (_.isArray(iterable)) {\r\n      return Array.prototype.slice.call(iterable);\r\n    }\r\n    if (_.isArguments(iterable)) {\r\n      return Array.prototype.slice.call(iterable);\r\n    }\r\n    return _.values(iterable);\r\n  },\r\n  values(obj) {\r\n    var results = [];\r\n    if (obj === null) {\r\n        return results;\r\n    }\r\n    _.each(obj, function(value) {\r\n        results[results.length] = value;\r\n    });\r\n    return results;\r\n  },\r\n  // 转化成json\r\n  JSONDecode(string) {\r\n    try {\r\n      return JSON.parse(string);\r\n    } catch (error) {\r\n      return {};\r\n    }\r\n  },\r\n  // json转化为string\r\n  JSONEncode(json) {\r\n    try {\r\n      return JSON.stringify(json);\r\n    } catch (error) {\r\n      return '';\r\n    }\r\n  },\r\n  // 判断类型是否为function\r\n  isFunction(fn) {\r\n    let bool = false;\r\n    if (typeof (fn) === 'function') {\r\n      bool = true;\r\n    }\r\n    return bool;\r\n  },\r\n  base64Encode(str) {\r\n    return base64Encode(str);\r\n  },\r\n  sha1(str) {\r\n    return '';\r\n  },\r\n  // 对象的字段值截取\r\n  truncate(obj, length) {\r\n    let ret;\r\n    if (typeof(obj) === 'string') {\r\n        ret = obj.slice(0, length);\r\n    } else if (_.isArray(obj)) {\r\n        ret = [];\r\n        _.each(obj, function(val) {\r\n            ret.push(_.truncate(val, length));\r\n        });\r\n    } else if (_.isObject(obj)) {\r\n        ret = {};\r\n        _.each(obj, function(val, key) {\r\n            ret[key] = _.truncate(val, length);\r\n        });\r\n    } else {\r\n        ret = obj;\r\n    }\r\n    return ret;\r\n  },\r\n  isNumber(obj) {\r\n    return Object.prototype.toString.call(obj) == '[object Number]';\r\n  },\r\n  isString(str) {\r\n    return Object.prototype.toString.call(str) == '[object String]';\r\n  },\r\n  HTTPBuildQuery(formdata, arg_separator) {\r\n    let use_val, use_key, tmp_arr = [];\r\n\r\n    if (_.isUndefined(arg_separator)) {\r\n        arg_separator = '&';\r\n    }\r\n\r\n    _.each(formdata, function(val, key) {\r\n        use_val = encodeURIComponent(val.toString());\r\n        use_key = encodeURIComponent(key);\r\n        tmp_arr[tmp_arr.length] = use_key + '=' + use_val;\r\n    });\r\n\r\n    return tmp_arr.join(arg_separator);\r\n  },\r\n  // 删除左右两端的空格\r\n  trim(str){\r\n    if (!str) return; \r\n　  return str.replace(/(^\\s*)|(\\s*$)/g, \"\");\r\n  },\r\n  // 验证yyyy-MM-dd日期格式\r\n  checkTime(timeString) {\r\n    const reg = /^(\\d{4})-(\\d{2})-(\\d{2})$/;\r\n    if(timeString) {\r\n      if (!reg.test(timeString)){\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n  },\r\n  // 返回指定url的域名\r\n  // 若不传入url，返回当前网页的域名\r\n  getHost(url) {\r\n    let host = '';\r\n    if (!url) {\r\n      url = document.URL;\r\n    }\r\n    const regex = /.*\\:\\/\\/([^\\/]*).*/;\r\n    const match = url.match(regex);\r\n    if (match) {\r\n      host = match[1];\r\n    }\r\n    return host;\r\n  },\r\n  // 获取url上指定参数的值\r\n  getQueryParam(url, param) {\r\n    const target = param.replace(/[\\[]/, '\\\\\\[').replace(/[\\]]/, '\\\\\\]');\r\n    const regexS = '[\\\\?&]' + target + '=([^&#]*)';\r\n    const regex = new RegExp(regexS);\r\n    const results = regex.exec(url);\r\n    if (results === null || (results && typeof(results[1]) !== 'string' && results[1].length)) {\r\n      return '';\r\n    } else {\r\n      return decodeURIComponent(results[1]).replace(/\\+/g, ' ');\r\n    }\r\n  },\r\n  // 删除对象中空字段\r\n  deleteEmptyProperty(obj) {\r\n    if (!this.isObject(obj)) {\r\n      return;\r\n    }\r\n    for (let key in obj) {\r\n      if (obj.hasOwnProperty(key)) {\r\n        if (obj[key] === null || this.isUndefined(obj[key]) || obj[key] === \"\") {\r\n          delete obj[key];\r\n        }\r\n      }\r\n    }\r\n    return obj;\r\n  }\r\n};\r\n_.isArray = Array.isArray || function(obj) {\r\n  return Object.prototype.toString.apply(obj) === '[object Array]';\r\n};\r\n\r\n_.loadScript = function(para) {\r\n    para = _.extend({\r\n      success: function() {},\r\n      error: function() {},\r\n      appendCall: function(g) {\r\n        document.getElementsByTagName('head')[0].appendChild(g);\r\n      }\r\n    }, para);\r\n  \r\n    var g = null;\r\n    if (para.type === 'css') {\r\n      g = document.createElement('link');\r\n      g.rel = 'stylesheet';\r\n      g.href = para.url;\r\n    }\r\n    if (para.type === 'js') {\r\n      g = document.createElement('script');\r\n      g.async = 'async';\r\n      g.setAttribute('charset','UTF-8');\r\n      g.src = para.url;\r\n      g.type = 'text/javascript';\r\n    }\r\n    g.onload = g.onreadystatechange = function() {\r\n      if (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete') {\r\n        para.success();\r\n        g.onload = g.onreadystatechange = null;\r\n      }\r\n    };\r\n    g.onerror = function() {\r\n      para.error();\r\n      g.onerror = null;\r\n    };\r\n    // if iframe\r\n    para.appendCall(g);  \r\n};\r\n\r\n_.register_event = (function() {\r\n    // written by Dean Edwards, 2005\r\n    // with input from Tino Zijdel - crisp@xs4all.nl\r\n    // with input from Carl Sverre - mail@carlsverre.com\r\n    // with input from DATracker\r\n    // http://dean.edwards.name/weblog/2005/10/add-event/\r\n    // https://gist.github.com/1930440\r\n\r\n    /**\r\n     * @param {Object} element\r\n     * @param {string} type\r\n     * @param {function(...[*])} handler\r\n     * @param {boolean=} oldSchool\r\n     * @param {boolean=} useCapture\r\n     */\r\n    var register_event = function(element, type, handler, oldSchool, useCapture) {\r\n        if (!element) {\r\n            console.error('No valid element provided to register_event');\r\n            return;\r\n        }\r\n\r\n        if (element.addEventListener && !oldSchool) {\r\n            element.addEventListener(type, handler, !!useCapture);\r\n        } else {\r\n            var ontype = 'on' + type;\r\n            var old_handler = element[ontype]; // can be undefined\r\n            element[ontype] = makeHandler(element, handler, old_handler);\r\n        }\r\n    };\r\n\r\n    function makeHandler(element, new_handler, old_handlers) {\r\n        var handler = function(event) {\r\n            event = event || fixEvent(window.event);\r\n\r\n            // this basically happens in firefox whenever another script\r\n            // overwrites the onload callback and doesn't pass the event\r\n            // object to previously defined callbacks.  All the browsers\r\n            // that don't define window.event implement addEventListener\r\n            // so the dom_loaded handler will still be fired as usual.\r\n            if (!event) {\r\n                return undefined;\r\n            }\r\n\r\n            var ret = true;\r\n            var old_result, new_result;\r\n\r\n            if (_.isFunction(old_handlers)) {\r\n                old_result = old_handlers(event);\r\n            }\r\n            new_result = new_handler.call(element, event);\r\n\r\n            if ((false === old_result) || (false === new_result)) {\r\n                ret = false;\r\n            }\r\n\r\n            return ret;\r\n        };\r\n\r\n        return handler;\r\n    }\r\n\r\n    function fixEvent(event) {\r\n        if (event) {\r\n            event.preventDefault = fixEvent.preventDefault;\r\n            event.stopPropagation = fixEvent.stopPropagation;\r\n        }\r\n        return event;\r\n    }\r\n    fixEvent.preventDefault = function() {\r\n        this.returnValue = false;\r\n    };\r\n    fixEvent.stopPropagation = function() {\r\n        this.cancelBubble = true;\r\n    };\r\n\r\n    return register_event;\r\n})();\r\n\r\n_.register_hash_event = function(callback) {\r\n  _.register_event(window,'hashchange',callback);\r\n};\r\n\r\n// 客户端基本属性\r\n_.info = {\r\n  domain(referrer) {\r\n    const split = referrer.split('/');\r\n    if (split.length >= 3) {\r\n        return split[2];\r\n    }\r\n    return '';\r\n  },\r\n  // 设备型号\r\n  deviceModel() {\r\n    let deviceModel = '';\r\n    if(device.android()) {\r\n      const sss = win.navigator.userAgent.split(\";\");  \r\n      const i = sss.indexOf(\"Build/\");  \r\n      if (i > -1) {\r\n        deviceModel = sss[i].substring(0, sss[i].indexOf(\"Build/\"));  \r\n      }\r\n    } else if(device.ios()) {\r\n      if(device.iphone()) {\r\n        deviceModel = 'iPhone';\r\n      }\r\n    }\r\n    return deviceModel;\r\n  },\r\n  properties() {\r\n    const windowsOs = {\r\n     '5.0': 'Win2000',\r\n     '5.1': 'WinXP',\r\n     '5.2': 'Win2003',\r\n     '6.0': 'WindowsVista',\r\n     '6.1': 'Win7',\r\n     '6.2': 'Win8',\r\n     '6.3': 'Win8.1',\r\n     '10.0': 'Win10' \r\n    };\r\n    const devicePlatform = device.type;\r\n    const deviceModel = _.trim(this.deviceModel());\r\n    const isWindows = device.windows();\r\n    let deviceOsVersion = detector.os.name + ' ' +detector.os.fullVersion;\r\n    if(isWindows) {\r\n      if(windowsOs[detector.os.fullVersion]) {\r\n        deviceOsVersion = windowsOs[detector.os.fullVersion];\r\n      }\r\n    }\r\n    return {\r\n      // 设备型号\r\n      deviceModel: deviceModel,\r\n      // 操作系统\r\n      deviceOs: detector.os.name,\r\n      // 操作系统版本\r\n      deviceOsVersion: deviceOsVersion,\r\n      // 设备平台\r\n      devicePlatform: devicePlatform,\r\n      // 浏览器名称\r\n      browser: detector.browser.name,\r\n      // 浏览器版本\r\n      browserVersion: detector.browser.fullVersion,\r\n      // 页面标题\r\n      title: win.document.title || '',\r\n      // 页面路径\r\n      urlPath: win.location.pathname || '',\r\n      // 页面url\r\n      currentUrl: document.URL,\r\n      // 域名\r\n      currentDomain: this.domain(document.URL),\r\n      // referrer 数据来源\r\n      referrer: win.document.referrer,\r\n      // referrer 域名\r\n      referringDomain: this.domain(win.document.referrer),\r\n      // 本地语言\r\n      language: win.navigator.language || '',\r\n      // 客户端分辨率 width\r\n      screenWidth: win.screen.width,\r\n      // 客户端分辨率 height\r\n      screenHeight: win.screen.height\r\n    };\r\n  }\r\n};\r\n\r\n// 消息订阅/推送\r\n_.innerEvent = {\r\n  /**\r\n   * 订阅\r\n   *  */ \r\n  on: function(key, fn) {\r\n      if(!this._list) {\r\n          this._list = {};\r\n      }\r\n      if (!this._list[key]) {\r\n          this._list[key] = [];\r\n      }\r\n      this._list[key].push(fn);\r\n  },\r\n  off: function(key) {\r\n      if(!this._list) {\r\n          this._list = {};\r\n      }\r\n      if (!this._list[key]) {\r\n          return;\r\n      }else{\r\n          delete this._list[key];\r\n      }\r\n  },\r\n  /**\r\n   * 推送\r\n   */\r\n  trigger: function() {\r\n      var args = Array.prototype.slice.call(arguments);\r\n      var key = args[0];\r\n      var arrFn = this._list && this._list[key];\r\n      if (!arrFn || arrFn.length === 0) {\r\n          return;\r\n      }\r\n      for (var i = 0; i < arrFn.length; i++) {\r\n          if( typeof arrFn[i] == 'function') {\r\n              arrFn[i].apply(this, args);\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n// 发送数据\r\n_.sendRequest = function(url, type, data, callback) {\r\n  data['_'] = new Date().getTime().toString();\r\n  if (type === 'img') {\r\n    url += '?' + _.HTTPBuildQuery(data);\r\n    let img = document.createElement('img');\r\n    img.src = url;\r\n    img.width = 1;\r\n    img.height = 1;\r\n    if (_.isFunction(callback)) {\r\n        callback(0);\r\n    }\r\n    img.onload = function() {\r\n      this.onload = null;\r\n    };\r\n    img.onerror = function() {\r\n      this.onerror = null;\r\n    };\r\n    img.onabort = function() {\r\n      this.onabort = null;\r\n    };\r\n  } else if (type === 'get') {\r\n    url += '?' + _.HTTPBuildQuery(data);\r\n    _.ajax.get(url, callback);\r\n  } else if (type === 'post') {\r\n    _.ajax.get(url, data , callback); \r\n  }\r\n};\r\n\r\n_.ajax = {\r\n    post: function(url, options, callback, timeout) {\r\n      var that = this;  \r\n      that.callback = callback || function(params) {};  \r\n      try {\r\n          var req = new XMLHttpRequest();\r\n          req.open('POST', url, true);\r\n          req.setRequestHeader(\"Content-type\",\"application/json\");\r\n          req.withCredentials = true;\r\n          req.ontimeout = function() {\r\n              that.callback({status: 0, error: true, message: 'request ' +url + ' time out'});\r\n          };\r\n          req.onreadystatechange = function () {\r\n              if (req.readyState === 4) {\r\n                  if (req.status === 200) {\r\n                      that.callback(_.JSONDecode(req.responseText));\r\n                  } else {\r\n                      var message = 'Bad HTTP status: ' + req.status + ' ' + req.statusText;\r\n                      that.callback({status: 0, error: true, message: message});\r\n                  }\r\n              }\r\n          };\r\n          req.timeout = timeout || 5000;\r\n          req.send(_.JSONEncode(options));\r\n      } catch (e) {}\r\n    },\r\n    get: function(url, callback) {\r\n      try {\r\n          var req = new XMLHttpRequest();\r\n          req.open('GET', url, true);\r\n          req.withCredentials = true;\r\n          req.onreadystatechange = function () {\r\n              if (req.readyState === 4) {\r\n                  if (req.status === 200) {\r\n                      if (callback) {\r\n                          callback(req.responseText);\r\n                      }\r\n                  } else {\r\n                      if (callback) {\r\n                          var message = 'Bad HTTP status: ' + req.status + ' ' + req.statusText;\r\n                          callback({status: 0, error: true, message: message});\r\n                      }\r\n                  }\r\n              }\r\n          };\r\n          req.send(null);\r\n      } catch (e) {}\r\n    }\r\n};\r\n\r\n// uuid\r\n_.UUID = (function() {\r\n    var T = function() {\r\n      var d = 1 * new Date(), i = 0;\r\n      while (d == 1 * new Date()) {\r\n        i++;\r\n      }\r\n      return d.toString(16) + i.toString(16);\r\n    };\r\n    var R = function() {\r\n      return Math.random().toString(16).replace('.', '');\r\n    };\r\n    var UA = function(n) {\r\n      var ua = navigator.userAgent, i, ch, buffer = [], ret = 0;\r\n  \r\n      function xor(result, byte_array) {\r\n        var j, tmp = 0;\r\n        for (j = 0; j < byte_array.length; j++) {\r\n          tmp |= (buffer[j] << j * 8);\r\n        }\r\n        return result ^ tmp;\r\n      }\r\n  \r\n      for (i = 0; i < ua.length; i++) {\r\n        ch = ua.charCodeAt(i);\r\n        buffer.unshift(ch & 0xFF);\r\n        if (buffer.length >= 4) {\r\n          ret = xor(ret, buffer);\r\n          buffer = [];\r\n        }\r\n      }\r\n  \r\n      if (buffer.length > 0) {\r\n        ret = xor(ret, buffer);\r\n      }\r\n  \r\n      return ret.toString(16);\r\n    };\r\n  \r\n    return function() {\r\n      // 有些浏览器取个屏幕宽度都异常...\r\n      var se = String(screen.height * screen.width);\r\n      if (se && /\\d{5,}/.test(se)) {\r\n        se = se.toString(16);\r\n      } else {\r\n        se = String(Math.random() * 31242).replace('.', '').slice(0, 8);\r\n      }\r\n      var val = (T() + '-' + R() + '-' + UA() + '-' + se + '-' + T());\r\n      if(val){\r\n        return val; \r\n      }else{\r\n        return (String(Math.random()) + String(Math.random()) + String(Math.random())).slice(2, 15);\r\n      }\r\n  \r\n    };\r\n})();\r\n\r\n// 存储方法封装 localStorage  cookie\r\n_.localStorage = {\r\n  error: function(msg) {\r\n      console.error('localStorage error: ' + msg);\r\n  },\r\n\r\n  get: function(name) {\r\n      try {\r\n          return window.localStorage.getItem(name);\r\n      } catch (err) {\r\n          _.localStorage.error(err);\r\n      }\r\n      return null;\r\n  },\r\n\r\n  parse: function(name) {\r\n      try {\r\n          return _.JSONDecode(_.localStorage.get(name)) || {};\r\n      } catch (err) {\r\n          // noop\r\n      }\r\n      return null;\r\n  },\r\n\r\n  set: function(name, value) {\r\n      try {\r\n          window.localStorage.setItem(name, value);\r\n      } catch (err) {\r\n          _.localStorage.error(err);\r\n      }\r\n  },\r\n\r\n  remove: function(name) {\r\n      try {\r\n          window.localStorage.removeItem(name);\r\n      } catch (err) {\r\n          _.localStorage.error(err);\r\n      }\r\n  }\r\n};\r\n_.cookie = {\r\n  get: function(name) {\r\n      var nameEQ = name + '=';\r\n      var ca = document.cookie.split(';');\r\n      for (var i = 0; i < ca.length; i++) {\r\n          var c = ca[i];\r\n          while (c.charAt(0) == ' ') {\r\n              c = c.substring(1, c.length);\r\n          }\r\n          if (c.indexOf(nameEQ) === 0) {\r\n              return decodeURIComponent(c.substring(nameEQ.length, c.length));\r\n          }\r\n      }\r\n      return null;\r\n  },\r\n\r\n  parse: function(name) {\r\n      var cookie;\r\n      try {\r\n          cookie = _.JSONDecode(_.cookie.get(name)) || {};\r\n      } catch (err) {\r\n          // noop\r\n      }\r\n      return cookie;\r\n  },\r\n\r\n  set_seconds: function(name, value, seconds, cross_subdomain, is_secure) {\r\n      var cdomain = '',\r\n          expires = '',\r\n          secure = '';\r\n\r\n      if (cross_subdomain) {\r\n          var matches = document.location.hostname.match(/[a-z0-9][a-z0-9\\-]+\\.[a-z\\.]{2,6}$/i),\r\n              domain = matches ? matches[0] : '';\r\n\r\n          cdomain = ((domain) ? '; domain=.' + domain : '');\r\n      }\r\n\r\n      if (seconds) {\r\n          var date = new Date();\r\n          date.setTime(date.getTime() + (seconds * 1000));\r\n          expires = '; expires=' + date.toGMTString();\r\n      }\r\n\r\n      if (is_secure) {\r\n          secure = '; secure';\r\n      }\r\n\r\n      document.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/' + cdomain + secure;\r\n  },\r\n\r\n  set: function(name, value, days, cross_subdomain, is_secure) {\r\n      var cdomain = '', expires = '', secure = '';\r\n\r\n      if (cross_subdomain) {\r\n          var matches = document.location.hostname.match(/[a-z0-9][a-z0-9\\-]+\\.[a-z\\.]{2,6}$/i),\r\n              domain = matches ? matches[0] : '';\r\n\r\n          cdomain   = ((domain) ? '; domain=.' + domain : '');\r\n      }\r\n\r\n      if (days) {\r\n          var date = new Date();\r\n          date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n          expires = '; expires=' + date.toGMTString();\r\n      }\r\n\r\n      if (is_secure) {\r\n          secure = '; secure';\r\n      }\r\n\r\n      var new_cookie_val = name + '=' + encodeURIComponent(value) + expires + '; path=/' + cdomain + secure;\r\n      document.cookie = new_cookie_val;\r\n      return new_cookie_val;\r\n  },\r\n\r\n  remove: function(name, cross_subdomain) {\r\n      _.cookie.set(name, '', -1, cross_subdomain);\r\n  }\r\n};\r\n\r\nconst windowConsole = win.console;\r\nconst console = {\r\n  /** @type {function(...[*])} */\r\n  log: function() {\r\n      if (CONFIG.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\r\n          try {\r\n              windowConsole.log.apply(windowConsole, arguments);\r\n          } catch (err) {\r\n              _.each(arguments, function(arg) {\r\n                  windowConsole.log(arg);\r\n              });\r\n          }\r\n      }\r\n  },\r\n  /** @type {function(...[*])} */\r\n  error: function() {\r\n      if (CONFIG.DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\r\n          var args = ['DATracker error:'].concat(_.toArray(arguments));\r\n          try {\r\n              windowConsole.error.apply(windowConsole, args);\r\n          } catch (err) {\r\n              _.each(args, function(arg) {\r\n                  windowConsole.error(arg);\r\n              });\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\nexport {_, console};","import {\r\n  PEOPLE_RESERVED_PROPERTY,\r\n  SYSTEM_EVENT_TYPE,\r\n  PEOPLE_PROPERTY_ID\r\n} from './config'\r\n\r\nimport {_, console} from './utils'\r\n\r\nclass USER_TRACK {\r\n  constructor(instance) {\r\n    this.instance = instance;\r\n    this['local_storage'] = this.instance['local_storage'];\r\n  }\r\n  /**\r\n   * 检测设置的属性是否为系统保留属性\r\n   * @param {String} prop \r\n   */\r\n  _is_reserved_property(prop) {\r\n    return PEOPLE_RESERVED_PROPERTY.indexOf('prop') > -1;\r\n  }\r\n  /**\r\n   * 上报用户属性数据\r\n   * @param {Object} properties \r\n   * @param {Function} callback \r\n   */\r\n  _send_request(properties, callback) {\r\n    if (!_.isFunction(callback)) {\r\n      callback = function() {};\r\n    }\r\n\r\n    properties = properties || {};\r\n    \r\n    let data = {\r\n      dataType: SYSTEM_EVENT_TYPE,\r\n      // 客户端唯一凭证(设备凭证)\r\n      deviceId: this.instance.get_device_id(),\r\n      userId: this.instance.get_property('user_id'),\r\n      // 上报时间\r\n      time: new Date().getTime(),\r\n      // sdk类型 （js，小程序、安卓、IOS、server、pc）\r\n      sdkType: 'js',\r\n      // 属性事件id\r\n      eventId: PEOPLE_PROPERTY_ID,\r\n      // 用户首次访问时间\r\n      persistedTime: this.instance.get_property('persistedTime'),\r\n      // 页面打开场景, 默认 Browser\r\n      pageOpenScene: 'Browser',\r\n      // 自定义用户属性\r\n      attributes: properties\r\n    };\r\n\r\n    // 合并渠道推广信息\r\n    data = _.extend({}, data, this.instance['channel'].get_channel_params());\r\n\r\n    // 上报数据对象字段截取\r\n    const truncateLength = this.instance._get_config('truncateLength');\r\n    let truncated_data = data;\r\n    if (_.isNumber(truncateLength) && truncateLength > 0) {\r\n      truncated_data = _.truncate(data, truncateLength);\r\n    }\r\n\r\n    console.log('上报的数据（截取后）:', truncated_data); \r\n\r\n    const callback_fn = (response) => {\r\n      callback(response, data);\r\n    };\r\n    let url = this.instance._get_config('track_url');\r\n    \r\n    // 数据上报方式\r\n    const track_type = this.instance._get_config('track_type');\r\n    if (track_type === 'img') {\r\n      url += 'track.gif';\r\n    }\r\n    _.sendRequest(\r\n      url, \r\n      track_type, \r\n      { data: _.base64Encode(_.JSONEncode(truncated_data)), token: this.instance._get_config('token') }, \r\n      callback_fn\r\n    );\r\n  }\r\n  /**\r\n   * 设置用户属性\r\n   * @param {*} prop \r\n   * @param {*} to \r\n   * @param {*} callback \r\n   */\r\n  set(prop, to, callback) {\r\n    let set_props = {};\r\n    if (_.isObject(prop)) {\r\n      _.each(prop, (v ,k) => {\r\n        // 不是系统保留属性\r\n        if (!this._is_reserved_property(k)) {\r\n          set_props[k] = v;\r\n        }\r\n      });\r\n      callback = to;\r\n    } else {\r\n      set_props[prop] = to;\r\n    }\r\n    return this._send_request(set_props, callback);\r\n  }\r\n}\r\n\r\nexport default USER_TRACK;","import {\r\n  CONFIG,\r\n  DEFAULT_CONFIG,\r\n  SYSTEM_EVENT_TYPE,\r\n  BUSSINESS_EVENT_TYPE,\r\n  SYSTEM_EVENT_OBJECT\r\n} from './config'\r\n\r\nimport {_, console} from './utils'\r\n\r\nclass EVENT_TRACK {\r\n  constructor(instance) {\r\n    this.instance = instance;\r\n    this['local_storage'] = this.instance['local_storage'];\r\n    // 初始化时间(事件相关)\r\n    this['local_storage'].register_once({\r\n      updatedTime: 0,\r\n      sessionStartTime: 0\r\n    });\r\n    // 将当前的referrer保存到本地缓存\r\n    this['local_storage'].register({\r\n      sessionReferrer: document.referrer\r\n    });\r\n    \r\n    let mark_page_url = document.URL;\r\n    // 单页面触发PV事件时，设置 referrer\r\n    _.innerEvent.on('singlePage:change', (eventName, urlParams) => {\r\n      this['local_storage'].register({\r\n        sessionReferrer: mark_page_url\r\n      });\r\n      mark_page_url = document.URL;\r\n    });\r\n  }\r\n  /**\r\n   *\r\n   * 判断是否为其它渠道\r\n   */\r\n  _check_channel() {\r\n    const referrer = this.instance.get_property('sessionReferrer');\r\n    let is_other_channel = false;\r\n    // 若本地缓存的referrer 的host跟当前页不一样，那么可以确定是其它渠道进来的\r\n    if (_.getHost(referrer) !== window.location.host) {\r\n      is_other_channel = true;\r\n    }\r\n    return is_other_channel;\r\n  }\r\n  /**\r\n   * TODO\r\n   * 判断指定事件是否被禁止上报\r\n   * @param {String} event_name\r\n   * @returns {Boolean} \r\n   */\r\n  _event_is_disabled(event_name) {\r\n    return false;\r\n  }\r\n  /**\r\n   * 打开新会话\r\n   */\r\n  _start_new_session() {\r\n    this['local_storage'].register({\r\n      sessionUuid: _.UUID(),\r\n      sessionStartTime: new Date().getTime()\r\n    });\r\n    this.track('smart_session_start');\r\n  }\r\n  /**\r\n   * TODO\r\n   * 关闭当前会话\r\n   */\r\n  _close_cur_session() {\r\n    /*\r\n     为了便于绘制用户事件发生轨迹图，区分会话close和最后一次事件触发时间的顺序，会话关闭时间需要做些微调\r\n     1. 如果本地拿到了上次（非会话事件）事件的触发时间，time = this.instance.get_property('LASTEVENT').time + 1;\r\n     2. 如果未拿到，time = new Date().getTime() - 1;\r\n    */\r\n    let time = new Date().getTime() - 1;\r\n    const sessionStartTime = this.instance.get_property('sessionStartTime');\r\n    const LASTEVENT = this.instance.get_property('LASTEVENT');\r\n    if (LASTEVENT && LASTEVENT.time) {\r\n      time = LASTEVENT.time + 1;\r\n    }\r\n    const sessionTotalLength = time - sessionStartTime;\r\n    if (sessionTotalLength >= 0) {\r\n      this.track('smart_session_close', {\r\n      sessionCloseTime: time,\r\n      sessionTotalLength: sessionTotalLength\r\n    });\r\n   }\r\n  }\r\n  /**\r\n   * 判断会话重新开启\r\n   * 判断条件：会话首次开始、指定的一段时间内用户无事件操作、其它渠道进来\r\n  */\r\n  _session(callback) {\r\n    const session_start_time = 1 * this.instance.get_property('sessionStartTime') / 1000;\r\n    const updated_time = 1 * this.instance.get_property('updatedTime') / 1000;\r\n    const now_date_time_ms = new Date().getTime();\r\n    const now_date_time_se = 1 * now_date_time_ms / 1000;\r\n    // 其它渠道判断\r\n    const other_channel_Bool = this._check_channel();\r\n    //会话结束判断\r\n    if (\r\n      session_start_time === 0 ||\r\n      now_date_time_se > updated_time + 60 * this.instance._get_config('session_interval_mins') ||\r\n      other_channel_Bool\r\n    ) {\r\n      // 当会话首次开始时，不用发送会话关闭事件\r\n      if (session_start_time === 0) {\r\n        // 新打开一个会话\r\n        this._start_new_session();\r\n      } else {\r\n        this._close_cur_session();\r\n        this._start_new_session();\r\n      }\r\n    }\r\n    // 更新本地的最后事件操作时间\r\n    this['local_storage'].register({\r\n      updatedTime: now_date_time_ms\r\n    });\r\n    // 执行回调方法\r\n    if (_.isFunction(callback)) {\r\n      callback();\r\n    }\r\n  }\r\n  /**\r\n   * 用户注册\r\n   * @param {String} user_id \r\n   */\r\n  _signup(user_id) {\r\n    // 默认是空值,若有值则调用退出\r\n    const anonymous_id = this.instance.get_property('userId');\r\n    if (anonymous_id !== user_id) {\r\n      if (anonymous_id) {\r\n        this.logout();\r\n      }\r\n      this.track('smart_u_signup', {\r\n        anonymousId: anonymous_id,\r\n        newUserId: user_id\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * 设置一个指定事件的耗时监听器\r\n   * @param {String} event_name\r\n   */\r\n  time_event(event_name) {\r\n    if (_.isUndefined(event_name)) {\r\n      console.error('事件耗时监听器需要一个事件名称');\r\n      return;\r\n    }\r\n    // 被禁止的事件，无需监听\r\n    if (this._event_is_disabled(event_name)) {\r\n      return;\r\n    }\r\n    this['local_storage'].set_event_timer(event_name, new Date().getTime());\r\n  }\r\n  /**\r\n   * 发送PV事件，在此之前检测session\r\n   * @param {Object} properties  pv属性\r\n   * @param {*} callback \r\n   */\r\n  track_pv(properties, callback) {\r\n    this._session(() => {\r\n      this.track('smart_pv', _.extend({}, properties), callback);\r\n    });\r\n  }\r\n  /**\r\n   * 追踪事件（上报用户事件触发数据）\r\n   * @param {String} event_name 事件名称（必须）\r\n   * @param {Object} properties 事件属性\r\n   * @param {Function} callback 上报后的回调方法\r\n   * @param {String} event_type 自定义事件类型\r\n   * @returns {Object} track_data 上报的数据\r\n   */\r\n  track(event_name, properties, callback, event_type) {\r\n    if (_.isUndefined(event_name)) {\r\n      console.error('上报数据需要一个事件名称');\r\n      return;\r\n    }\r\n    if (!_.isFunction(callback)) {\r\n      callback = function() {};\r\n    }\r\n    if (this._event_is_disabled(event_name)) {\r\n      callback(0);\r\n      return;\r\n    }\r\n    // 重新在本地取数据读取到缓存\r\n    this['local_storage'].load();\r\n    // 事件属性\r\n    properties = properties || {};\r\n    // 标记：传入的属性另存一份\r\n    let user_set_properties = _.JSONDecode(_.JSONEncode(properties)) || {};\r\n    let costTime;\r\n    // 移除该事件的耗时监听器，获取设置监听器的时间戳，计算耗时\r\n    const start_listen_timestamp = this['local_storage'].remove_event_timer(event_name);\r\n    if (!_.isUndefined(start_listen_timestamp)) {\r\n      costTime = new Date().getTime() - start_listen_timestamp;\r\n    }\r\n    // 事件类型设置\r\n    let data_type = BUSSINESS_EVENT_TYPE;\r\n    // 事件类型设置为传入了自定义事件类型\r\n    if (event_type) {\r\n      data_type = event_type;\r\n    } else\r\n    // 如果是内置事件,事件类型重新设置\r\n    if (SYSTEM_EVENT_OBJECT[event_name]) {\r\n      data_type = SYSTEM_EVENT_OBJECT[event_name].data_type;\r\n    }\r\n\r\n    // 事件触发时间\r\n    let time = new Date().getTime();\r\n    // 会话有时间差\r\n    // 触发的事件若是会话结束，触发时间要重新设置\r\n    // 若事件id为会话关闭，需要删除传入的自定义属性\r\n    if (event_name === 'smart_session_close') {\r\n      time = properties.sessionCloseTime;\r\n      delete user_set_properties['sessionCloseTime'];\r\n      delete user_set_properties['sessionTotalLength'];\r\n    }\r\n\r\n\r\n\r\n    // 设置通用的事件属性\r\n    user_set_properties = _.extend({}, this.instance.get_property('superProperties'), user_set_properties);\r\n    \r\n    // 上报数据\r\n    let data = {\r\n      dataType: data_type,\r\n      userId: this.instance.get_property('userId'),\r\n      // sdk类型 （js，小程序、安卓、IOS、server、pc）\r\n      sdkType: 'js',\r\n      sdkVersion: CONFIG.LIB_VERSION,\r\n      // 事件名称\r\n      eventId: event_name,\r\n      // 事件触发时间\r\n      time: time,\r\n      // 用户首次访问时间\r\n      persistedTime: this.instance.get_property('persistedTime'),\r\n      // 客户端唯一凭证(设备凭证)\r\n      deviceId: this.instance.get_device_id(),\r\n      // 页面打开场景, 默认 Browser\r\n      pageOpenScene: 'Browser',\r\n      // 应用凭证\r\n      token: this.instance._get_config('token'),\r\n      costTime: costTime,\r\n      // 当前关闭的会话时长\r\n      sessionTotalLength: properties.sessionTotalLength,\r\n      // 当前会话id\r\n      sessionUuid: this.instance.get_property('sessionUuid'),\r\n      // 事件自定义属性\r\n      attributes: user_set_properties\r\n    };\r\n    // 合并客户端信息  \r\n    data = _.extend({}, data, _.info.properties());\r\n\r\n    // 合并渠道推广信息\r\n    data = _.extend({}, data, this.instance['channel'].get_channel_params());\r\n\r\n    //只有已访问页面后，sessionReferrer 重置\r\n    //如果不是内置事件，那么 sessionReferrer 重置\r\n    //如果是'da_activate'，那么 sessionReferrer 重置\r\n    //解决referrer 当是外链时，此时触发自定义事件，引起重启一个session问题。\r\n    if(data_type === BUSSINESS_EVENT_TYPE) {\r\n      // 其它渠道\r\n      if(this._check_channel()) {\r\n        this['local_storage'].register({\r\n            sessionReferrer: document.URL\r\n        });\r\n      }\r\n    }\r\n    if(!this.instance._get_config('SPA').is) {\r\n      if( ['smart_activate','smart_session_close'].indexOf(event_name) > 0 ) {\r\n        this['local_storage'].register({\r\n            sessionReferrer: document.URL\r\n        });\r\n      }\r\n    }\r\n\r\n    // 当启动单页面后，切换页面，refer为空，此时做处理\r\n    if (this.instance._get_config('SPA').is) {\r\n      const sessionReferrer = this.instance.get_property('sessionReferrer');\r\n      if (sessionReferrer !== data['referrer']) {\r\n        data['referrer'] = sessionReferrer;\r\n        data['referringDomain'] = _.info.domain(sessionReferrer);\r\n      }\r\n    }\r\n\r\n    // 上报数据对象字段截取\r\n    const truncateLength = this.instance._get_config('truncateLength');\r\n    let truncated_data = data;\r\n    if (_.isNumber(truncateLength) && truncateLength > 0) {\r\n      truncated_data = _.truncate(data, truncateLength);\r\n    }\r\n    \r\n    console.log('上报的数据（截取后）:', truncated_data);\r\n\r\n    const callback_fn = (response) => {\r\n      callback(response, data);\r\n    };\r\n    let url = this.instance._get_config('track_url');\r\n    const track_type = this.instance._get_config('track_type');\r\n    if (track_type === 'img') {\r\n      url += 'track.gif';\r\n    }\r\n    _.sendRequest(\r\n      url, \r\n      track_type, \r\n      { data: _.base64Encode(_.JSONEncode(truncated_data)), token: this.instance._get_config('token') }, \r\n      callback_fn\r\n    );\r\n\r\n    // 当触发的事件不是这些事件(smart_session_start,smart_session_close,smart_activate)时，触发检测 session 方法\r\n    if(['smart_session_start', 'smart_session_close', 'smart_activate'].indexOf(event_name) === -1) {\r\n      this._session();\r\n    }\r\n\r\n    // 保存最后一次用户触发事件（除了会话事件以外）的事件id以及时间，通过这个时间确定会话关闭时的时间\r\n    if (['smart_session_start', 'smart_session_close'].indexOf(event_name) === -1) {\r\n      this['local_storage'].register({\r\n        LASTEVENT: {\r\n          eventId: event_name,\r\n          time: time\r\n        }\r\n      });\r\n    }    \r\n  }\r\n  /**\r\n   * 用户登录和注册时调用\r\n   * @param {String} user_id \r\n   */\r\n  login(user_id) {\r\n    this._signup(user_id);\r\n    this['local_storage'].register({'userId': user_id});\r\n    this.track('smart_u_login');\r\n  }\r\n  // 清除本地用户信息，退出用户（选则调用）\r\n  logout() {\r\n    this['local_storage'].unregister('userId');\r\n    this.track('smart_u_logout');\r\n  }\r\n}\r\n\r\nexport default EVENT_TRACK;\r\n","import {_, console} from './utils';\r\n\r\n\r\nclass LOCAL_STORAGE {\r\n  /**\r\n   * \r\n   * @param {Object} config\r\n   */\r\n  constructor(config) {\r\n    const local_storage = config['local_storage'];\r\n    if (_.isObject(local_storage)) {\r\n      this['name'] = local_storage['name'] || ('smart_' + config['token'] + '_sdk');\r\n      let storage_type = local_storage['type'] || 'cookie';\r\n\r\n      // 判断是否支持 localStorage\r\n      const localStorage_supported = () => {\r\n        let supported = true;\r\n        try {\r\n          let key = '__smartssupport__',\r\n          val = 'smart_web_data_sdk';\r\n          _.localStorage.set(key, val);\r\n          if (_.localStorage.get(key) !== val) {\r\n              supported = false;\r\n          }\r\n          _.localStorage.remove(key);\r\n        } catch (error) {\r\n          supported = false;\r\n        }\r\n        if (!supported) {\r\n          console.error('localStorage 不支持，自动退回到cookie存储方式');\r\n        }\r\n        return supported;\r\n      };\r\n\r\n      if (storage_type === 'localStorage' && localStorage_supported()) {\r\n        this['storage'] = _.localStorage;\r\n      } else {\r\n        this['storage'] = _.cookie;\r\n      }\r\n      \r\n      this.load();\r\n      this.update_config(local_storage);\r\n      // TODO: upgrade\r\n      this.upgrade();\r\n      this.save();\r\n    } else {\r\n      console.error('local_storage配置设置错误');\r\n    }\r\n  }\r\n  // 加载本地存储信息\r\n  load() {\r\n    const localData = this['storage'].parse(this['name']);\r\n    if (localData) {\r\n      this['props'] = _.extend({}, localData);\r\n    }\r\n  }\r\n  // 更新配置信息\r\n  update_config(localStorageConfig) {\r\n    // 到期时间(cookie存储设置有效)\r\n    this.default_expiry = this.expire_days = localStorageConfig['cookie_expiration'];\r\n    this.set_disabled(localStorageConfig['disable']);\r\n    this.set_cross_subdomain(localStorageConfig['cross_subdomain_cookie']);\r\n    this.set_secure(localStorageConfig['secure_cookie']);\r\n  }\r\n  // 设置关闭本地保存操作，设置为关闭后，本地数据移除\r\n  set_disabled(disabled) {\r\n    this.disabled = disabled;\r\n    if (this.disabled) {\r\n      this.remove();\r\n    }\r\n  }\r\n  // 移除本地数据\r\n  remove() {\r\n    // cookie存储时，移除二级域以及子域下的cookie,此时参数有两个\r\n    this.storage.remove(this.name, false);\r\n    this.storage.remove(this.name, true);\r\n  }\r\n  // 清除存储的数据\r\n  clear() {\r\n    this.remove();\r\n    this['props'] = {};\r\n  }\r\n  /**\r\n   * 跨子域设置,cookie存储方式下有效\r\n   * @param {Boolean} cross_subdomain \r\n   */\r\n  set_cross_subdomain(cross_subdomain) {\r\n    if (cross_subdomain !== this.cross_subdomain) {\r\n      this.cross_subdomain = cross_subdomain;\r\n      this.remove();\r\n      this.save();\r\n    }\r\n  }\r\n  /**\r\n   * cookie存储方式下有效\r\n   * cookie存储时，采用安全的方式存储数据，调用该方法后，重新保存数据\r\n   * 当secure属性设置为true时，cookie只有在https协议下才能上传到服务器，\r\n   * 而在http协议下是没法上传的，所以也不会被窃听\r\n   * @param {Boolean} secure \r\n   */\r\n  set_secure(secure) {\r\n    if (secure !== this.secure) {\r\n      this.secure = secure ? true : false;\r\n      this.remove();\r\n      this.save();\r\n    }\r\n  }\r\n  // sdk升级，旧的sdk存储数据移到新的sdk存储数据中，然后删除旧的存储数据（暂不实现）\r\n  // 存储方式改变，改为cookie切换到 localStorage\r\n  upgrade(config) {\r\n    let old_cookie;\r\n    if (this.storage === _.localStorage) {\r\n      old_cookie = _.cookie.parse(this.name);\r\n      _.cookie.remove(this.name);\r\n      _.cookie.remove(this.name, true);\r\n\r\n      if (old_cookie) {\r\n        this.register_once(old_cookie);\r\n      }\r\n    }\r\n  }\r\n  // 数据保存到本地\r\n  save() {\r\n    // disabled配置为true, 数据不保存到本地\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n    this.storage.set(\r\n      this['name'],\r\n      _.JSONEncode(this['props']),\r\n      this.expire_days,\r\n      this.cross_subdomain,\r\n      this.secure\r\n    );\r\n  }\r\n  /**\r\n   * 缓存指定的数据，同时将该数据保存到本地\r\n   * @param {Object} props \r\n   * @param {Number} days\r\n   * @returns {Boolean} 返回true表示成功\r\n   */\r\n  register(props, days) {\r\n    if (_.isObject(props)) {\r\n      this.expire_days = ( typeof days === 'undefined' ) ? this.default_expiry : days;\r\n      _.extend(this['props'], props);\r\n      this.save();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * 只缓存一次指定的数据，下次设置该数据时不会覆盖前一次数据\r\n   * 若想更新已设置的属性值，那么default_value参数值要等于本地缓存数据中需重置的属性的值(默认值)\r\n   * this['props'][prop] === default_value   prop为需更新的属性\r\n   * @param {Object} props\r\n   * @param {*} default_value\r\n   * @param {Number} days\r\n   * @returns {Boolean} 返回true表示成功\r\n   */\r\n  register_once(props, default_value, days) {\r\n    if (_.isObject(props)) {\r\n      if (typeof default_value === 'undefined') {\r\n        default_value = 'None';\r\n      }\r\n      this.expire_days = ( typeof days === 'undefined' ) ? this.default_expiry : days;\r\n\r\n      _.each(props, function(val, prop) {\r\n        if (!this['props'][prop] || this['props'][prop] === default_value) {\r\n          this['props'][prop] = val;\r\n        }\r\n      }, this);\r\n\r\n      this.save();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * 移除指定的缓存数据，同时也清除本地的对应数据\r\n   * @param {string} prop\r\n   */\r\n  unregister(prop) {\r\n    if (prop in this['props']) {\r\n      delete this['props'][prop];\r\n      this.save();\r\n    }\r\n  }\r\n  /**\r\n   * 设置一个事件计时器，记录用户触发指定事件需要的时间，同时保存到本地\r\n   * @param {String} event_name 该计时器的名称\r\n   * @param {Date} timestamp 该计时器开始时间戳\r\n   */\r\n  set_event_timer(event_name, timestamp) {\r\n    const timers = this['props']['costTime'] || {};\r\n    timers[event_name] = timestamp;\r\n    this['props']['costTime'] = timers;\r\n    this.save();\r\n  }\r\n  /**\r\n   * 移除指定计时器，同时将本地存储的该计时器信息清除\r\n   * @param {String} event_name\r\n   * @returns {Date} 返回移除该计时器的时间戳\r\n   */\r\n  remove_event_timer(event_name) {\r\n    const timers = this['props']['costTime'] || {};\r\n    const timestamp = timers[event_name];\r\n    if (!_.isUndefined(timestamp)) {\r\n      delete this['props']['costTime'][event_name];\r\n      this.save();\r\n    }\r\n    return timestamp;\r\n  }\r\n};\r\n\r\nexport default LOCAL_STORAGE;","/**\r\n * 单页面模块\r\n */\r\nimport {_} from './utils'\r\n\r\nfunction on(obj, event, callFn) {\r\n  if(obj[event]) {\r\n    const fn = obj[event];\r\n    obj[event] = function() {\r\n      const args = Array.prototype.slice.call(arguments);\r\n      callFn.apply(this, args);\r\n      fn.apply(this, args);\r\n    };\r\n  } else {\r\n    obj[event] = function() {\r\n      const args = Array.prototype.slice.call(arguments);\r\n      callFn.apply(this, args);\r\n    };\r\n  }\r\n}\r\n\r\nfunction getPath() {\r\n  return location.pathname + location.search;\r\n}\r\n\r\nconst SPA = {\r\n  config: {\r\n    mode: 'hash',\r\n    track_replace_state: false,\r\n    callback_fn: () => {}\r\n  },\r\n  init(config) {\r\n    this.config = _.extend(this.config, config || {});\r\n    this.path = getPath();\r\n    this.url= document.URL;\r\n    this.event();\r\n  },\r\n  event() {\r\n    if(this.config.mode === 'history') {\r\n      if(!history.pushState || !window.addEventListener) return;\r\n      on(history, 'pushState', this.pushStateOverride.bind(this) );\r\n      on(history, 'replaceState', this.replaceStateOverride.bind(this) );\r\n      window.addEventListener('popstate', this.handlePopState.bind(this));\r\n    } else if(this.config.mode === 'hash') {\r\n      _.register_hash_event( this.handleHashState.bind(this) );\r\n    }\r\n  },\r\n  pushStateOverride(){\r\n    this.handleUrlChange(true);\r\n  },\r\n  replaceStateOverride() {\r\n    this.handleUrlChange(false);\r\n  },\r\n  handlePopState() {\r\n    this.handleUrlChange(true);\r\n  },\r\n  handleHashState() {\r\n    this.handleUrlChange(true);\r\n  },\r\n  handleUrlChange(historyDidUpdate) {\r\n    setTimeout(() => {\r\n      if(this.config.mode === 'hash') {\r\n        if(_.isFunction(this.config.callback_fn)) {\r\n          this.config.callback_fn.call();\r\n          _.innerEvent.trigger('singlePage:change', {\r\n            oldUrl: this.url,\r\n            nowUrl: document.URL\r\n          });\r\n          this.url = document.URL;\r\n        }\r\n      } else if( this.config.mode === 'history' ) {\r\n        const oldPath = this.path;\r\n        const newPath = getPath();\r\n        if(oldPath != newPath && this.shouldTrackUrlChange(newPath, oldPath)) {\r\n          this.path = newPath;\r\n          if(historyDidUpdate || this.config.track_replace_state) {\r\n            if(typeof this.config.callback_fn === 'function') {\r\n              this.config.callback_fn.call();\r\n              _.innerEvent.trigger('singlePage:change', {\r\n                oldUrl: this.url,\r\n                nowUrl: document.URL\r\n              });\r\n              this.url = document.URL;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }, 0);\r\n  },\r\n  shouldTrackUrlChange(newPath, oldPath) {\r\n    return !!(newPath && oldPath);\r\n  }\r\n};\r\n\r\nexport default SPA;\r\n","import {\r\n  CHANNEL_PARAMS\r\n} from './config'\r\n\r\nimport {_} from './utils'\r\n\r\nclass CHANNEL {\r\n  constructor(instance) {\r\n    this.instance = instance;\r\n    // 渠道推广的参数信息\r\n    this.channel_params = {};\r\n    this.cookie_name = 'smart_' + this.instance._get_config('token') + '_c';\r\n    this._set_channel_params();\r\n  }\r\n  // 转变参数(TODO)\r\n  _change() {\r\n\r\n  }\r\n  // 从url 或 本地cookie 拿取推广信息\r\n  _set_channel_params() {\r\n    // 从url上拿取，此时还需保存到本地cookie\r\n    if (this._check_chennel()) {\r\n      this.channel_params = this._url_channel_params();\r\n      this._save();\r\n    } else {\r\n     // 从本地cookie拿取\r\n     const cookie = _.cookie.get(this.cookie_name);\r\n     if (cookie) {\r\n      this.channel_params = _.JSONDecode(cookie);\r\n     }\r\n    }\r\n  }\r\n  // 得到url上推广的参数信息\r\n  _url_channel_params() {\r\n    const channel_keywords = 'utm_source utm_medium utm_campaign utm_content utm_term promotional_id'.split(' ');\r\n    let val = '';\r\n    const params = {};\r\n    _.each(channel_keywords, function(key) {\r\n      val = _.getQueryParam(document.URL, key);\r\n      if (val) {\r\n        params[key] = val;\r\n      }\r\n    });\r\n    return params;\r\n  }\r\n  // 检测是否为渠道推广\r\n  _check_chennel() {\r\n    const params = this._url_channel_params();\r\n    let is_channel = false;\r\n    if (params.utm_source && params.utm_medium && params.utm_campaign && params.promotional_id) {\r\n      is_channel = true;\r\n    }\r\n    return is_channel;\r\n  }\r\n  // 将推广参数值保存到客户端本地的cookie，30天后失效\r\n  _save() {\r\n    if (this._check_chennel()) {\r\n      _.cookie.set(\r\n        this.cookie_name, \r\n        _.JSONEncode(this.channel_params), \r\n        30, \r\n        this.instance._get_config('local_storage').cross_subdomain_cookie\r\n      );\r\n    }\r\n  }\r\n  // 检测是否要上报广告点击事件\r\n  // 条件： 1. 必须是渠道推广；2. 必须有 referrer；3. 当前打开的页面url必须是对外推广的url（有短链和长链）, 表现为当前url上的参数无 t_re(turn_redirect) 字段值；\r\n  // 其它说明：一般情况下对外推广的链接是短链（不一定跟落地页域名一致），但有些渠道不支持，那么只能使用长链（落地页url+ 推广参数）\r\n  check_ad_click() {\r\n    let is_ad_click = false;\r\n    const t_re =  _.getQueryParam(document.URL, 't_re');\r\n    if (this._check_chennel()) {\r\n      if (document.referrer && !t_re) {\r\n        is_ad_click = true;\r\n      }\r\n    }\r\n    return is_ad_click;\r\n  }\r\n  // 返回参数\r\n  get_channel_params() {\r\n    this._set_channel_params();\r\n    const params = {\r\n      utmSource: this.channel_params.utm_source,\r\n      utmMedium: this.channel_params.utm_medium,\r\n      promotionalID: this.channel_params.promotional_id,\r\n      utmCampaign: this.channel_params.utm_campaign,\r\n      utmContent: this.channel_params.utm_content,\r\n      utmTerm: this.channel_params.utm_term\r\n    };\r\n    return _.deleteEmptyProperty(params);\r\n  }\r\n}\r\n\r\nexport default CHANNEL;","/**\r\n * 远程拉取js插件，包含：可视化埋点（圈选）元素、热力图展示、可视化实验（样式配置）、debug展示\r\n * \r\n * 按需拉取插件规则（根据当前页的url上参数确定拉取）：\r\n * \r\n * 1.可视化埋点圈选元素：当前页url 上含有 'smart_auto_visualization_token' 字段且值存在（该token是保存信息的凭证）\r\n * 2. 其它待定\r\n */\r\n\r\nimport {_, console} from './utils'\r\n\r\n class LOAD_CONTROL_JS {\r\n    constructor(instance) {\r\n      this.instance = instance;\r\n      this._load_js();\r\n    }\r\n    _load_js() {\r\n\r\n    }\r\n    // 拉取可视化埋点（圈选）插件\r\n    _load_visualization() {\r\n\r\n    }\r\n    is_visualization() {\r\n      \r\n    }\r\n }\r\n\r\n export default LOAD_CONTROL_JS;\r\n","import { CONFIG, DEFAULT_CONFIG } from \"./config\";\r\n\r\nimport { _, console } from \"./utils\";\r\n\r\n// 用户属性追踪\r\nimport USER_TRACK from \"./user_track\";\r\n// 用户事件追踪\r\nimport EVENT_TRACK from \"./event_track\";\r\n// 本地存储\r\nimport LOCAL_STORAGE from \"./local_storage\";\r\n// 单页面\r\nimport SPA from \"./spa\";\r\n// 渠道跟踪\r\nimport CHANNEL from \"./channel\";\r\n// 远程拉取js文件（插件，具体内容请查看该文件）\r\nimport LOAD_CONTROL_JS from \"./load_control_js\";\r\n\r\nclass SMARTLib {\r\n  /**\r\n   *\r\n   * @param {String} token 上报数据凭证\r\n   * @param {Object} config sdk客户端配置\r\n   */\r\n  constructor(token, config) {\r\n    this[\"__loaded\"] = true;\r\n    this._ = _;\r\n    this[\"config\"] = {};\r\n    this._set_config(\r\n      _.extend({}, DEFAULT_CONFIG, CONFIG, config, { token: token })\r\n    );\r\n    this[\"local_storage\"] = new LOCAL_STORAGE(this[\"config\"]);\r\n    // 运行钩子函数\r\n    this._loaded();\r\n    // 实例化拉取远程库对象（按需加载）\r\n    this[\"load_control_js\"] = new LOAD_CONTROL_JS(this);\r\n    // 实例化事件对象\r\n    this[\"event\"] = new EVENT_TRACK(this);\r\n    // 实例化用户对象\r\n    this[\"user\"] = new USER_TRACK(this);\r\n    // 实例化渠道跟踪对象\r\n    this[\"channel\"] = new CHANNEL(this);\r\n    // 设置设备凭证\r\n    this._set_device_id();\r\n\r\n    // 上报广告点击事件\r\n    if (this[\"channel\"].check_ad_click()) {\r\n      this._ad_click();\r\n    }\r\n\r\n    this._track_pv();\r\n\r\n    // persistedTime 首次访问应用时间\r\n    this[\"local_storage\"].register_once(\r\n      { persistedTime: new Date().getTime() },\r\n      \"\"\r\n    );\r\n    // 单页面\r\n    if (this._get_config(\"SPA\").is) {\r\n      this._SPA();\r\n    }\r\n  }\r\n  // 广告点击事件\r\n  _ad_click() {\r\n    this.track_event(\"smart_ad_click\");\r\n  }\r\n  // 内部使用的PV方法\r\n  _track_pv(properties, callback) {\r\n    // 配置为自动触发PV事件\r\n    if (this._get_config(\"pageview\")) {\r\n      this[\"event\"].track_pv(properties, callback);\r\n    } else {\r\n      // 若没有自动触发事件，还需检测session (说明：当触发PV 时，实际已经检测了session)\r\n      this[\"event\"]._session();\r\n    }\r\n  }\r\n  // 单页面应用（影响PV）\r\n  _SPA() {\r\n    SPA.init({\r\n      mode: this._get_config(\"SPA\").mode,\r\n      callback_fn: () => {\r\n        this._track_pv();\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * 设置配置\r\n   * @param {Object} config\r\n   */\r\n  _set_config(config) {\r\n    if (_.isObject(config)) {\r\n      this[\"config\"] = _.extend(this[\"config\"], config);\r\n      CONFIG.DEBUG = CONFIG.DEBUG || this._get_config(\"debug\");\r\n    }\r\n  }\r\n  /**\r\n   * 获取某个配置\r\n   * @param {String} prop_name\r\n   * @returns {*}\r\n   */\r\n  _get_config(prop_name) {\r\n    return this[\"config\"][prop_name];\r\n  }\r\n  // sdk初始化之前触发的钩子函数，该方法必须在初始化子模块前以及上报数据前使用\r\n  _loaded() {\r\n    try {\r\n      this._get_config(\"loaded\")(this);\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n  /**\r\n   * 设置本地设备凭证\r\n   * 若是首次访问（本地无设备凭证），上报用户首次访问网站事件\r\n   */\r\n  _set_device_id() {\r\n    let track_data = {};\r\n    if (!this.get_device_id()) {\r\n      this[\"local_storage\"].register_once({ deviceId: _.UUID() }, \"\");\r\n      track_data = this.track_event(\"smart_activate\");\r\n    }\r\n    return track_data;\r\n  }\r\n\r\n  // 获取唯一凭证（设备标记）\r\n  get_device_id() {\r\n    return this.get_property(\"deviceId\");\r\n  }\r\n  // 获取指定本地存储属性（缓存和本地）\r\n  get_property(prop_name) {\r\n    return this[\"local_storage\"][\"props\"][prop_name];\r\n  }\r\n  /**\r\n   * 设置一个指定事件的耗时监听器\r\n   * @param {String} event_name\r\n   */\r\n  time_event(event_name) {\r\n    this[\"event\"].time_event(event_name);\r\n  }\r\n  /**\r\n   * 发送PV事件，在此之前检测session\r\n   * @param {Object} properties  pv属性\r\n   * @param {*} callback\r\n   */\r\n  track_pv(properties, callback) {\r\n    this[\"event\"].track_pv(properties, callback);\r\n  }\r\n  /**\r\n   * 追踪事件（上报用户事件触发数据）\r\n   * @param {String} event_name 事件名称（必须）\r\n   * @param {Object} properties 事件属性\r\n   * @param {Function} callback 上报后的回调方法\r\n   * @param {String} event_type 自定义事件类型\r\n   * @returns {Object} track_data 上报的数据\r\n   */\r\n  track_event(event_name, properties, callback, event_type) {\r\n    this[\"event\"].track(event_name, properties, callback, event_type);\r\n  }\r\n  /**\r\n   * 设置事件自定义通用属性\r\n   * 成功设置事件通用属性后，再通过 track_event: 追踪事件时，事件通用属性会被添加进每个事件中。\r\n   * 重复调用 register_event_super_properties: 会覆盖之前已设置的通用属性。\r\n   */\r\n  register_event_super_properties(prop, to) {\r\n    let set_props = {};\r\n    let super_properties = this.get_property(\"superProperties\");\r\n    if (_.isObject(prop)) {\r\n      _.each(prop, (v, k) => {\r\n        set_props[k] = v;\r\n      });\r\n    } else {\r\n      set_props[prop] = to;\r\n    }\r\n    // 注意合并顺序\r\n    super_properties = _.extend({}, super_properties, set_props);\r\n    this[\"local_storage\"].register({\r\n      superProperties: super_properties\r\n    });\r\n  }\r\n  /**\r\n   * 设置事件自定义通用属性\r\n   * 成功设置事件通用属性后，再通过 track_event: 追踪事件时，事件通用属性会被添加进每个事件中。\r\n   * 不覆盖之前已经设定的通用属性。\r\n   */\r\n  register_event_super_properties_once(prop, to) {\r\n    let set_props = {};\r\n    let super_properties = this.get_property(\"superProperties\");\r\n    if (_.isObject(prop)) {\r\n      _.each(prop, (v, k) => {\r\n        set_props[k] = v;\r\n      });\r\n    } else {\r\n      set_props[prop] = to;\r\n    }\r\n    // 注意合并顺序\r\n    super_properties = _.extend({}, set_props, super_properties);\r\n    this[\"local_storage\"].register({\r\n      superProperties: super_properties\r\n    });\r\n  }\r\n  /**\r\n   * 删除指定通用事件属性\r\n   * @param {String} prop_name\r\n   */\r\n  unregister_event_super_properties(prop_name) {\r\n    if (_.isString(prop_name)) {\r\n      let super_properties = this.get_property(\"superProperties\");\r\n      if (_.isObject(super_properties)) {\r\n        delete super_properties[prop_name];\r\n        this[\"local_storage\"].register({\r\n          superProperties: super_properties\r\n        });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 清除本地已设置的通用事件属性\r\n   */\r\n  clear_event_super_properties() {\r\n    this[\"local_storage\"].register({\r\n      superProperties: {}\r\n    });\r\n  }\r\n  /**\r\n   * 查看当前已设置的通用事件属性\r\n   */\r\n  current_event_super_properties() {\r\n    return this.get_property(\"superProperties\");\r\n  }\r\n  /**\r\n   * 用户登录和注册时调用\r\n   * @param {String} user_id\r\n   */\r\n  login(user_id) {\r\n    this[\"event\"].login(user_id);\r\n  }\r\n  // 清除本地用户信息，退出用户（选则调用）,建议平台网站不必调用（无需匿名用户的平台）\r\n  logout() {\r\n    this[\"event\"].logout();\r\n  }\r\n  \r\n}\r\n\r\n\r\nclass LoaderSync {\r\n  constructor() {\r\n    window['smart'] = this;\r\n  }\r\n  init(token, config) {\r\n    if (this['__loaded']) {\r\n      return ;\r\n    }\r\n    this.instance = new SMARTLib(token, config);\r\n    this.instance.init = this['init'];\r\n    window['smart'] = this.instance;\r\n  }\r\n}\r\n\r\n\r\nexport default new LoaderSync();\r\n"],"names":["DEFAULT_CONFIG","CONFIG","SYSTEM_EVENT_TYPE","SYSTEM_EVENT_OBJECT","PEOPLE_RESERVED_PROPERTY","previousDevice","window","device","changeOrientationList","documentElement","document","userAgent","navigator","toLowerCase","television","find","needle","indexOf","hasClass","className","match","RegExp","addClass","currentClassNames","replace","removeClass","handleOrientation","landscape","walkOnChangeOrientationList","newOrientation","index","macos","ios","iphone","ipod","ipad","windows","android","androidPhone","androidTablet","blackberry","blackberryPhone","blackberryTablet","windowsPhone","windowsTablet","fxos","fxosPhone","fxosTablet","meego","cordova","location","protocol","nodeWebkit","babelHelpers.typeof","process","mobile","tablet","desktop","i","length","portrait","screen","orientation","Object","prototype","hasOwnProperty","call","type","includes","innerHeight","innerWidth","noConflict","this","onChangeOrientation","cb","push","orientationEvent","findMatch","arr","setOrientationCache","addEventListener","attachEvent","os","base64Encode","data","h1","h2","h3","h4","bits","b64","ac","enc","tmp_arr","string","start","end","stringl","n","utftext","c1","charCodeAt","String","fromCharCode","substring","utf8Encode","charAt","join","slice","win","toString","object","NA_VERSION","external","appVersion","vendor","re_msie","re_blackberry_10","re_blackberry_6_7","re_blackberry_4_5","DEVICES","ua","re_mediapad","test","OS","m","version","ENGINE","BROWSER","x","checkTW360External","mxVersion","max_version","ex","LiebaoGetVersion","re_opera_old","key","runpath","twGetRunPath","security","twGetSecurityID","twGetVersion","detect","name","expression","expr","isFunction","info","t","isObject","exec","na","init","patterns","factory","detector","detected","l","pattern","d","v","parseFloat","ieCore","engineMode","engineVersion","browserMode","browserVersion","v_version","split","parseInt","v_mode","IEMode","mode","engine","compatible","browser","parse","breaker","_","obj","iterator","context","Array","forEach","each","arguments","source","prop","isArray","iterable","toArray","isArguments","values","results","value","JSON","error","json","stringify","fn","bool","str","ret","val","truncate","formdata","arg_separator","use_val","use_key","isUndefined","encodeURIComponent","timeString","url","host","URL","param","target","decodeURIComponent","fixEvent","event","preventDefault","stopPropagation","T","Date","apply","loadScript","para","extend","g","getElementsByTagName","appendChild","createElement","rel","href","async","setAttribute","src","onload","onreadystatechange","readyState","success","onerror","appendCall","register_event","returnValue","cancelBubble","element","handler","oldSchool","useCapture","ontype","old_handler","new_handler","old_handlers","old_result","new_result","makeHandler","register_hash_event","callback","referrer","deviceModel","sss","windowsOs","devicePlatform","trim","isWindows","deviceOsVersion","fullVersion","title","pathname","domain","language","width","height","innerEvent","_list","args","arrFn","sendRequest","getTime","HTTPBuildQuery","img","onabort","ajax","get","options","timeout","that","params","req","XMLHttpRequest","open","setRequestHeader","withCredentials","ontimeout","status","message","JSONDecode","responseText","statusText","send","JSONEncode","e","UUID","se","Math","random","ch","buffer","xor","result","byte_array","j","tmp","unshift","UA","localStorage","msg","getItem","err","setItem","removeItem","cookie","nameEQ","ca","c","seconds","cross_subdomain","is_secure","cdomain","expires","secure","matches","hostname","date","setTime","toGMTString","days","new_cookie_val","set","windowConsole","console","DEBUG","log","arg","concat","USER_TRACK","properties","instance","get_device_id","get_property","get_channel_params","truncateLength","_get_config","truncated_data","isNumber","track_type","token","response","to","set_props","k","_this","_is_reserved_property","_send_request","EVENT_TRACK","is_other_channel","getHost","event_name","register","track","time","sessionStartTime","LASTEVENT","sessionTotalLength","session_start_time","updated_time","now_date_time_ms","now_date_time_se","other_channel_Bool","_check_channel","_close_cur_session","_start_new_session","user_id","anonymous_id","logout","_event_is_disabled","set_event_timer","_session","event_type","load","user_set_properties","costTime","start_listen_timestamp","remove_event_timer","data_type","sessionCloseTime","LIB_VERSION","is","sessionReferrer","_signup","userId","unregister","register_once","mark_page_url","on","eventName","urlParams","LOCAL_STORAGE","localData","localStorageConfig","default_expiry","expire_days","set_disabled","set_cross_subdomain","set_secure","disabled","remove","storage","save","config","old_cookie","props","default_value","timestamp","timers","local_storage","supported","localStorage_supported","update_config","upgrade","callFn","getPath","search","SPA","path","history","pushState","pushStateOverride","bind","replaceStateOverride","handlePopState","handleHashState","handleUrlChange","historyDidUpdate","callback_fn","trigger","oldPath","newPath","shouldTrackUrlChange","track_replace_state","CHANNEL","_check_chennel","channel_params","_url_channel_params","_save","cookie_name","channel_keywords","getQueryParam","is_channel","utm_source","utm_medium","utm_campaign","promotional_id","cross_subdomain_cookie","is_ad_click","t_re","_set_channel_params","utm_content","utm_term","deleteEmptyProperty","LOAD_CONTROL_JS","_load_js","SMARTLib","track_event","track_pv","_track_pv","prop_name","track_data","deviceId","time_event","super_properties","isString","login","_set_config","_loaded","_set_device_id","check_ad_click","_ad_click","persistedTime","_SPA"],"mappings":"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"}